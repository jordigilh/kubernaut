# Cleanup PVC Workflow Schema - Job Backend (BR-WORKFLOW-004)
# Scenario: #121 -- Orphaned PVCs consuming disk -> cleanup
metadata:
  workflowId: cleanup-pvc-v1
  version: "1.0.0"
  description:
    what: "Deletes orphaned PersistentVolumeClaims that are not mounted by any running pod"
    whenToUse: "When PVCs from completed or failed batch jobs accumulate and contribute to storage pressure"
    whenNotToUse: "When PVCs are in use by running workloads, or when the data in the PVCs needs to be preserved for compliance"
    preconditions: "The PVCs are confirmed orphaned (not mounted by any running pod) and the data does not need to be retained"

actionType: CleanupPVC

labels:
  signalName: OrphanedPVCs
  severity: [low, critical]
  environment: [production, staging]
  component: "*"
  priority: "*"

execution:
  engine: job
  bundle: quay.io/kubernaut-cicd/test-workflows/cleanup-pvc-job@sha256:ebd66856b9c0c1f25b148b0478100d2406ee17a16b38684ef8f3f01382cc5c43

parameters:
  - name: TARGET_NAMESPACE
    type: string
    required: true
    description: "Namespace containing the orphaned PVCs"
  - name: LABEL_SELECTOR
    type: string
    required: false
    description: "Label selector to identify PVCs to clean up (default: batch-run=completed)"
