# DataStorage configuration for HolmesGPT-API integration tests
# Per ADR-030: Service must not guess config file location
#
# This file is mounted into DataStorage container at /etc/datastorage/config.yaml
# and referenced via CONFIG_PATH environment variable

service:
  name: data-storage
  metricsPort: 9090
  logLevel: debug
  shutdownTimeout: 30s

server:
  port: 8080
  host: "0.0.0.0"
  readTimeout: 30s
  writeTimeout: 30s

database:
  # PostgreSQL accessible via host.containers.internal (DD-TEST-001: port 15439)
  host: host.containers.internal
  port: 15439
  name: action_history
  user: slm_user
  sslMode: disable
  maxOpenConns: 25
  maxIdleConns: 5
  connMaxLifetime: 5m
  connMaxIdleTime: 10m
  # ADR-030 Section 6: Secrets loaded from mounted files
  secretsFile: "/etc/datastorage/database-credentials.yaml"
  usernameKey: "username"
  passwordKey: "password"

redis:
  # Redis accessible via host.containers.internal (DD-TEST-001: port 16387)
  addr: host.containers.internal:16387
  db: 0
  # DD-009: Redis used for Dead Letter Queue (DLQ) fallback
  dlqStreamName: audit:dlq:notification
  dlqMaxLen: 10000
  dlqConsumerGroup: datastorage-dlq-consumers
  # ADR-030 Section 6: Secrets loaded from mounted files
  secretsFile: "/etc/datastorage/redis-credentials.yaml"
  passwordKey: "password"

logging:
  level: debug
  format: json
