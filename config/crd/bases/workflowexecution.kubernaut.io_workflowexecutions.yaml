---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  name: workflowexecutions.workflowexecution.kubernaut.io
spec:
  group: workflowexecution.kubernaut.io
  names:
    kind: WorkflowExecution
    listKind: WorkflowExecutionList
    plural: workflowexecutions
    singular: workflowexecution
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: WorkflowExecution is the Schema for the workflowexecutions API.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: WorkflowExecutionSpec defines the desired state of WorkflowExecution.
            properties:
              adaptiveOrchestration:
                description: AdaptiveOrchestration enables runtime optimization
                properties:
                  dynamicStepAdjustment:
                    type: boolean
                  learningFromHistory:
                    type: boolean
                  optimizationEnabled:
                    type: boolean
                required:
                - dynamicStepAdjustment
                - learningFromHistory
                - optimizationEnabled
                type: object
              executionStrategy:
                description: ExecutionStrategy specifies how to execute the workflow
                properties:
                  approvalRequired:
                    type: boolean
                  dryRunFirst:
                    type: boolean
                  maxRetries:
                    type: integer
                  rollbackStrategy:
                    type: string
                  safetyChecks:
                    items:
                      description: SafetyCheck represents a validation requirement
                      properties:
                        description:
                          type: string
                        required:
                          type: boolean
                        type:
                          type: string
                      required:
                      - description
                      - required
                      - type
                      type: object
                    type: array
                required:
                - approvalRequired
                - dryRunFirst
                - rollbackStrategy
                type: object
              remediationRequestRef:
                description: RemediationRequestRef references the parent RemediationRequest
                  CRD
                properties:
                  apiVersion:
                    description: API version of the referent.
                    type: string
                  fieldPath:
                    description: |-
                      If referring to a piece of an object instead of an entire object, this string
                      should contain a valid JSON/Go field access statement, such as desiredState.manifest.containers[2].
                      For example, if the object reference is to a container within a pod, this would take on a value like:
                      "spec.containers{name}" (where "name" refers to the name of the container that triggered
                      the event) or if no container name is specified "spec.containers[2]" (container with
                      index 2 in this pod). This syntax is chosen only to have some well-defined way of
                      referencing a part of an object.
                    type: string
                  kind:
                    description: |-
                      Kind of the referent.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
                    type: string
                  name:
                    description: |-
                      Name of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                    type: string
                  namespace:
                    description: |-
                      Namespace of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/
                    type: string
                  resourceVersion:
                    description: |-
                      Specific resourceVersion to which this reference is made, if any.
                      More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency
                    type: string
                  uid:
                    description: |-
                      UID of the referent.
                      More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids
                    type: string
                type: object
                x-kubernetes-map-type: atomic
              workflowDefinition:
                description: WorkflowDefinition contains the workflow to execute
                properties:
                  aiRecommendations:
                    description: AIRecommendations contains AI-generated workflow
                      optimization suggestions
                    properties:
                      estimatedDuration:
                        type: string
                      generatedAt:
                        type: string
                      overallConfidence:
                        description: Confidence and metadata
                        maximum: 1
                        minimum: 0
                        type: number
                      parallelExecutionSuggestions:
                        description: Workflow-level recommendations
                        items:
                          description: ParallelExecutionGroup identifies steps that
                            can run in parallel
                          properties:
                            confidence:
                              type: number
                            groupName:
                              type: string
                            stepNumbers:
                              items:
                                type: integer
                              type: array
                          required:
                          - confidence
                          - groupName
                          - stepNumbers
                          type: object
                        type: array
                      recommendationSource:
                        type: string
                      riskFactors:
                        description: Risk assessment
                        items:
                          description: RiskFactor describes a potential risk
                          properties:
                            factor:
                              type: string
                            mitigation:
                              type: string
                            probability:
                              type: number
                            severity:
                              type: string
                          required:
                          - factor
                          - probability
                          - severity
                          type: object
                        type: array
                      safetyImprovements:
                        items:
                          description: SafetyImprovement suggests safety check additions
                          properties:
                            description:
                              type: string
                            priority:
                              type: string
                            safetyCheck:
                              type: string
                            stepNumber:
                              type: integer
                          required:
                          - description
                          - priority
                          - safetyCheck
                          type: object
                        type: array
                      similarWorkflowSuccessRate:
                        description: Historical success data
                        type: number
                      stepOptimizations:
                        description: Step-level recommendations
                        items:
                          description: StepOptimization contains optimization suggestions
                            for a step
                          properties:
                            confidence:
                              type: number
                            impactLevel:
                              type: string
                            parameterChanges:
                              description: ParameterOptimization contains parameter
                                change suggestions
                              properties:
                                reason:
                                  type: string
                                suggestedParameters:
                                  additionalProperties:
                                    type: string
                                  type: object
                              required:
                              - reason
                              - suggestedParameters
                              type: object
                            recommendation:
                              type: string
                            stepNumber:
                              type: integer
                          required:
                          - confidence
                          - impactLevel
                          - recommendation
                          - stepNumber
                          type: object
                        type: array
                    required:
                    - estimatedDuration
                    - generatedAt
                    - overallConfidence
                    - recommendationSource
                    - similarWorkflowSuccessRate
                    type: object
                  dependencies:
                    additionalProperties:
                      items:
                        type: string
                      type: array
                    type: object
                  name:
                    type: string
                  steps:
                    items:
                      description: WorkflowStep represents a single step in the workflow
                      properties:
                        action:
                          type: string
                        criticalStep:
                          type: boolean
                        dependsOn:
                          items:
                            type: integer
                          type: array
                        maxRetries:
                          type: integer
                        name:
                          type: string
                        parameters:
                          description: |-
                            StepParameters is a discriminated union based on Action type
                            Only ONE of these should be populated based on the Action field
                          properties:
                            cordonNode:
                              description: Node actions
                              properties:
                                nodeName:
                                  type: string
                              required:
                              - nodeName
                              type: object
                            custom:
                              description: Custom actions (for extensibility)
                              properties:
                                actionType:
                                  type: string
                                config:
                                  additionalProperties:
                                    type: string
                                  type: object
                              required:
                              - actionType
                              - config
                              type: object
                            deletePod:
                              properties:
                                gracePeriod:
                                  type: string
                                namespace:
                                  type: string
                                podName:
                                  type: string
                              required:
                              - namespace
                              - podName
                              type: object
                            drainNode:
                              properties:
                                deleteLocalData:
                                  type: boolean
                                gracePeriod:
                                  type: string
                                ignoreDaemonSets:
                                  type: boolean
                                nodeName:
                                  type: string
                              required:
                              - deleteLocalData
                              - ignoreDaemonSets
                              - nodeName
                              type: object
                            restartDeployment:
                              properties:
                                deployment:
                                  type: string
                                gracePeriod:
                                  type: string
                                namespace:
                                  type: string
                              required:
                              - deployment
                              - namespace
                              type: object
                            restartPod:
                              description: Pod actions
                              properties:
                                gracePeriod:
                                  type: string
                                namespace:
                                  type: string
                                podName:
                                  type: string
                                selector:
                                  type: string
                              required:
                              - namespace
                              type: object
                            scaleDeployment:
                              description: Deployment actions
                              properties:
                                deployment:
                                  type: string
                                namespace:
                                  type: string
                                replicas:
                                  format: int32
                                  type: integer
                              required:
                              - deployment
                              - namespace
                              - replicas
                              type: object
                            updateConfigMap:
                              description: ConfigMap/Secret actions
                              properties:
                                dataUpdates:
                                  additionalProperties:
                                    type: string
                                  type: object
                                name:
                                  type: string
                                namespace:
                                  type: string
                              required:
                              - dataUpdates
                              - name
                              - namespace
                              type: object
                            updateImage:
                              properties:
                                container:
                                  type: string
                                deployment:
                                  type: string
                                namespace:
                                  type: string
                                newImage:
                                  type: string
                              required:
                              - container
                              - deployment
                              - namespace
                              - newImage
                              type: object
                            updateSecret:
                              properties:
                                dataUpdates:
                                  additionalProperties:
                                    type: string
                                  type: object
                                name:
                                  type: string
                                namespace:
                                  type: string
                              required:
                              - dataUpdates
                              - name
                              - namespace
                              type: object
                          type: object
                        rollbackSpec:
                          description: RollbackSpec defines how to rollback a step
                          properties:
                            action:
                              type: string
                            parameters:
                              description: RollbackParameters is a discriminated union
                                based on rollback action
                              properties:
                                custom:
                                  description: Custom rollbacks
                                  properties:
                                    actionType:
                                      type: string
                                    config:
                                      additionalProperties:
                                        type: string
                                      type: object
                                  required:
                                  - actionType
                                  - config
                                  type: object
                                restorePreviousConfig:
                                  description: Config rollbacks
                                  properties:
                                    name:
                                      type: string
                                    namespace:
                                      type: string
                                    snapshot:
                                      type: string
                                    type:
                                      type: string
                                  required:
                                  - name
                                  - namespace
                                  - snapshot
                                  - type
                                  type: object
                                restorePreviousDeployment:
                                  description: Deployment rollbacks
                                  properties:
                                    deployment:
                                      type: string
                                    namespace:
                                      type: string
                                    revision:
                                      format: int32
                                      type: integer
                                  required:
                                  - deployment
                                  - namespace
                                  type: object
                                scaleToPrevious:
                                  properties:
                                    deployment:
                                      type: string
                                    namespace:
                                      type: string
                                    previousReplicas:
                                      format: int32
                                      type: integer
                                  required:
                                  - deployment
                                  - namespace
                                  - previousReplicas
                                  type: object
                                uncordonNode:
                                  description: Node rollbacks
                                  properties:
                                    nodeName:
                                      type: string
                                  required:
                                  - nodeName
                                  type: object
                              type: object
                            timeout:
                              type: string
                          required:
                          - action
                          type: object
                        stepNumber:
                          type: integer
                        targetCluster:
                          type: string
                        timeout:
                          type: string
                      required:
                      - action
                      - criticalStep
                      - name
                      - parameters
                      - stepNumber
                      - targetCluster
                      type: object
                    type: array
                  version:
                    type: string
                required:
                - name
                - steps
                - version
                type: object
            required:
            - executionStrategy
            - remediationRequestRef
            - workflowDefinition
            type: object
          status:
            description: WorkflowExecutionStatus defines the observed state
            properties:
              adaptiveAdjustments:
                description: AdaptiveAdjustments made during execution
                items:
                  description: AdaptiveAdjustment records runtime optimization
                  properties:
                    adjustment:
                      type: string
                    reason:
                      type: string
                    timestamp:
                      format: date-time
                      type: string
                  required:
                  - adjustment
                  - reason
                  - timestamp
                  type: object
                type: array
              completionTime:
                format: date-time
                type: string
              conditions:
                description: Conditions for status tracking
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              currentStep:
                description: CurrentStep tracks progress
                minimum: 0
                type: integer
              errorType:
                type: string
              executionMetrics:
                description: ExecutionMetrics tracks workflow performance
                properties:
                  resourcesAffected:
                    type: integer
                  rollbacksPerformed:
                    type: integer
                  stepSuccessRate:
                    maximum: 1
                    minimum: 0
                    type: number
                  totalDuration:
                    type: string
                required:
                - resourcesAffected
                - rollbacksPerformed
                - stepSuccessRate
                - totalDuration
                type: object
              executionPlan:
                description: ExecutionPlan generated during planning phase
                properties:
                  estimatedDuration:
                    type: string
                  rollbackStrategy:
                    type: string
                  safetyChecks:
                    items:
                      description: SafetyCheck represents a validation requirement
                      properties:
                        description:
                          type: string
                        required:
                          type: boolean
                        type:
                          type: string
                      required:
                      - description
                      - required
                      - type
                      type: object
                    type: array
                  strategy:
                    enum:
                    - sequential
                    - parallel
                    - sequential-with-parallel
                    type: string
                required:
                - estimatedDuration
                - rollbackStrategy
                - safetyChecks
                - strategy
                type: object
              executionSnapshot:
                description: ExecutionSnapshot captures workflow state at failure
                  for recovery context
                properties:
                  clusterState:
                    additionalProperties:
                      type: string
                    type: object
                  completedSteps:
                    items:
                      type: integer
                    type: array
                  currentStep:
                    type: integer
                  resourceSnapshot:
                    additionalProperties:
                      type: string
                    type: object
                required:
                - clusterState
                - completedSteps
                - currentStep
                - resourceSnapshot
                type: object
              executionStartTime:
                format: date-time
                type: string
              failedAction:
                type: string
              failedStep:
                description: Recovery tracking fields
                type: integer
              failureReason:
                description: Error handling
                type: string
              monitoringStartTime:
                format: date-time
                type: string
              phase:
                description: Phase tracks current execution stage
                enum:
                - planning
                - validating
                - executing
                - monitoring
                - completed
                - failed
                - paused
                type: string
              planningStartTime:
                description: Phase timestamps
                format: date-time
                type: string
              rollbackReason:
                type: string
              stepStatuses:
                description: StepStatuses tracks individual step execution
                items:
                  description: StepStatus tracks individual step execution
                  properties:
                    action:
                      type: string
                    endTime:
                      format: date-time
                      type: string
                    errorMessage:
                      type: string
                    k8sExecutionRef:
                      description: ObjectReference contains enough information to
                        let you inspect or modify the referred object.
                      properties:
                        apiVersion:
                          description: API version of the referent.
                          type: string
                        fieldPath:
                          description: |-
                            If referring to a piece of an object instead of an entire object, this string
                            should contain a valid JSON/Go field access statement, such as desiredState.manifest.containers[2].
                            For example, if the object reference is to a container within a pod, this would take on a value like:
                            "spec.containers{name}" (where "name" refers to the name of the container that triggered
                            the event) or if no container name is specified "spec.containers[2]" (container with
                            index 2 in this pod). This syntax is chosen only to have some well-defined way of
                            referencing a part of an object.
                          type: string
                        kind:
                          description: |-
                            Kind of the referent.
                            More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
                          type: string
                        name:
                          description: |-
                            Name of the referent.
                            More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                          type: string
                        namespace:
                          description: |-
                            Namespace of the referent.
                            More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/
                          type: string
                        resourceVersion:
                          description: |-
                            Specific resourceVersion to which this reference is made, if any.
                            More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#concurrency-control-and-consistency
                          type: string
                        uid:
                          description: |-
                            UID of the referent.
                            More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#uids
                          type: string
                      type: object
                      x-kubernetes-map-type: atomic
                    result:
                      description: StepExecutionResult contains structured execution
                        results
                      properties:
                        customResult:
                          properties:
                            actionType:
                              type: string
                            output:
                              additionalProperties:
                                type: string
                              type: object
                          required:
                          - actionType
                          - output
                          type: object
                        executionTime:
                          type: string
                        resourcesAffected:
                          description: Common result metadata
                          items:
                            properties:
                              changeType:
                                type: string
                              name:
                                type: string
                              namespace:
                                type: string
                              resourceType:
                                type: string
                            required:
                            - changeType
                            - name
                            - namespace
                            - resourceType
                            type: object
                          type: array
                        restartResult:
                          properties:
                            namespace:
                              type: string
                            podsRestarted:
                              type: integer
                            restartedPods:
                              items:
                                type: string
                              type: array
                          required:
                          - namespace
                          - podsRestarted
                          - restartedPods
                          type: object
                        scaleResult:
                          description: Action-specific results (discriminated union
                            - only one populated)
                          properties:
                            newReplicas:
                              format: int32
                              type: integer
                            previousReplicas:
                              format: int32
                              type: integer
                            scaledDeployment:
                              type: string
                            scaledNamespace:
                              type: string
                          required:
                          - newReplicas
                          - previousReplicas
                          - scaledDeployment
                          - scaledNamespace
                          type: object
                        success:
                          type: boolean
                        updateResult:
                          properties:
                            namespace:
                              type: string
                            newValue:
                              type: string
                            previousValue:
                              type: string
                            resourceName:
                              type: string
                            resourceType:
                              type: string
                            updateType:
                              type: string
                          required:
                          - namespace
                          - resourceName
                          - resourceType
                          - updateType
                          type: object
                        warnings:
                          items:
                            type: string
                          type: array
                      required:
                      - executionTime
                      - success
                      type: object
                    retriesAttempted:
                      minimum: 0
                      type: integer
                    startTime:
                      format: date-time
                      type: string
                    status:
                      enum:
                      - pending
                      - executing
                      - completed
                      - failed
                      - rolled_back
                      - skipped
                      type: string
                    stepNumber:
                      type: integer
                  required:
                  - action
                  - status
                  - stepNumber
                  type: object
                type: array
              totalSteps:
                minimum: 0
                type: integer
              validationResults:
                description: ValidationResults from validation phase
                properties:
                  approvalReceived:
                    type: boolean
                  approvalTimestamp:
                    format: date-time
                    type: string
                  dryRunPerformed:
                    type: boolean
                  dryRunResults:
                    description: DryRunResults contains structured dry-run execution
                      results
                    properties:
                      executionTime:
                        type: string
                      overallSuccess:
                        type: boolean
                      potentialIssues:
                        items:
                          properties:
                            description:
                              type: string
                            recommendation:
                              type: string
                            severity:
                              type: string
                            stepNumber:
                              type: integer
                          required:
                          - description
                          - severity
                          type: object
                        type: array
                      resourceChanges:
                        items:
                          properties:
                            afterState:
                              additionalProperties:
                                type: string
                              type: object
                            beforeState:
                              additionalProperties:
                                type: string
                              type: object
                            changeType:
                              type: string
                            namespace:
                              type: string
                            resourceName:
                              type: string
                            resourceType:
                              type: string
                          required:
                          - afterState
                          - beforeState
                          - changeType
                          - namespace
                          - resourceName
                          - resourceType
                          type: object
                        type: array
                      stepResults:
                        items:
                          properties:
                            action:
                              type: string
                            simulatedDuration:
                              type: string
                            stepNumber:
                              type: integer
                            validationErrors:
                              items:
                                type: string
                              type: array
                            wouldSucceed:
                              type: boolean
                          required:
                          - action
                          - simulatedDuration
                          - stepNumber
                          - wouldSucceed
                          type: object
                        type: array
                      stepsSimulated:
                        type: integer
                    required:
                    - executionTime
                    - overallSuccess
                    - stepResults
                    - stepsSimulated
                    type: object
                  safetyChecksPassed:
                    type: boolean
                  validationErrors:
                    items:
                      type: string
                    type: array
                required:
                - approvalReceived
                - dryRunPerformed
                - safetyChecksPassed
                type: object
              validationStartTime:
                format: date-time
                type: string
              workflowResult:
                description: WorkflowResult final outcome
                properties:
                  effectivenessScore:
                    type: number
                  newAlertsTriggered:
                    type: boolean
                  outcome:
                    type: string
                  recommendedActions:
                    items:
                      type: string
                    type: array
                  resourceHealth:
                    type: string
                required:
                - effectivenessScore
                - newAlertsTriggered
                - outcome
                - resourceHealth
                type: object
            required:
            - currentStep
            - phase
            - totalSteps
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
