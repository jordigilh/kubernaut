[tool:pytest]
# Pytest configuration for HolmesGPT API tests

# Test discovery
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Test directories
testpaths = tests

# Minimum Python version
minversion = 6.0

# Add current directory to Python path
addopts =
    --strict-markers
    --strict-config
    --verbose
    --tb=short
    --cov=app
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-report=xml
    --cov-fail-under=80
    --durations=10
    --asyncio-mode=auto

# Custom markers
markers =
    unit: Unit tests that don't require external dependencies
    integration: Integration tests that may require external services
    e2e: End-to-end tests that require full application stack
    slow: Tests that take longer than 5 seconds to run

    # Component-specific markers
    config: Configuration-related tests
    models: Data model validation tests
    metrics: Metrics collection tests
    logging: Logging functionality tests
    service: Service layer tests
    wrapper: HolmesGPT wrapper tests
    api: API endpoint tests

    # Feature-specific markers
    health: Health check tests
    auth: Authentication/authorization tests
    error_handling: Error handling tests
    performance: Performance-related tests
    security: Security-related tests

# Async support
asyncio_mode = auto

# Filter warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning:aiohttp.*
    ignore::UserWarning:asyncio.*
    ignore::RuntimeWarning:asyncio.*

# Log configuration for tests
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Environment variables for tests
env =
    ENVIRONMENT = test
    DEBUG_MODE = true
    LOG_LEVEL = DEBUG
    METRICS_ENABLED = false
    CACHE_ENABLED = false
    HOLMES_CLI_FALLBACK = false
    HOLMES_DIRECT_IMPORT = true
    HOLMES_ENABLE_DEBUG = true
    PYTEST_RUNNING = true

