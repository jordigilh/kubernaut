kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  # Expose Data Storage NodePort to host machine
  # This eliminates kubectl port-forward instability
  # Per DD-TEST-001: E2E tests use 25433-28139 range
  extraPortMappings:
  - containerPort: 30081  # Data Storage NodePort in cluster
    hostPort: 28090       # Port on host machine (localhost:28090) - Per DD-TEST-001
    protocol: TCP
  - containerPort: 30432  # PostgreSQL NodePort in cluster
    hostPort: 25433       # Port on host machine (localhost:25433) - Per DD-TEST-001
    protocol: TCP
  # DD-TEST-007: Mount coverage directory for E2E coverage collection
  extraMounts:
  - hostPath: ./coverdata
    containerPath: /coverdata
    readOnly: false
  kubeadmConfigPatches:
  - |
    kind: ClusterConfiguration
    apiServer:
      extraArgs:
        # Increase API server rate limits for parallel integration testing
        # Default max-requests-inflight: 400
        # Default max-mutating-requests-inflight: 200
        # With 4 parallel test processes Ã— 100 concurrent requests = 400 QPS
        # These limits provide 2x headroom for test stability
        max-requests-inflight: "800"
        max-mutating-requests-inflight: "400"
    controllerManager:
      extraArgs:
        # Increase controller manager QPS for CRD operations
        # Default kube-api-qps: 20, kube-api-burst: 30
        # Higher limits prevent CRD creation delays during parallel testing
        kube-api-qps: "100"
        kube-api-burst: "200"

