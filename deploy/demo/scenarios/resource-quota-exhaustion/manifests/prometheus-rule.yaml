apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: kubernaut-quota-rules
  namespace: demo-quota
  labels:
    release: prometheus
spec:
  groups:
  - name: kubernaut-resource-quota
    rules:
    - alert: KubeResourceQuotaExhausted
      expr: |
        max by (replicaset, namespace) (
          (kube_replicaset_spec_replicas{namespace="demo-quota"} > 0)
          unless on(replicaset, namespace)
          (kube_replicaset_status_replicas{namespace="demo-quota"} > 0)
        )
      for: 1m
      labels:
        severity: warning
      annotations:
        summary: >
          ReplicaSet {{ $labels.replicaset }} in namespace {{ $labels.namespace }}
          wants pods but has zero running. ResourceQuota likely prevents creation.
        description: >
          A ReplicaSet in the demo-quota namespace has desired replicas but zero
          actual replicas. This occurs when ResourceQuota prevents pod creation
          at admission (FailedCreate). Pods never reach Pending state.
          Check: kubectl describe quota -n demo-quota && kubectl describe rs {{ $labels.replicaset }} -n demo-quota
