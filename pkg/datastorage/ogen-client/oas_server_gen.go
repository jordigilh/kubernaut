// Code generated by ogen, DO NOT EDIT.

package api

import (
	"context"
)

// Handler handles operations described by OpenAPI v3 specification.
type Handler interface {
	// CreateAuditEvent implements createAuditEvent operation.
	//
	// Persists a unified audit event to the audit_events table (ADR-034).
	// **Business Requirement**: BR-STORAGE-033 (Unified audit trail)
	// **Behavior**:
	// - Success: Returns 201 Created with event_id
	// - Validation Error: Returns 400 Bad Request (RFC 7807)
	// - Database Error: Returns 202 Accepted (DLQ fallback, DD-009).
	//
	// POST /api/v1/audit/events
	CreateAuditEvent(ctx context.Context, req *AuditEventRequest) (CreateAuditEventRes, error)
	// CreateAuditEventsBatch implements createAuditEventsBatch operation.
	//
	// Write multiple audit events in a single request.
	//
	// POST /api/v1/audit/events/batch
	CreateAuditEventsBatch(ctx context.Context, req []AuditEventRequest) (*BatchAuditEventResponse, error)
	// CreateNotificationAudit implements createNotificationAudit operation.
	//
	// Persists a notification delivery attempt audit record.
	// **Business Requirement**: BR-STORAGE-001 (Notification audit persistence)
	// **Behavior**:
	// - Success: Returns 201 Created with created record
	// - Validation Error: Returns 400 Bad Request (RFC 7807)
	// - Duplicate: Returns 409 Conflict (RFC 7807)
	// - Database Error: Returns 202 Accepted (DLQ fallback, DD-009)
	// **Metrics Emitted** (GAP-10):
	// - `datastorage_audit_traces_total{service="notification", status="success|failure|dlq_fallback"}`
	// - `datastorage_audit_lag_seconds{service="notification"}`
	// - `datastorage_write_duration_seconds{table="notification_audit"}`
	// - `datastorage_validation_failures_total{field="...", reason="..."}`.
	//
	// POST /api/v1/audit/notifications
	CreateNotificationAudit(ctx context.Context, req *NotificationAudit) (CreateNotificationAuditRes, error)
	// CreateWorkflow implements createWorkflow operation.
	//
	// Create a new workflow in the catalog.
	// **Business Requirement**: BR-STORAGE-014 (Workflow Catalog Management)
	// **Design Decision**: DD-WORKFLOW-005 v1.0 (Direct REST API workflow registration).
	//
	// POST /api/v1/workflows
	CreateWorkflow(ctx context.Context, req *RemediationWorkflow) (CreateWorkflowRes, error)
	// DisableWorkflow implements disableWorkflow operation.
	//
	// Convenience endpoint to disable a workflow (soft delete).
	// Sets status to 'disabled' with timestamp and reason.
	// **Design Decision**: DD-WORKFLOW-012 (Convenience endpoint for soft-delete).
	//
	// PATCH /api/v1/workflows/{workflow_id}/disable
	DisableWorkflow(ctx context.Context, req OptWorkflowDisableRequest, params DisableWorkflowParams) (DisableWorkflowRes, error)
	// ExportAuditEvents implements exportAuditEvents operation.
	//
	// Exports audit events matching the specified filters with cryptographic signatures
	// for tamper detection and compliance verification.
	// **Business Requirement**: BR-AUDIT-007 (Audit Export)
	// **SOC2 Requirements**: CC8.1 (Audit Export), AU-9 (Audit Protection)
	// **Behavior**:
	// - Success: Returns 200 OK with signed export (JSON or CSV)
	// - Validation Error: Returns 400 Bad Request (invalid date range, etc.)
	// - Unauthorized: Returns 401 if X-Auth-Request-User header missing
	// - Too Many Records: Returns 413 Payload Too Large (>10,000 events, use pagination)
	// **Authorization**: Requires X-Auth-Request-User header (oauth-proxy authenticated)
	// **Export Formats**:
	// - JSON: Complete event data with hash chain verification
	// - CSV: Flattened tabular format for spreadsheet analysis
	// **Hash Chain Verification**:
	// - Each export includes hash chain integrity status
	// - Tampered events flagged with `hash_chain_valid: false`
	// - Chain verification performed at export time
	// **Digital Signature**:
	// - Export signed with service x509 certificate
	// - Signature included in `export_metadata.signature` field
	// - Detached signature available via `include_detached_signature=true`
	// **Pagination**:
	// - Use `offset` and `limit` for large result sets
	// - Maximum limit: 10,000 events per export
	// - Signature covers ALL pages (use same query for verification)
	// **Metrics Emitted**:
	// - `datastorage_export_successes_total{format="json|csv"}`
	// - `datastorage_export_failures_total{reason="unauthorized|validation|..."}`.
	//
	// GET /api/v1/audit/export
	ExportAuditEvents(ctx context.Context, params ExportAuditEventsParams) (ExportAuditEventsRes, error)
	// GetMetrics implements getMetrics operation.
	//
	// Exposes Prometheus metrics in text format.
	// **Metrics Exposed** (BR-STORAGE-019, GAP-10):
	// - `datastorage_audit_traces_total{service,status}` - Audit write operations
	// - `datastorage_audit_lag_seconds{service}` - Time between event and audit write
	// - `datastorage_write_duration_seconds{table}` - Database write latency
	// - `datastorage_validation_failures_total{field,reason}` - Validation errors.
	//
	// GET /metrics
	GetMetrics(ctx context.Context) (GetMetricsOK, error)
	// GetWorkflowByID implements getWorkflowByID operation.
	//
	// Retrieve a specific workflow by its UUID.
	// **Design Decision**: DD-WORKFLOW-002 v3.0 (UUID primary key).
	//
	// GET /api/v1/workflows/{workflow_id}
	GetWorkflowByID(ctx context.Context, params GetWorkflowByIDParams) (GetWorkflowByIDRes, error)
	// HealthCheck implements healthCheck operation.
	//
	// Returns 200 if service is healthy (database and Redis reachable).
	// Used by Kubernetes liveness probe (DD-007).
	//
	// GET /health
	HealthCheck(ctx context.Context) (HealthCheckRes, error)
	// ListLegalHolds implements listLegalHolds operation.
	//
	// Returns a list of all active legal holds across all audit events.
	// **Business Requirement**: BR-AUDIT-006 (Legal Hold & Retention)
	// **SOC2 Gap**: Gap #8 (Legal Hold enforcement)
	// **Behavior**:
	// - Success: Returns 200 OK with array of active legal holds
	// - No holds: Returns empty array
	// **Authorization**: No authentication required (read-only operation)
	// **Metrics Emitted**:
	// - `datastorage_legal_hold_successes_total{operation="list"}`.
	//
	// GET /api/v1/audit/legal-hold
	ListLegalHolds(ctx context.Context) (*ListLegalHoldsOK, error)
	// ListWorkflows implements listWorkflows operation.
	//
	// List workflows with optional filters and pagination.
	// **Business Requirement**: BR-STORAGE-014 (Workflow Catalog Management).
	//
	// GET /api/v1/workflows
	ListWorkflows(ctx context.Context, params ListWorkflowsParams) (ListWorkflowsRes, error)
	// LivenessCheck implements livenessCheck operation.
	//
	// Returns 200 if service process is alive.
	// Does not check dependencies.
	// Used by Kubernetes liveness probe.
	//
	// GET /health/live
	LivenessCheck(ctx context.Context) error
	// PlaceLegalHold implements placeLegalHold operation.
	//
	// Places a legal hold on all audit events for a given correlation_id.
	// Events with legal hold cannot be deleted (enforced by database trigger).
	// **Business Requirement**: BR-AUDIT-006 (Legal Hold & Retention)
	// **SOC2 Gap**: Gap #8 (Legal Hold enforcement for Sarbanes-Oxley, HIPAA)
	// **Behavior**:
	// - Success: Returns 200 OK with legal hold metadata
	// - Validation Error: Returns 400 Bad Request (RFC 7807)
	// - Not Found: Returns 404 Not Found if correlation_id doesn't exist
	// - Unauthorized: Returns 401 if X-User-ID header missing
	// **Authorization**: Requires X-User-ID header to track who placed the hold
	// **Metrics Emitted**:
	// - `datastorage_legal_hold_successes_total{operation="place"}`
	// - `datastorage_legal_hold_failures_total{reason="missing_correlation_id|unauthorized|..."}`.
	//
	// POST /api/v1/audit/legal-hold
	PlaceLegalHold(ctx context.Context, req *PlaceLegalHoldReq) (PlaceLegalHoldRes, error)
	// QueryAuditEvents implements queryAuditEvents operation.
	//
	// Query audit events with filters and pagination.
	//
	// GET /api/v1/audit/events
	QueryAuditEvents(ctx context.Context, params QueryAuditEventsParams) (*AuditEventsQueryResponse, error)
	// ReadinessCheck implements readinessCheck operation.
	//
	// Returns 200 if service is ready to accept traffic.
	// Returns 503 during graceful shutdown (DD-007 4-step pattern).
	// Used by Kubernetes readiness probe.
	//
	// GET /health/ready
	ReadinessCheck(ctx context.Context) (ReadinessCheckRes, error)
	// ReconstructRemediationRequest implements reconstructRemediationRequest operation.
	//
	// Reconstructs a complete RemediationRequest CRD from audit trail events.
	// **Business Requirement**: BR-AUDIT-006 (SOC2 compliance)
	// **Workflow**:
	// 1. Query audit events for given correlation_id
	// 2. Parse gateway and orchestrator events
	// 3. Map audit data to RR Spec/Status fields
	// 4. Build complete Kubernetes-compliant CRD
	// 5. Validate completeness and quality
	// **Use Cases**:
	// - Disaster recovery (recreate lost RRs from audit trail)
	// - Compliance audits (prove RR state at any point in time)
	// - Debugging (understand RR evolution from audit events)
	// **Returns**:
	// - Reconstructed RR in YAML format
	// - Validation result (completeness percentage, warnings, errors)
	// **Authentication**: Protected by OAuth-proxy in production/E2E.
	// Integration tests use mock X-Auth-Request-User header.
	//
	// POST /api/v1/audit/remediation-requests/{correlation_id}/reconstruct
	ReconstructRemediationRequest(ctx context.Context, params ReconstructRemediationRequestParams) (ReconstructRemediationRequestRes, error)
	// ReleaseLegalHold implements releaseLegalHold operation.
	//
	// Releases a legal hold on all audit events for a given correlation_id.
	// Events can be deleted after legal hold is released.
	// **Business Requirement**: BR-AUDIT-006 (Legal Hold & Retention)
	// **SOC2 Gap**: Gap #8 (Legal Hold enforcement)
	// **Behavior**:
	// - Success: Returns 200 OK with release metadata
	// - Validation Error: Returns 400 Bad Request (RFC 7807)
	// - Not Found: Returns 404 Not Found if legal hold doesn't exist
	// - Unauthorized: Returns 401 if X-User-ID header missing
	// **Authorization**: Requires X-User-ID header to track who released the hold
	// **Metrics Emitted**:
	// - `datastorage_legal_hold_successes_total{operation="release"}`
	// - `datastorage_legal_hold_failures_total{reason="unauthorized|not_found|..."}`.
	//
	// DELETE /api/v1/audit/legal-hold/{correlation_id}
	ReleaseLegalHold(ctx context.Context, req *ReleaseLegalHoldReq, params ReleaseLegalHoldParams) (ReleaseLegalHoldRes, error)
	// SearchWorkflows implements searchWorkflows operation.
	//
	// Search workflows using label-based matching with wildcard support and weighted scoring.
	// **V1.0 Implementation**: Pure SQL label matching (no embeddings/semantic search)
	// **Business Requirement**: BR-STORAGE-013 (Label-Based Workflow Search)
	// **Design Decision**: DD-WORKFLOW-004 v1.5 (Label-Only Scoring with Wildcard Weighting)
	// **Behavior**:
	// - Mandatory filters: signal_type, severity, component, environment, priority
	// - Optional filters: custom_labels, detected_labels
	// - Wildcard support: "*" matches any non-null value
	// - Weighted scoring: Exact matches > Wildcard matches
	// - Returns top_k results sorted by confidence score (0.0-1.0).
	//
	// POST /api/v1/workflows/search
	SearchWorkflows(ctx context.Context, req *WorkflowSearchRequest) (SearchWorkflowsRes, error)
	// UpdateWorkflow implements updateWorkflow operation.
	//
	// Update mutable workflow fields (status, metrics).
	// Immutable fields (description, content, labels) require creating a new version.
	// **Design Decision**: DD-WORKFLOW-012 (Mutable vs Immutable Fields).
	//
	// PATCH /api/v1/workflows/{workflow_id}
	UpdateWorkflow(ctx context.Context, req *WorkflowUpdateRequest, params UpdateWorkflowParams) (UpdateWorkflowRes, error)
}

// Server implements http server based on OpenAPI v3 specification and
// calls Handler to handle requests.
type Server struct {
	h Handler
	baseServer
}

// NewServer creates new Server.
func NewServer(h Handler, opts ...ServerOption) (*Server, error) {
	s, err := newServerConfig(opts...).baseServer()
	if err != nil {
		return nil, err
	}
	return &Server{
		h:          h,
		baseServer: s,
	}, nil
}
