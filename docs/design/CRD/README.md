# CRD Documentation - Redirect to Authoritative Sources

**Status**: All design documents in this directory have been **DEPRECATED** and moved to [`archive/`](archive/)

---

## 🎯 **FOR CURRENT V1 CRD INFORMATION, SEE:**

### **1. Implementation (Source of Truth)** ⭐ PRIMARY

**Go Type Definitions**:
```
api/
├── aianalysis/v1alpha1/aianalysis_types.go
├── kubernetesexecution/v1alpha1/kubernetesexecution_types.go
├── remediation/v1alpha1/remediationrequest_types.go
├── remediationorchestrator/v1alpha1/remediationorchestrator_types.go
├── remediationprocessing/v1alpha1/remediationprocessing_types.go
└── workflowexecution/v1alpha1/workflowexecution_types.go
```

**Why Primary**: These are the actual CRD type definitions that Kubebuilder uses to generate manifests.

---

### **2. Generated CRD Manifests**

**Kubernetes YAML Manifests**:
```
config/crd/bases/
├── aianalysis.kubernaut.io_aianalyses.yaml
├── kubernetesexecution.kubernaut.io_kubernetesexecutions.yaml
├── remediation.kubernaut.io_remediationrequests.yaml
├── remediationorchestrator.kubernaut.io_remediationorchestrators.yaml
├── remediationprocessing.kubernaut.io_remediationprocessings.yaml
└── workflowexecution.kubernaut.io_workflowexecutions.yaml
```

**Generated By**: `make manifests` (Kubebuilder controller-gen)

---

### **3. Schema Documentation**

**Authoritative Schema Documentation**:
- **[`docs/architecture/CRD_SCHEMAS.md`](../../architecture/CRD_SCHEMAS.md)** - Complete OpenAPI v3 schemas for all 6 CRDs

**Purpose**: Human-readable documentation of CRD schemas with business context

---

### **4. Service Specifications (~10,000 lines total)**

**Complete Service Documentation**:
```
docs/services/crd-controllers/
├── 01-remediationprocessor/     (~2,000 lines)
│   ├── README.md                 - Service index
│   ├── crd-schema.md             - CRD expectations
│   ├── controller-implementation.md
│   └── [12 more documents]
│
├── 02-aianalysis/               (~2,500 lines)
│   ├── README.md
│   ├── crd-schema.md
│   ├── prompt-engineering-dependencies.md
│   └── [15 more documents]
│
├── 03-workflowexecution/        (~2,000 lines)
│   ├── README.md
│   ├── crd-schema.md
│   ├── workflow-dependency-resolution.md
│   └── [12 more documents]
│
├── 04-kubernetesexecutor/       (~2,000 lines)
│   ├── README.md
│   ├── crd-schema.md
│   ├── step-validation-pattern.md
│   └── [12 more documents]
│
└── 05-remediationorchestrator/  (~2,806 lines)
    ├── README.md
    ├── crd-schema.md
    ├── data-handling-architecture.md
    └── [12 more documents]
```

**Purpose**: Complete service specifications, controller logic, integration patterns, testing strategies

---

## 🚨 **Why Were Design Documents Deprecated?**

**ALL 5 design documents in `archive/` are severely outdated:**

| Document | Accuracy | Critical Issues |
|----------|----------|-----------------|
| 01_REMEDIATION_REQUEST_CRD.md | ~40% | Wrong CRD name, API group, 18 missing fields |
| 02_REMEDIATION_PROCESSING_CRD.md | ~30% | Missing 18 Phase 1 self-contained fields |
| 03_AI_ANALYSIS_CRD.md | ~50% | Missing LLM-driven patterns, dependency specification |
| 04_WORKFLOW_EXECUTION_CRD.md | ~40% | Missing validation chain, dependency analysis |
| 05_KUBERNETES_EXECUTION_CRD.md | ~40% | Missing step-level validation pattern |

**Common Issues**:
- ⛔ **Wrong CRD names** (e.g., `alertremediations` vs `remediationrequests`)
- ⛔ **Wrong API groups** (e.g., `kubernaut.io` vs `remediation.kubernaut.io`)
- 🟡 **Wrong API version** (`v1` vs `v1alpha1`)
- ⛔ **Deprecated "Alert" terminology** throughout
- 🔴 **Missing V1 architectural patterns** (self-containment, LLM-driven, validation chain)

**See Triage Report**: [`docs/analysis/CRD_DESIGN_DOCUMENTS_COMPREHENSIVE_TRIAGE.md`](../../analysis/CRD_DESIGN_DOCUMENTS_COMPREHENSIVE_TRIAGE.md)

---

## 📚 **CRD Documentation Hierarchy**

**When looking for CRD information, use this order:**

1. **Implementation** → `api/*/v1alpha1/*_types.go` (source of truth)
2. **Manifests** → `config/crd/bases/*.yaml` (what actually deploys)
3. **Schema Docs** → `docs/architecture/CRD_SCHEMAS.md` (readable schemas)
4. **Service Specs** → `docs/services/crd-controllers/*/` (controller implementation details)
5. **Architecture** → `docs/architecture/` (high-level patterns)

**Do NOT use**: `archive/` documents (historical reference only, ~60% incorrect)

---

## 🔗 **Related Documentation**

### **Architecture Decisions**
- [ADR-015: Alert to Signal Naming Migration](../../architecture/decisions/ADR-015-alert-to-signal-naming-migration.md)
- [ADR-016: Validation Responsibility Chain](../../architecture/decisions/ADR-016-validation-responsibility-chain.md)
- [ADR-005: Owner Reference Architecture](../../architecture/decisions/005-owner-reference-architecture.md)

### **Implementation Guides**
- [Phase 1 Implementation Guide](../../analysis/PHASE_1_IMPLEMENTATION_GUIDE.md) - CRD schema updates
- [CRD Schema Update Action Plan](../../analysis/CRD_SCHEMA_UPDATE_ACTION_PLAN.md) - Self-containment pattern

### **System Architecture**
- [Approved Microservices Architecture](../../architecture/APPROVED_MICROSERVICES_ARCHITECTURE.md)
- [V1 Source of Truth Hierarchy](../../V1_SOURCE_OF_TRUTH_HIERARCHY.md)

---

## ⚙️ **Working with CRDs**

### **Generate CRD Manifests**
```bash
# After modifying api/*/v1alpha1/*_types.go:
make manifests

# This generates:
# - config/crd/bases/*.yaml (CRD manifests)
# - api/*/v1alpha1/zz_generated.deepcopy.go (DeepCopy methods)
```

### **Install CRDs to Cluster**
```bash
make install
```

### **Run Controller Manager Locally**
```bash
make run
```

### **Build Controller Manager Image**
```bash
make docker-build IMG=kubernaut-controller:latest
```

---

## 📝 **Document Maintenance**

**Last Updated**: 2025-01-15
**Archive Created**: 2025-01-15
**Reason**: All 5 design documents were 30-70% incorrect for V1 implementation

**Maintainers**: When updating CRD schemas:
1. Update `api/*/v1alpha1/*_types.go` (source of truth)
2. Run `make manifests` to regenerate YAML
3. Update `docs/architecture/CRD_SCHEMAS.md` if needed
4. Update service specs in `docs/services/crd-controllers/*/crd-schema.md`

**Do NOT update** `archive/` documents - they are historical reference only.

---

## 📞 **Questions?**

- **CRD Schema Questions**: See `docs/architecture/CRD_SCHEMAS.md`
- **Controller Implementation**: See `docs/services/crd-controllers/*/`
- **Architecture Decisions**: See `docs/architecture/decisions/`
- **Triage Details**: See `docs/analysis/CRD_DESIGN_DOCUMENTS_COMPREHENSIVE_TRIAGE.md`

---

**Need to implement a CRD controller?** Start with the service README in `docs/services/crd-controllers/*/README.md` 🚀

