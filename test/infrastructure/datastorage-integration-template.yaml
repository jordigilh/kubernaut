# Data Storage Service Configuration Template for Integration Tests
#
# ADR-030: Service Configuration Management
# DD-TEST-001: Port Allocation Strategy
#
# This template is used by all integration test infrastructure code.
# Values in {{BRACKETS}} are replaced at runtime by the infrastructure code.

server:
  port: 8080  # Internal container port
  host: "0.0.0.0"
  readTimeout: "30s"
  writeTimeout: "30s"

logging:
  level: "{{LOG_LEVEL}}"  # Replaced: "info", "debug", "error"
  format: "json"

database:
  host: "{{POSTGRES_HOST}}"  # Replaced: container name or "host.containers.internal"
  port: {{POSTGRES_PORT}}    # Replaced: internal port (5432 for network, or host port)
  name: "{{DB_NAME}}"        # Replaced: database name
  user: "{{DB_USER}}"        # Replaced: database user
  sslMode: "disable"  # Integration tests use insecure connections
  maxOpenConns: 25
  maxIdleConns: 5
  connMaxLifetime: "5m"
  connMaxIdleTime: "5m"
  # ADR-030 Section 6: Secrets loaded from mounted files
  secretsFile: "/etc/datastorage-secrets/database-credentials.yaml"
  passwordKey: "password"

redis:
  addr: "{{REDIS_HOST}}:{{REDIS_PORT}}"  # Replaced: Redis address
  db: {{REDIS_DB}}  # Replaced: Redis database number
  # DD-009: Redis DLQ configuration
  dlqStreamName: "audit:dlq:integration"
  dlqMaxLen: 10000
  dlqConsumerGroup: "datastorage-dlq-integration"
  # ADR-030 Section 6: Secrets loaded from mounted files
  secretsFile: "/etc/datastorage-secrets/redis-credentials.yaml"
  passwordKey: "password"

