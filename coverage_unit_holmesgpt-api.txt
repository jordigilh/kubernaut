============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-7.4.3, pluggy-1.6.0 -- /opt/app-root/bin/python3.12
cachedir: .pytest_cache
rootdir: /workspace/holmesgpt-api
configfile: pytest.ini
plugins: anyio-4.12.1, Faker-20.1.0, xdist-3.5.0, mock-3.12.0, cov-4.1.0, asyncio-0.21.1
asyncio: mode=Mode.AUTO
collecting ... collected 524 items

tests/unit/test_alternative_workflows.py::TestAlternativeWorkflowModel::test_valid_alternative_workflow PASSED [  0%]
tests/unit/test_alternative_workflows.py::TestAlternativeWorkflowModel::test_alternative_workflow_without_container_image PASSED [  0%]
tests/unit/test_alternative_workflows.py::TestAlternativeWorkflowModel::test_confidence_must_be_between_0_and_1 PASSED [  0%]
tests/unit/test_alternative_workflows.py::TestIncidentResponseAlternatives::test_response_includes_alternatives PASSED [  0%]
tests/unit/test_alternative_workflows.py::TestIncidentResponseAlternatives::test_response_defaults_to_empty_alternatives PASSED [  0%]
tests/unit/test_alternative_workflows.py::TestIncidentResponseAlternatives::test_alternatives_serialization PASSED [  1%]
tests/unit/test_alternative_workflows.py::TestAlternativeWorkflowsPurpose::test_alternatives_are_informational_only PASSED [  1%]
tests/unit/test_alternative_workflows.py::TestAlternativeWorkflowsPurpose::test_alternatives_provide_audit_trail PASSED [  1%]
tests/unit/test_audit_event_structure.py::TestAuditEventStructure::test_llm_request_event_structure PASSED [  1%]
tests/unit/test_audit_event_structure.py::TestAuditEventStructure::test_llm_response_event_structure PASSED [  1%]
tests/unit/test_audit_event_structure.py::TestAuditEventStructure::test_llm_response_failure_outcome PASSED [  2%]
tests/unit/test_audit_event_structure.py::TestAuditEventStructure::test_validation_attempt_event_structure PASSED [  2%]
tests/unit/test_audit_event_structure.py::TestAuditEventStructure::test_validation_attempt_final_attempt_flag PASSED [  2%]
tests/unit/test_audit_event_structure.py::TestAuditEventStructure::test_tool_call_event_structure PASSED [  2%]
tests/unit/test_audit_event_structure.py::TestAuditEventStructure::test_correlation_id_uses_remediation_id PASSED [  2%]
tests/unit/test_audit_event_structure.py::TestAuditEventStructure::test_empty_remediation_id_handled PASSED [  3%]
tests/unit/test_auth_middleware.py::TestAuthenticationMiddlewareInit::test_initialization_with_dev_mode PASSED [  3%]
tests/unit/test_auth_middleware.py::TestAuthenticationMiddlewareInit::test_initialization_without_dev_mode PASSED [  3%]
tests/unit/test_auth_middleware.py::TestAuthenticationMiddlewareInit::test_initialization_dev_mode_default PASSED [  3%]
tests/unit/test_auth_middleware.py::TestAuthenticationMiddlewareInit::test_public_endpoints_defined PASSED [  3%]
tests/unit/test_auth_middleware.py::TestPublicEndpointBypass::test_health_endpoint_bypasses_auth PASSED [  4%]
tests/unit/test_auth_middleware.py::TestPublicEndpointBypass::test_ready_endpoint_bypasses_auth PASSED [  4%]
tests/unit/test_auth_middleware.py::TestPublicEndpointBypass::test_docs_endpoint_bypasses_auth PASSED [  4%]
tests/unit/test_auth_middleware.py::TestBearerTokenExtraction::test_extract_bearer_token_success PASSED [  4%]
tests/unit/test_auth_middleware.py::TestBearerTokenExtraction::test_no_authorization_header PASSED [  4%]
tests/unit/test_auth_middleware.py::TestBearerTokenExtraction::test_invalid_authorization_format PASSED [  4%]
tests/unit/test_auth_middleware.py::TestPermissionChecking::test_authenticated_user_has_permission PASSED [  5%]
tests/unit/test_auth_middleware.py::TestPermissionChecking::test_permission_denied_returns_403 PASSED [  5%]
tests/unit/test_auth_middleware.py::TestErrorHandling::test_http_exception_returns_json_response PASSED [  5%]
tests/unit/test_auth_middleware.py::TestErrorHandling::test_generic_exception_returns_500 FAILED [  5%]
tests/unit/test_br_hapi_192_natural_language_summary.py::TestPreviousExecutionNaturalLanguageSummary::test_previous_execution_accepts_natural_language_summary PASSED [  5%]
tests/unit/test_br_hapi_192_natural_language_summary.py::TestPreviousExecutionNaturalLanguageSummary::test_natural_language_summary_is_optional PASSED [  6%]
tests/unit/test_br_hapi_192_natural_language_summary.py::TestPreviousExecutionNaturalLanguageSummary::test_natural_language_summary_serialization PASSED [  6%]
tests/unit/test_br_hapi_192_natural_language_summary.py::TestRecoveryRequestWithNaturalLanguageSummary::test_recovery_request_with_full_context PASSED [  6%]
tests/unit/test_br_hapi_192_natural_language_summary.py::TestRecoveryPromptInclusion::test_recovery_prompt_includes_natural_language_summary PASSED [  6%]
tests/unit/test_br_hapi_192_natural_language_summary.py::TestRecoveryPromptInclusion::test_recovery_prompt_without_natural_language_summary PASSED [  6%]
tests/unit/test_br_hapi_192_natural_language_summary.py::TestRecoveryResponseWarnings::test_warning_when_recovery_without_summary PASSED [  7%]
tests/unit/test_config_manager.py::TestConfigManagerInitialization::test_config_manager_loads_initial_config PASSED [  7%]
tests/unit/test_config_manager.py::TestConfigManagerInitialization::test_config_manager_uses_defaults_for_missing_fields PASSED [  7%]
tests/unit/test_config_manager.py::TestConfigManagerInitialization::test_config_manager_stop_cleanup PASSED [  7%]
tests/unit/test_config_manager.py::TestConfigManagerGetters::test_get_llm_model PASSED [  7%]
tests/unit/test_config_manager.py::TestConfigManagerGetters::test_get_llm_provider PASSED [  8%]
tests/unit/test_config_manager.py::TestConfigManagerGetters::test_get_llm_endpoint PASSED [  8%]
tests/unit/test_config_manager.py::TestConfigManagerGetters::test_get_llm_max_retries PASSED [  8%]
tests/unit/test_config_manager.py::TestConfigManagerGetters::test_get_llm_timeout PASSED [  8%]
tests/unit/test_config_manager.py::TestConfigManagerGetters::test_get_llm_temperature PASSED [  8%]
tests/unit/test_config_manager.py::TestConfigManagerGetters::test_get_toolsets PASSED [  8%]
tests/unit/test_config_manager.py::TestConfigManagerGetters::test_get_log_level PASSED [  9%]
tests/unit/test_config_manager.py::TestConfigManagerGetters::test_get_raw_config PASSED [  9%]
tests/unit/test_config_manager.py::TestConfigManagerHotReload::test_config_reload_updates_values PASSED [  9%]
tests/unit/test_config_manager.py::TestConfigManagerHotReload::test_invalid_yaml_keeps_previous_config PASSED [  9%]
tests/unit/test_config_manager.py::TestConfigManagerThreadSafety::test_concurrent_reads_are_safe PASSED [  9%]
tests/unit/test_config_manager.py::TestConfigManagerMetrics::test_reload_count_increments PASSED [ 10%]
tests/unit/test_config_manager.py::TestConfigManagerMetrics::test_last_hash_updates PASSED [ 10%]
tests/unit/test_config_manager.py::TestConfigManagerDisableHotReload::test_disable_hot_reload PASSED [ 10%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestSearchWorkflowCatalogToolCustomLabels::test_constructor_accepts_custom_labels PASSED [ 10%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestSearchWorkflowCatalogToolCustomLabels::test_constructor_defaults_to_empty_dict PASSED [ 10%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestSearchWorkflowCatalogToolCustomLabels::test_constructor_handles_none_custom_labels PASSED [ 11%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestSearchWorkflowCatalogToolCustomLabels::test_auto_append_custom_labels_to_filters PASSED [ 11%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestSearchWorkflowCatalogToolCustomLabels::test_empty_custom_labels_not_appended PASSED [ 11%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestSearchWorkflowCatalogToolCustomLabels::test_custom_labels_structure_preserved PASSED [ 11%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestSearchWorkflowCatalogToolCustomLabels::test_custom_labels_with_boolean_and_keyvalue_formats PASSED [ 11%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestWorkflowCatalogToolsetCustomLabels::test_toolset_accepts_custom_labels PASSED [ 12%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestWorkflowCatalogToolsetCustomLabels::test_toolset_passes_custom_labels_to_tool PASSED [ 12%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestWorkflowCatalogToolsetCustomLabels::test_toolset_handles_none_custom_labels PASSED [ 12%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestWorkflowCatalogToolsetCustomLabels::test_toolset_defaults_custom_labels_to_none PASSED [ 12%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestCustomLabelsTypeModel::test_custom_labels_type_is_dict_str_list_str PASSED [ 12%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestCustomLabelsTypeModel::test_enrichment_results_custom_labels_default_none PASSED [ 12%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestCustomLabelsTypeModel::test_enrichment_results_custom_labels_empty_dict PASSED [ 13%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestCustomLabelsTypeModel::test_enrichment_results_custom_labels_complex_structure PASSED [ 13%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestRegisterWorkflowCatalogToolsetCustomLabels::test_register_accepts_custom_labels_parameter PASSED [ 13%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestRegisterWorkflowCatalogToolsetCustomLabels::test_register_custom_labels_default_none PASSED [ 13%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestSearchWorkflowCatalogToolDetectedLabels::test_constructor_accepts_detected_labels PASSED [ 13%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestSearchWorkflowCatalogToolDetectedLabels::test_constructor_defaults_detected_labels_to_none PASSED [ 14%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestSearchWorkflowCatalogToolDetectedLabels::test_constructor_handles_none_detected_labels PASSED [ 14%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestSearchWorkflowCatalogToolDetectedLabels::test_auto_append_detected_labels_to_filters PASSED [ 14%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestSearchWorkflowCatalogToolDetectedLabels::test_empty_detected_labels_not_appended PASSED [ 14%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestSearchWorkflowCatalogToolDetectedLabels::test_detected_labels_boolean_and_string_types PASSED [ 14%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestSearchWorkflowCatalogToolDetectedLabels::test_both_custom_and_detected_labels_appended PASSED [ 15%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestWorkflowCatalogToolsetDetectedLabels::test_toolset_accepts_detected_labels PASSED [ 15%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestWorkflowCatalogToolsetDetectedLabels::test_toolset_passes_detected_labels_to_tool PASSED [ 15%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestWorkflowCatalogToolsetDetectedLabels::test_toolset_handles_none_detected_labels PASSED [ 15%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestWorkflowCatalogToolsetDetectedLabels::test_toolset_defaults_detected_labels_to_none PASSED [ 15%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestWorkflowCatalogToolsetDetectedLabels::test_toolset_accepts_both_labels PASSED [ 16%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestRegisterWorkflowCatalogToolsetDetectedLabels::test_register_accepts_detected_labels_parameter PASSED [ 16%]
tests/unit/test_custom_labels_auto_append_dd_hapi_001.py::TestRegisterWorkflowCatalogToolsetDetectedLabels::test_register_detected_labels_default_none PASSED [ 16%]
tests/unit/test_custom_labels_validation.py::TestCustomLabelsModelValidation::test_custom_labels_subdomain_structure_validated PASSED [ 16%]
tests/unit/test_custom_labels_validation.py::TestCustomLabelsModelValidation::test_custom_labels_boolean_and_keyvalue_formats PASSED [ 16%]
tests/unit/test_errors.py::TestHolmesGPTAPIError::test_init_with_message_only PASSED [ 16%]
tests/unit/test_errors.py::TestHolmesGPTAPIError::test_init_with_details PASSED [ 17%]
tests/unit/test_errors.py::TestHolmesGPTAPIError::test_timestamp_is_recent PASSED [ 17%]
tests/unit/test_errors.py::TestHolmesGPTAPIError::test_exception_inheritance PASSED [ 17%]
tests/unit/test_errors.py::TestAuthenticationError::test_inherits_from_base_error PASSED [ 17%]
tests/unit/test_errors.py::TestAuthenticationError::test_can_be_raised_and_caught PASSED [ 17%]
tests/unit/test_errors.py::TestAuthorizationError::test_inherits_from_base_error PASSED [ 18%]
tests/unit/test_errors.py::TestAuthorizationError::test_with_permission_details PASSED [ 18%]
tests/unit/test_errors.py::TestKubernetesAPIError::test_inherits_from_base_error PASSED [ 18%]
tests/unit/test_errors.py::TestKubernetesAPIError::test_with_k8s_error_details PASSED [ 18%]
tests/unit/test_errors.py::TestCircuitBreakerOpenError::test_inherits_from_base_error PASSED [ 18%]
tests/unit/test_errors.py::TestCircuitBreakerOpenError::test_with_circuit_breaker_state PASSED [ 19%]
tests/unit/test_errors.py::TestMaxRetriesExceededError::test_inherits_from_base_error PASSED [ 19%]
tests/unit/test_errors.py::TestMaxRetriesExceededError::test_with_retry_details PASSED [ 19%]
tests/unit/test_errors.py::TestValidationError::test_inherits_from_base_error PASSED [ 19%]
tests/unit/test_errors.py::TestValidationError::test_with_validation_details PASSED [ 19%]
tests/unit/test_errors.py::TestSDKError::test_inherits_from_base_error PASSED [ 20%]
tests/unit/test_errors.py::TestSDKError::test_with_sdk_error_details PASSED [ 20%]
tests/unit/test_errors.py::TestCircuitBreaker::test_initialization PASSED [ 20%]
tests/unit/test_errors.py::TestCircuitBreaker::test_successful_call_when_closed PASSED [ 20%]
tests/unit/test_errors.py::TestCircuitBreaker::test_failure_increments_count PASSED [ 20%]
tests/unit/test_errors.py::TestCircuitBreaker::test_circuit_opens_after_threshold PASSED [ 20%]
tests/unit/test_errors.py::TestCircuitBreaker::test_open_circuit_raises_circuit_breaker_error PASSED [ 21%]
tests/unit/test_errors.py::TestCircuitBreaker::test_half_open_after_recovery_timeout PASSED [ 21%]
tests/unit/test_errors.py::TestCircuitBreaker::test_half_open_to_closed_on_success PASSED [ 21%]
tests/unit/test_errors.py::TestCircuitBreaker::test_custom_expected_exception PASSED [ 21%]
tests/unit/test_errors.py::TestRetryWithBackoff::test_successful_call_no_retry PASSED [ 21%]
tests/unit/test_errors.py::TestRetryWithBackoff::test_retries_on_failure PASSED [ 22%]
tests/unit/test_errors.py::TestRetryWithBackoff::test_raises_max_retries_exceeded PASSED [ 22%]
tests/unit/test_errors.py::TestRetryWithBackoff::test_exponential_backoff_timing PASSED [ 22%]
tests/unit/test_errors.py::TestRetryWithBackoff::test_custom_exception_types PASSED [ 22%]
tests/unit/test_errors.py::TestRetryWithBackoff::test_backoff_factor_zero PASSED [ 22%]
tests/unit/test_errors.py::TestErrorSerialization::test_error_dict_representation PASSED [ 23%]
tests/unit/test_errors.py::TestErrorSerialization::test_nested_exception_details PASSED [ 23%]
tests/unit/test_errors.py::TestEdgeCases::test_empty_details_dict PASSED [ 23%]
tests/unit/test_errors.py::TestEdgeCases::test_none_details PASSED       [ 23%]
tests/unit/test_errors.py::TestEdgeCases::test_very_long_error_message PASSED [ 23%]
tests/unit/test_errors.py::TestEdgeCases::test_circuit_breaker_zero_threshold PASSED [ 24%]
tests/unit/test_errors.py::TestEdgeCases::test_circuit_breaker_negative_timeout PASSED [ 24%]
tests/unit/test_failed_detections_filtering.py::TestMCPFilterInstructionsFailedDetections::test_mcp_filter_excludes_single_failed_detection PASSED [ 24%]
tests/unit/test_failed_detections_filtering.py::TestMCPFilterInstructionsFailedDetections::test_mcp_filter_excludes_multiple_failed_detections PASSED [ 24%]
tests/unit/test_failed_detections_filtering.py::TestMCPFilterInstructionsFailedDetections::test_mcp_filter_includes_all_when_no_failed_detections PASSED [ 24%]
tests/unit/test_failed_detections_filtering.py::TestMCPFilterInstructionsFailedDetections::test_mcp_filter_handles_missing_failed_detections_key PASSED [ 25%]
tests/unit/test_failed_detections_filtering.py::TestMCPFilterInstructionsFailedDetections::test_mcp_filter_excludes_gitops_when_detection_failed PASSED [ 25%]
tests/unit/test_failed_detections_filtering.py::TestClusterContextSectionFailedDetections::test_cluster_context_excludes_pdb_when_detection_failed PASSED [ 25%]
tests/unit/test_failed_detections_filtering.py::TestClusterContextSectionFailedDetections::test_cluster_context_excludes_gitops_when_detection_failed PASSED [ 25%]
tests/unit/test_failed_detections_filtering.py::TestClusterContextSectionFailedDetections::test_cluster_context_excludes_stateful_when_detection_failed PASSED [ 25%]
tests/unit/test_failed_detections_filtering.py::TestClusterContextSectionFailedDetections::test_cluster_context_includes_all_when_no_failed_detections PASSED [ 25%]
tests/unit/test_failed_detections_filtering.py::TestSearchWorkflowsFailedDetections::test_search_workflows_strips_failed_detection_fields PASSED [ 26%]
tests/unit/test_failed_detections_filtering.py::TestSearchWorkflowsFailedDetections::test_search_workflows_strips_multiple_failed_detections PASSED [ 26%]
tests/unit/test_failed_detections_filtering.py::TestSearchWorkflowsFailedDetections::test_search_workflows_preserves_all_when_no_failures PASSED [ 26%]
tests/unit/test_failed_detections_filtering.py::TestSearchWorkflowsFailedDetections::test_search_workflows_handles_missing_failed_detections_key PASSED [ 26%]
tests/unit/test_failed_detections_filtering.py::TestRecoveryMCPFilterFailedDetections::test_recovery_mcp_filter_excludes_failed_detections PASSED [ 26%]
tests/unit/test_failed_detections_filtering.py::TestRecoveryClusterContextFailedDetections::test_recovery_cluster_context_excludes_failed_detections PASSED [ 27%]
tests/unit/test_file_watcher.py::TestFileWatcherInitialization::test_file_watcher_initial_load_calls_callback PASSED [ 27%]
tests/unit/test_file_watcher.py::TestFileWatcherInitialization::test_file_watcher_raises_on_missing_file PASSED [ 27%]
tests/unit/test_file_watcher.py::TestFileWatcherInitialization::test_file_watcher_stop_cleanup PASSED [ 27%]
tests/unit/test_file_watcher.py::TestFileWatcherChangeDetection::test_file_watcher_detects_change PASSED [ 27%]
tests/unit/test_file_watcher.py::TestFileWatcherChangeDetection::test_file_watcher_debounces_rapid_changes PASSED [ 28%]
tests/unit/test_file_watcher.py::TestFileWatcherHashTracking::test_file_watcher_tracks_hash PASSED [ 28%]
tests/unit/test_file_watcher.py::TestFileWatcherHashTracking::test_file_watcher_skips_unchanged_content PASSED [ 28%]
tests/unit/test_file_watcher.py::TestFileWatcherMetrics::test_file_watcher_reload_count PASSED [ 28%]
tests/unit/test_file_watcher.py::TestFileWatcherMetrics::test_file_watcher_error_count PASSED [ 28%]
tests/unit/test_file_watcher.py::TestFileWatcherGracefulDegradation::test_file_watcher_graceful_on_callback_error PASSED [ 29%]
tests/unit/test_five_phase_workflow_behavior.py::TestFivePhaseWorkflowBehavior::test_workflow_enforces_investigation_first_sequence PASSED [ 29%]
tests/unit/test_five_phase_workflow_behavior.py::TestFivePhaseWorkflowBehavior::test_workflow_clarifies_input_signal_is_starting_point PASSED [ 29%]
tests/unit/test_five_phase_workflow_behavior.py::TestFivePhaseWorkflowBehavior::test_workflow_provides_signal_type_decision_criteria PASSED [ 29%]
tests/unit/test_five_phase_workflow_behavior.py::TestFivePhaseWorkflowBehavior::test_workflow_emphasizes_rca_determines_signal_type PASSED [ 29%]
tests/unit/test_five_phase_workflow_behavior.py::TestFivePhaseWorkflowBehavior::test_workflow_defines_all_five_phases PASSED [ 29%]
tests/unit/test_five_phase_workflow_behavior.py::TestFivePhaseWorkflowBehavior::test_workflow_includes_mcp_failure_handling PASSED [ 30%]
tests/unit/test_five_phase_workflow_behavior.py::TestFivePhaseWorkflowBehavior::test_workflow_specifies_rca_signal_type_in_mcp_search PASSED [ 30%]
tests/unit/test_five_phase_workflow_behavior.py::TestFivePhaseWorkflowBehavior::test_workflow_requires_investigation_tools_usage PASSED [ 30%]
tests/unit/test_graceful_shutdown.py::test_readiness_probe_returns_503_during_shutdown PASSED [ 30%]
tests/unit/test_graceful_shutdown.py::test_inflight_request_completion PASSED [ 30%]
tests/unit/test_health.py::TestHealthEndpoint::test_health_returns_200 PASSED [ 31%]
tests/unit/test_health.py::TestHealthEndpoint::test_health_returns_service_info PASSED [ 31%]
tests/unit/test_health.py::TestHealthEndpoint::test_health_lists_correct_endpoints PASSED [ 31%]
tests/unit/test_health.py::TestHealthEndpoint::test_health_lists_enabled_features PASSED [ 31%]
tests/unit/test_health.py::TestReadinessEndpoint::test_ready_returns_200_when_healthy PASSED [ 31%]
tests/unit/test_health.py::TestReadinessEndpoint::test_ready_checks_dependencies PASSED [ 32%]
tests/unit/test_health.py::TestConfigEndpoint::test_config_returns_200 PASSED [ 32%]
tests/unit/test_health.py::TestConfigEndpoint::test_config_returns_sanitized_config PASSED [ 32%]
tests/unit/test_hot_reload.py::TestHotReloadIntegration::test_app_starts_with_config_manager PASSED [ 32%]
tests/unit/test_hot_reload.py::TestHotReloadIntegration::test_config_reload_reflects_in_getters PASSED [ 32%]
tests/unit/test_hot_reload.py::TestHotReloadIntegration::test_hot_reload_disabled_via_env PASSED [ 33%]
tests/unit/test_hot_reload.py::TestHotReloadIntegration::test_graceful_degradation_on_invalid_yaml PASSED [ 33%]
tests/unit/test_hot_reload.py::TestMetricsIntegration::test_metrics_record_reload PASSED [ 33%]
tests/unit/test_hot_reload.py::TestMetricsIntegration::test_metrics_available_in_endpoint PASSED [ 33%]
tests/unit/test_incident_detected_labels.py::TestIncidentPromptDetectedLabels::test_incident_prompt_includes_detected_labels_section PASSED [ 33%]
tests/unit/test_incident_detected_labels.py::TestIncidentPromptDetectedLabels::test_incident_prompt_excludes_detected_labels_when_not_provided PASSED [ 33%]
tests/unit/test_incident_detected_labels.py::TestIncidentPromptDetectedLabels::test_incident_prompt_includes_mcp_filter_instructions PASSED [ 34%]
tests/unit/test_incident_detected_labels.py::TestIncidentPromptDetectedLabels::test_incident_prompt_handles_empty_enrichment_results PASSED [ 34%]
tests/unit/test_incident_detected_labels.py::TestIncidentPromptDetectedLabels::test_incident_prompt_handles_none_detected_labels PASSED [ 34%]
tests/unit/test_incident_detected_labels.py::TestIncidentClusterContextSection::test_gitops_context_warns_about_direct_changes PASSED [ 34%]
tests/unit/test_incident_detected_labels.py::TestIncidentClusterContextSection::test_security_context_mentions_restrictions PASSED [ 34%]
tests/unit/test_incident_detected_labels.py::TestIncidentMCPFilterInstructions::test_mcp_instructions_include_all_detected_labels PASSED [ 35%]
tests/unit/test_incident_detected_labels.py::TestIncidentMCPFilterInstructions::test_mcp_instructions_empty_for_all_false_labels PASSED [ 35%]
tests/unit/test_incident_models_remediation_id.py::TestIncidentRequestRemediationId::test_incident_request_requires_remediation_id PASSED [ 35%]
tests/unit/test_incident_models_remediation_id.py::TestIncidentRequestRemediationId::test_incident_request_rejects_empty_remediation_id PASSED [ 35%]
tests/unit/test_incident_models_remediation_id.py::TestIncidentRequestRemediationId::test_incident_request_accepts_valid_remediation_id PASSED [ 35%]
tests/unit/test_incident_models_remediation_id.py::TestIncidentRequestRemediationId::test_remediation_id_is_passthrough_only PASSED [ 36%]
tests/unit/test_incident_models_remediation_id.py::TestRecoveryRequestRemediationId::test_recovery_request_requires_remediation_id PASSED [ 36%]
tests/unit/test_incident_models_remediation_id.py::TestRecoveryRequestRemediationId::test_recovery_request_accepts_valid_remediation_id PASSED [ 36%]
tests/unit/test_incident_owner_chain_validation.py::TestOwnerChainValidation::test_target_matches_source_resource PASSED [ 36%]
tests/unit/test_incident_owner_chain_validation.py::TestOwnerChainValidation::test_target_in_owner_chain PASSED [ 36%]
tests/unit/test_incident_owner_chain_validation.py::TestOwnerChainValidation::test_target_not_in_owner_chain PASSED [ 37%]
tests/unit/test_incident_owner_chain_validation.py::TestOwnerChainValidation::test_case_insensitive_matching PASSED [ 37%]
tests/unit/test_incident_owner_chain_validation.py::TestOwnerChainValidation::test_cluster_scoped_resource PASSED [ 37%]
tests/unit/test_incident_owner_chain_validation.py::TestParseInvestigationResultWarnings::test_warning_when_target_not_in_owner_chain PASSED [ 37%]
tests/unit/test_incident_owner_chain_validation.py::TestParseInvestigationResultWarnings::test_warning_when_no_workflow_selected FAILED [ 37%]
tests/unit/test_incident_owner_chain_validation.py::TestParseInvestigationResultWarnings::test_warning_when_low_confidence FAILED [ 37%]
tests/unit/test_incident_owner_chain_validation.py::TestParseInvestigationResultWarnings::test_no_warnings_when_all_valid PASSED [ 38%]
tests/unit/test_incident_owner_chain_validation.py::TestIncidentResponseFields::test_response_includes_new_fields PASSED [ 38%]
tests/unit/test_incident_owner_chain_validation.py::TestIncidentResponseFields::test_response_defaults PASSED [ 38%]
tests/unit/test_llm_sanitizer.py::TestPasswordPatterns::test_password_json_sanitized PASSED [ 38%]
tests/unit/test_llm_sanitizer.py::TestPasswordPatterns::test_password_plain_sanitized PASSED [ 38%]
tests/unit/test_llm_sanitizer.py::TestPasswordPatterns::test_password_with_equals_sanitized PASSED [ 39%]
tests/unit/test_llm_sanitizer.py::TestPasswordPatterns::test_passwd_field_sanitized PASSED [ 39%]
tests/unit/test_llm_sanitizer.py::TestPasswordPatterns::test_pwd_field_sanitized PASSED [ 39%]
tests/unit/test_llm_sanitizer.py::TestDatabaseURLPatterns::test_postgresql_url_sanitized PASSED [ 39%]
tests/unit/test_llm_sanitizer.py::TestDatabaseURLPatterns::test_mysql_url_sanitized PASSED [ 39%]
tests/unit/test_llm_sanitizer.py::TestDatabaseURLPatterns::test_mongodb_url_sanitized PASSED [ 40%]
tests/unit/test_llm_sanitizer.py::TestDatabaseURLPatterns::test_redis_url_sanitized PASSED [ 40%]
tests/unit/test_llm_sanitizer.py::TestDatabaseURLPatterns::test_generic_url_password_sanitized PASSED [ 40%]
tests/unit/test_llm_sanitizer.py::TestAPIKeyPatterns::test_openai_key_sanitized PASSED [ 40%]
tests/unit/test_llm_sanitizer.py::TestAPIKeyPatterns::test_openai_key_in_logs_sanitized PASSED [ 40%]
tests/unit/test_llm_sanitizer.py::TestAPIKeyPatterns::test_api_key_json_sanitized PASSED [ 41%]
tests/unit/test_llm_sanitizer.py::TestAPIKeyPatterns::test_apikey_no_underscore_sanitized PASSED [ 41%]
tests/unit/test_llm_sanitizer.py::TestTokenPatterns::test_bearer_token_sanitized PASSED [ 41%]
tests/unit/test_llm_sanitizer.py::TestTokenPatterns::test_jwt_token_standalone_sanitized PASSED [ 41%]
tests/unit/test_llm_sanitizer.py::TestTokenPatterns::test_github_token_sanitized PASSED [ 41%]
tests/unit/test_llm_sanitizer.py::TestTokenPatterns::test_github_oauth_token_sanitized PASSED [ 41%]
tests/unit/test_llm_sanitizer.py::TestTokenPatterns::test_token_json_sanitized PASSED [ 42%]
tests/unit/test_llm_sanitizer.py::TestSecretPatterns::test_secret_json_sanitized PASSED [ 42%]
tests/unit/test_llm_sanitizer.py::TestSecretPatterns::test_secret_plain_sanitized PASSED [ 42%]
tests/unit/test_llm_sanitizer.py::TestCloudProviderCredentials::test_aws_access_key_id_sanitized PASSED [ 42%]
tests/unit/test_llm_sanitizer.py::TestCloudProviderCredentials::test_aws_secret_key_sanitized PASSED [ 42%]
tests/unit/test_llm_sanitizer.py::TestCloudProviderCredentials::test_aws_inline_access_key_sanitized PASSED [ 43%]
tests/unit/test_llm_sanitizer.py::TestCertificatesAndKeys::test_private_key_sanitized PASSED [ 43%]
tests/unit/test_llm_sanitizer.py::TestCertificatesAndKeys::test_rsa_private_key_sanitized PASSED [ 43%]
tests/unit/test_llm_sanitizer.py::TestCertificatesAndKeys::test_certificate_sanitized PASSED [ 43%]
tests/unit/test_llm_sanitizer.py::TestKubernetesSecrets::test_k8s_secret_data_sanitized PASSED [ 43%]
tests/unit/test_llm_sanitizer.py::TestDataTypeHandling::test_sanitize_string PASSED [ 44%]
tests/unit/test_llm_sanitizer.py::TestDataTypeHandling::test_sanitize_dict PASSED [ 44%]
tests/unit/test_llm_sanitizer.py::TestDataTypeHandling::test_sanitize_list PASSED [ 44%]
tests/unit/test_llm_sanitizer.py::TestDataTypeHandling::test_sanitize_none_returns_none PASSED [ 44%]
tests/unit/test_llm_sanitizer.py::TestDataTypeHandling::test_sanitize_nested_dict PASSED [ 44%]
tests/unit/test_llm_sanitizer.py::TestEdgeCases::test_sanitize_empty_string PASSED [ 45%]
tests/unit/test_llm_sanitizer.py::TestEdgeCases::test_sanitize_no_credentials PASSED [ 45%]
tests/unit/test_llm_sanitizer.py::TestEdgeCases::test_sanitize_multiple_credentials PASSED [ 45%]
tests/unit/test_llm_sanitizer.py::TestEdgeCases::test_pattern_ordering_prevents_corruption PASSED [ 45%]
tests/unit/test_llm_sanitizer.py::TestFallbackSanitization::test_fallback_on_normal_content PASSED [ 45%]
tests/unit/test_llm_sanitizer.py::TestFallbackSanitization::test_safe_fallback_method PASSED [ 45%]
tests/unit/test_llm_sanitizer.py::TestSanitizerClass::test_default_rules_count PASSED [ 46%]
tests/unit/test_llm_sanitizer.py::TestSanitizerClass::test_custom_rules PASSED [ 46%]
tests/unit/test_llm_sanitizer.py::TestSanitizerClass::test_sanitizer_instance_reuse PASSED [ 46%]
tests/unit/test_llm_sanitizer.py::TestRealWorldScenarios::test_kubectl_logs_output PASSED [ 46%]
tests/unit/test_llm_sanitizer.py::TestRealWorldScenarios::test_error_stack_trace PASSED [ 46%]
tests/unit/test_llm_sanitizer.py::TestRealWorldScenarios::test_kubernetes_configmap PASSED [ 47%]
tests/unit/test_llm_sanitizer.py::TestRealWorldScenarios::test_workflow_parameters PASSED [ 47%]
tests/unit/test_llm_self_correction.py::TestLLMSelfCorrectionConstants::test_max_validation_attempts_is_three PASSED [ 47%]
tests/unit/test_llm_self_correction.py::TestLLMSelfCorrectionConstants::test_max_validation_attempts_is_positive PASSED [ 47%]
tests/unit/test_llm_self_correction.py::TestValidationErrorFeedback::test_builds_feedback_with_single_error PASSED [ 47%]
tests/unit/test_llm_self_correction.py::TestValidationErrorFeedback::test_builds_feedback_with_multiple_errors PASSED [ 48%]
tests/unit/test_llm_self_correction.py::TestValidationErrorFeedback::test_feedback_includes_correction_instructions PASSED [ 48%]
tests/unit/test_llm_self_correction.py::TestValidationErrorFeedback::test_feedback_attempt_numbering PASSED [ 48%]
tests/unit/test_llm_self_correction.py::TestValidationErrorFeedback::test_feedback_mentions_mcp_search PASSED [ 48%]
tests/unit/test_llm_self_correction.py::TestDetermineHumanReviewReason::test_workflow_not_found_reason PASSED [ 48%]
tests/unit/test_llm_self_correction.py::TestDetermineHumanReviewReason::test_image_mismatch_reason PASSED [ 49%]
tests/unit/test_llm_self_correction.py::TestDetermineHumanReviewReason::test_parameter_validation_reason PASSED [ 49%]
tests/unit/test_llm_self_correction.py::TestDetermineHumanReviewReason::test_type_error_maps_to_parameter_validation PASSED [ 49%]
tests/unit/test_llm_self_correction.py::TestDetermineHumanReviewReason::test_default_reason_for_unknown_errors PASSED [ 49%]
tests/unit/test_llm_self_correction.py::TestParseAndValidateInvestigationResult::test_returns_tuple_with_result_and_validation PASSED [ 49%]
tests/unit/test_llm_self_correction.py::TestParseAndValidateInvestigationResult::test_parses_json_from_analysis FAILED [ 50%]
tests/unit/test_llm_self_correction.py::TestParseAndValidateInvestigationResult::test_sets_needs_human_review_when_no_workflow PASSED [ 50%]
tests/unit/test_llm_self_correction.py::TestParseAndValidateInvestigationResult::test_sets_needs_human_review_for_low_confidence FAILED [ 50%]
tests/unit/test_llm_self_correction.py::TestParseAndValidateInvestigationResult::test_extracts_alternative_workflows PASSED [ 50%]
tests/unit/test_llm_self_correction.py::TestCreateDataStorageClient::test_creates_client_from_env_var PASSED [ 50%]
tests/unit/test_llm_self_correction.py::TestCreateDataStorageClient::test_creates_client_from_app_config PASSED [ 50%]
tests/unit/test_llm_self_correction.py::TestCreateDataStorageClient::test_returns_none_on_error PASSED [ 51%]
tests/unit/test_llm_self_correction.py::TestSelfCorrectionLoopIntegration::test_loop_uses_max_validation_attempts PASSED [ 51%]
tests/unit/test_llm_self_correction.py::TestSelfCorrectionLoopIntegration::test_validation_errors_history_accumulates PASSED [ 51%]
tests/unit/test_llm_self_correction.py::TestSelfCorrectionLoopIntegration::test_feedback_includes_previous_errors PASSED [ 51%]
tests/unit/test_mcp_client_removal.py::TestMCPClientRemoval::test_mcp_client_file_deleted PASSED [ 51%]
tests/unit/test_mcp_client_removal.py::TestMCPClientRemoval::test_recovery_py_no_mcp_client_import PASSED [ 52%]
tests/unit/test_mcp_client_removal.py::TestMCPClientRemoval::test_incident_py_no_mcp_client_import PASSED [ 52%]
tests/unit/test_mcp_client_removal.py::TestMCPClientRemoval::test_no_get_workflow_recommendations_function PASSED [ 52%]
tests/unit/test_mcp_client_removal.py::TestMCPClientRemoval::test_no_workflow_recommendations_in_request_data PASSED [ 52%]
tests/unit/test_mcp_client_removal.py::TestMCPClientRemoval::test_no_mcp_config_parameter_in_analyze_recovery PASSED [ 52%]
tests/unit/test_mcp_client_removal.py::TestWorkflowCatalogToolsetIntegration::test_recovery_py_uses_register_workflow_catalog_toolset PASSED [ 53%]
tests/unit/test_models.py::TestRecoveryModels::test_recovery_request_model_validates_required_fields PASSED [ 53%]
tests/unit/test_models.py::TestRecoveryModels::test_recovery_request_accepts_valid_data PASSED [ 53%]
tests/unit/test_models.py::TestRecoveryModels::test_recovery_strategy_validates_confidence_range PASSED [ 53%]
tests/unit/test_models.py::TestModelSerialization::test_recovery_request_serializes_to_dict PASSED [ 53%]
tests/unit/test_prompt_generation_adr041.py::TestADR040SignalContext::test_prompt_includes_signal_source_information PASSED [ 54%]
tests/unit/test_prompt_generation_adr041.py::TestADR040SignalContext::test_prompt_includes_signal_source_in_incident_summary PASSED [ 54%]
tests/unit/test_prompt_generation_adr041.py::TestADR040SignalContext::test_prompt_includes_resource_identification PASSED [ 54%]
tests/unit/test_prompt_generation_adr041.py::TestADR040SignalContext::test_prompt_includes_business_context_for_workflow_search PASSED [ 54%]
tests/unit/test_prompt_generation_adr041.py::TestADR040SignalContext::test_prompt_includes_deduplication_context PASSED [ 54%]
tests/unit/test_prompt_generation_adr041.py::TestADR040SignalContext::test_prompt_includes_storm_detection_metadata PASSED [ 54%]
tests/unit/test_prompt_generation_adr041.py::TestADR040SignalContext::test_prompt_with_minimal_required_fields PASSED [ 55%]
tests/unit/test_prompt_generation_adr041.py::TestADR040SignalContext::test_prompt_with_all_optional_fields PASSED [ 55%]
tests/unit/test_prompt_generation_adr041.py::TestADR040OutputFormat::test_prompt_specifies_workflow_selection_format PASSED [ 55%]
tests/unit/test_prompt_generation_adr041.py::TestADR040OutputFormat::test_prompt_specifies_rca_severity_levels PASSED [ 55%]
tests/unit/test_prompt_generation_adr041.py::TestADR040OutputFormat::test_prompt_uses_workflow_terminology PASSED [ 55%]
tests/unit/test_prompt_generation_adr041.py::TestADR040OutputFormat::test_prompt_excludes_deprecated_fields PASSED [ 56%]
tests/unit/test_prompt_generation_adr041.py::TestADR040MCPIntegration::test_prompt_includes_mcp_tool_name PASSED [ 56%]
tests/unit/test_prompt_generation_adr041.py::TestADR040MCPIntegration::test_prompt_clarifies_field_usage_for_rca_vs_workflow_search PASSED [ 56%]
tests/unit/test_prompt_generation_adr041.py::TestADR040MCPIntegration::test_prompt_includes_workflow_search_parameters PASSED [ 56%]
tests/unit/test_prompt_generation_adr041.py::TestADR040RCASeverity::test_prompt_includes_rca_severity_criteria PASSED [ 56%]
tests/unit/test_prompt_generation_adr041.py::TestADR040RCASeverity::test_prompt_includes_severity_level_examples PASSED [ 57%]
tests/unit/test_prompt_generation_adr041.py::TestADR040RCASeverity::test_prompt_distinguishes_input_severity_from_rca_severity PASSED [ 57%]
tests/unit/test_prompt_generation_adr041.py::TestADR040EdgeCases::test_prompt_with_empty_string_fields PASSED [ 57%]
tests/unit/test_prompt_generation_adr041.py::TestADR040EdgeCases::test_prompt_with_none_values PASSED [ 57%]
tests/unit/test_prompt_generation_adr041.py::TestADR040EdgeCases::test_prompt_with_zero_occurrence_count PASSED [ 57%]
tests/unit/test_prompt_generation_adr041.py::TestADR040EdgeCases::test_prompt_with_very_high_occurrence_count PASSED [ 58%]
tests/unit/test_prompt_generation_adr041.py::TestADR040EdgeCases::test_prompt_with_massive_storm_alert_count PASSED [ 58%]
tests/unit/test_prompt_generation_adr041.py::TestADR040EdgeCases::test_prompt_with_many_affected_resources PASSED [ 58%]
tests/unit/test_prompt_generation_adr041.py::TestADR040EdgeCases::test_prompt_with_special_characters_in_resource_names PASSED [ 58%]
tests/unit/test_prompt_generation_adr041.py::TestADR040EdgeCases::test_prompt_with_unicode_characters PASSED [ 58%]
tests/unit/test_prompt_generation_adr041.py::TestADR040EdgeCases::test_prompt_with_very_long_field_values PASSED [ 58%]
tests/unit/test_prompt_generation_adr041.py::TestADR040EdgeCases::test_prompt_with_nested_dict_in_failure_context PASSED [ 59%]
tests/unit/test_prompt_generation_adr041.py::TestADR040EdgeCases::test_prompt_with_all_priority_levels PASSED [ 59%]
tests/unit/test_prompt_generation_adr041.py::TestADR040EdgeCases::test_prompt_with_all_risk_tolerance_levels PASSED [ 59%]
tests/unit/test_prompt_generation_adr041.py::TestADR040EdgeCases::test_prompt_with_all_storm_types PASSED [ 59%]
tests/unit/test_prompt_generation_adr041.py::TestADR040EdgeCases::test_prompt_with_missing_failed_action PASSED [ 59%]
tests/unit/test_prompt_generation_adr041.py::TestADR040EdgeCases::test_prompt_with_missing_failure_context PASSED [ 60%]
tests/unit/test_prompt_generation_adr041.py::TestADR040EdgeCases::test_prompt_generation_is_deterministic PASSED [ 60%]
tests/unit/test_prompt_generation_adr041.py::TestADR040ComplianceValidation::test_prompt_length_is_reasonable PASSED [ 60%]
tests/unit/test_prompt_generation_adr041.py::TestADR040ComplianceValidation::test_prompt_contains_structured_sections PASSED [ 60%]
tests/unit/test_prompt_generation_adr041.py::TestADR040ComplianceValidation::test_prompt_is_valid_markdown PASSED [ 60%]
tests/unit/test_prompt_generation_adr041.py::TestADR040ComplianceValidation::test_prompt_includes_json_code_block_example PASSED [ 61%]
tests/unit/test_prompt_generation_adr041.py::TestADR040ComplianceValidation::test_prompt_does_not_contain_placeholder_text PASSED [ 61%]
tests/unit/test_prompt_generation_adr041.py::TestDDLLM001MCPSearchTaxonomy::test_prompt_explains_mcp_search_query_format PASSED [ 61%]
tests/unit/test_prompt_generation_adr041.py::TestDDLLM001MCPSearchTaxonomy::test_prompt_lists_canonical_signal_types PASSED [ 61%]
tests/unit/test_prompt_generation_adr041.py::TestDDLLM001MCPSearchTaxonomy::test_prompt_defines_rca_severity_levels PASSED [ 61%]
tests/unit/test_prompt_generation_adr041.py::TestDDLLM001MCPSearchTaxonomy::test_prompt_explains_business_policy_passthrough PASSED [ 62%]
tests/unit/test_prompt_generation_adr041.py::TestDDLLM001MCPSearchTaxonomy::test_prompt_provides_complete_mcp_search_example PASSED [ 62%]
tests/unit/test_prompt_generation_adr041.py::TestDDLLM001QueryFormat::test_prompt_explains_signal_type_must_be_canonical PASSED [ 62%]
tests/unit/test_prompt_generation_adr041.py::TestDDLLM001QueryFormat::test_prompt_explains_severity_assessment_criteria PASSED [ 62%]
tests/unit/test_prompt_generation_adr041.py::TestDDLLM001QueryFormat::test_prompt_clarifies_llm_can_override_input_severity PASSED [ 62%]
tests/unit/test_prompt_generation_adr041.py::TestDDLLM001LabelParameters::test_prompt_lists_all_six_label_parameters PASSED [ 62%]
tests/unit/test_prompt_generation_adr041.py::TestDDLLM001LabelParameters::test_prompt_explains_llm_determines_technical_fields PASSED [ 63%]
tests/unit/test_prompt_generation_adr041.py::TestDDLLM001LabelParameters::test_prompt_explains_llm_must_passthrough_business_fields PASSED [ 63%]
tests/unit/test_prompt_generation_adr041.py::TestDDLLM001LabelParameters::test_prompt_explains_priority_is_business_decision PASSED [ 63%]
tests/unit/test_prompt_generation_adr041.py::TestDDLLM001LabelParameters::test_prompt_explains_risk_tolerance_is_policy_decision PASSED [ 63%]
tests/unit/test_prompt_generation_adr041.py::TestDDLLM001ConfidenceOptimization::test_prompt_explains_exact_label_matching PASSED [ 63%]
tests/unit/test_prompt_generation_adr041.py::TestDDLLM001ConfidenceOptimization::test_prompt_provides_workflow_search_guidance PASSED [ 64%]
tests/unit/test_pydantic_validators.py::TestIncidentRequestValidation::test_empty_remediation_id_raises_error PASSED [ 64%]
tests/unit/test_pydantic_validators.py::TestIncidentRequestValidation::test_missing_remediation_id_raises_error PASSED [ 64%]
tests/unit/test_pydantic_validators.py::TestIncidentRequestValidation::test_valid_remediation_id_passes PASSED [ 64%]
tests/unit/test_pydantic_validators.py::TestRecoveryRequestValidation::test_invalid_recovery_attempt_number_raises_error PASSED [ 64%]
tests/unit/test_pydantic_validators.py::TestRecoveryRequestValidation::test_negative_recovery_attempt_number_raises_error PASSED [ 65%]
tests/unit/test_pydantic_validators.py::TestRecoveryRequestValidation::test_valid_recovery_attempt_number_passes PASSED [ 65%]
tests/unit/test_pydantic_validators.py::TestEndpointValidation::test_empty_signal_type_raises_error PASSED [ 65%]
tests/unit/test_pydantic_validators.py::TestEndpointValidation::test_invalid_severity_raises_error PASSED [ 65%]
tests/unit/test_rca_incomplete_br_hapi_212.py::TestRCAIncompleteEnum::test_rca_incomplete_enum_exists PASSED [ 65%]
tests/unit/test_rca_incomplete_br_hapi_212.py::TestRCAIncompleteEnum::test_rca_incomplete_is_string_enum PASSED [ 66%]
tests/unit/test_rca_incomplete_br_hapi_212.py::TestRCAIncompleteEnum::test_all_human_review_reasons_exist PASSED [ 66%]
tests/unit/test_rca_incomplete_br_hapi_212.py::TestRCAIncompleteValidationLogic::test_rca_incomplete_validation_condition_documented PASSED [ 66%]
tests/unit/test_rca_incomplete_br_hapi_212.py::TestRCAIncompleteValidationLogic::test_rca_incomplete_takes_precedence_over_normal_flow PASSED [ 66%]
tests/unit/test_rca_incomplete_br_hapi_212.py::TestRCAIncompleteSemantics::test_rca_incomplete_means_workflow_selected_but_target_unknown PASSED [ 66%]
tests/unit/test_rca_incomplete_br_hapi_212.py::TestRCAIncompleteSemantics::test_when_to_use_rca_incomplete PASSED [ 66%]
tests/unit/test_recovery.py::TestRecoveryEndpoint::test_recovery_returns_200_on_valid_request PASSED [ 67%]
tests/unit/test_recovery.py::TestRecoveryEndpoint::test_recovery_returns_incident_id PASSED [ 67%]
tests/unit/test_recovery.py::TestRecoveryEndpoint::test_recovery_returns_can_recover_flag PASSED [ 67%]
tests/unit/test_recovery.py::TestRecoveryEndpoint::test_recovery_returns_strategies_list PASSED [ 67%]
tests/unit/test_recovery.py::TestRecoveryEndpoint::test_recovery_strategy_has_required_fields PASSED [ 67%]
tests/unit/test_recovery.py::TestRecoveryEndpoint::test_recovery_includes_primary_recommendation PASSED [ 68%]
tests/unit/test_recovery.py::TestRecoveryEndpoint::test_recovery_includes_confidence_score PASSED [ 68%]
tests/unit/test_recovery.py::TestRecoveryEndpoint::test_recovery_handles_missing_fields PASSED [ 68%]
tests/unit/test_recovery.py::TestRecoveryAnalysisLogic::test_analyze_recovery_generates_strategies PASSED [ 68%]
tests/unit/test_recovery.py::TestRecoveryAnalysisLogic::test_analyze_recovery_includes_warnings_field PASSED [ 68%]
tests/unit/test_recovery.py::TestRecoveryAnalysisLogic::test_analyze_recovery_returns_metadata PASSED [ 69%]
tests/unit/test_recovery.py::TestRecoveryErrorHandling::test_recovery_returns_500_on_internal_error PASSED [ 69%]
tests/unit/test_recovery_analysis.py::TestMinimalDAL::test_minimal_dal_initialization PASSED [ 69%]
tests/unit/test_recovery_analysis.py::TestMinimalDAL::test_minimal_dal_initialization_no_cluster PASSED [ 69%]
tests/unit/test_recovery_analysis.py::TestMinimalDAL::test_get_issue_data_returns_none PASSED [ 69%]
tests/unit/test_recovery_analysis.py::TestMinimalDAL::test_get_resource_instructions_returns_none PASSED [ 70%]
tests/unit/test_recovery_analysis.py::TestMinimalDAL::test_get_global_instructions_for_account_returns_none PASSED [ 70%]
tests/unit/test_recovery_analysis.py::TestGetHolmesConfig::test_get_holmes_config_with_model PASSED [ 70%]
tests/unit/test_recovery_analysis.py::TestGetHolmesConfig::test_get_holmes_config_without_model_raises_error PASSED [ 70%]
tests/unit/test_recovery_analysis.py::TestExtractStrategiesFromAnalysis::test_extract_strategies_from_json_response PASSED [ 70%]
tests/unit/test_recovery_analysis.py::TestExtractStrategiesFromAnalysis::test_extract_strategies_from_markdown_list PASSED [ 70%]
tests/unit/test_recovery_analysis.py::TestExtractStrategiesFromAnalysis::test_extract_strategies_empty_response PASSED [ 71%]
tests/unit/test_recovery_analysis.py::TestExtractStrategiesFromAnalysis::test_extract_strategies_no_strategies_found PASSED [ 71%]
tests/unit/test_recovery_analysis.py::TestExtractStrategiesFromAnalysis::test_extract_strategies_malformed_json PASSED [ 71%]
tests/unit/test_recovery_analysis.py::TestExtractWarningsFromAnalysis::test_extract_explicit_warnings PASSED [ 71%]
tests/unit/test_recovery_analysis.py::TestExtractWarningsFromAnalysis::test_extract_implicit_warnings_high_load PASSED [ 71%]
tests/unit/test_recovery_analysis.py::TestExtractWarningsFromAnalysis::test_extract_implicit_warnings_resource_constraints PASSED [ 72%]
tests/unit/test_recovery_analysis.py::TestExtractWarningsFromAnalysis::test_extract_no_warnings PASSED [ 72%]
tests/unit/test_recovery_analysis.py::TestExtractWarningsFromAnalysis::test_extract_warnings_empty_text PASSED [ 72%]
tests/unit/test_recovery_analysis.py::TestRecoveryAnalysisEdgeCases::test_extract_strategies_with_negative_confidence PASSED [ 72%]
tests/unit/test_recovery_analysis.py::TestRecoveryAnalysisEdgeCases::test_extract_strategies_with_confidence_over_1 PASSED [ 72%]
tests/unit/test_recovery_analysis.py::TestRecoveryAnalysisEdgeCases::test_extract_warnings_with_mixed_case PASSED [ 73%]
tests/unit/test_recovery_models_dd003.py::TestOriginalRCAModel::test_original_rca_captures_rca_summary PASSED [ 73%]
tests/unit/test_recovery_models_dd003.py::TestOriginalRCAModel::test_original_rca_requires_summary PASSED [ 73%]
tests/unit/test_recovery_models_dd003.py::TestOriginalRCAModel::test_original_rca_allows_empty_contributing_factors PASSED [ 73%]
tests/unit/test_recovery_models_dd003.py::TestSelectedWorkflowSummaryModel::test_workflow_summary_captures_execution_details PASSED [ 73%]
tests/unit/test_recovery_models_dd003.py::TestSelectedWorkflowSummaryModel::test_workflow_summary_allows_empty_parameters PASSED [ 74%]
tests/unit/test_recovery_models_dd003.py::TestExecutionFailureModel::test_execution_failure_captures_kubernetes_reason PASSED [ 74%]
tests/unit/test_recovery_models_dd003.py::TestExecutionFailureModel::test_execution_failure_step_index_must_be_non_negative PASSED [ 74%]
tests/unit/test_recovery_models_dd003.py::TestExecutionFailureModel::test_execution_failure_exit_code_is_optional PASSED [ 74%]
tests/unit/test_recovery_models_dd003.py::TestPreviousExecutionModel::test_previous_execution_combines_all_context PASSED [ 74%]
tests/unit/test_recovery_models_dd003.py::TestRecoveryRequestWithPreviousExecution::test_recovery_request_accepts_previous_execution PASSED [ 75%]
tests/unit/test_recovery_models_dd003.py::TestRecoveryRequestWithPreviousExecution::test_recovery_attempt_number_must_be_positive PASSED [ 75%]
tests/unit/test_recovery_models_dd003.py::TestDetectedLabelsModel::test_detected_labels_captures_gitops_state PASSED [ 75%]
tests/unit/test_recovery_models_dd003.py::TestDetectedLabelsModel::test_detected_labels_captures_protection_state PASSED [ 75%]
tests/unit/test_recovery_models_dd003.py::TestDetectedLabelsModel::test_detected_labels_captures_workload_characteristics PASSED [ 75%]
tests/unit/test_recovery_models_dd003.py::TestDetectedLabelsModel::test_detected_labels_captures_security_posture PASSED [ 75%]
tests/unit/test_recovery_models_dd003.py::TestDetectedLabelsModel::test_detected_labels_defaults_to_safe_values PASSED [ 76%]
tests/unit/test_recovery_models_dd003.py::TestEnrichmentResultsModel::test_enrichment_results_contains_detected_labels PASSED [ 76%]
tests/unit/test_recovery_models_dd003.py::TestEnrichmentResultsModel::test_enrichment_results_allows_kubernetes_context PASSED [ 76%]
tests/unit/test_recovery_models_dd003.py::TestEnrichmentResultsModel::test_enrichment_results_allows_custom_labels PASSED [ 76%]
tests/unit/test_recovery_models_dd003.py::TestEnrichmentResultsModel::test_enrichment_quality_bounded_0_to_1 PASSED [ 76%]
tests/unit/test_recovery_models_dd003.py::TestIncidentRequestWithEnrichmentResults::test_incident_request_accepts_enrichment_results PASSED [ 77%]
tests/unit/test_recovery_models_dd003.py::TestIncidentRequestWithEnrichmentResults::test_incident_request_works_without_enrichment_results PASSED [ 77%]
tests/unit/test_recovery_prompt_dd003.py::TestRecoveryPromptGeneration::test_recovery_prompt_includes_previous_attempt_section PASSED [ 77%]
tests/unit/test_recovery_prompt_dd003.py::TestRecoveryPromptGeneration::test_recovery_prompt_instructs_not_to_repeat_workflow PASSED [ 77%]
tests/unit/test_recovery_prompt_dd003.py::TestRecoveryPromptGeneration::test_recovery_prompt_includes_kubernetes_reason_guidance PASSED [ 77%]
tests/unit/test_recovery_prompt_dd003.py::TestRecoveryPromptGeneration::test_recovery_prompt_includes_attempt_number PASSED [ 78%]
tests/unit/test_recovery_prompt_dd003.py::TestFailureReasonGuidance::test_oomkilled_guidance_suggests_memory_alternatives PASSED [ 78%]
tests/unit/test_recovery_prompt_dd003.py::TestFailureReasonGuidance::test_deadline_exceeded_guidance_suggests_timeout_alternatives PASSED [ 78%]
tests/unit/test_recovery_prompt_dd003.py::TestFailureReasonGuidance::test_image_pull_failure_guidance_suggests_image_alternatives PASSED [ 78%]
tests/unit/test_recovery_prompt_dd003.py::TestFailureReasonGuidance::test_unauthorized_guidance_suggests_permission_alternatives PASSED [ 78%]
tests/unit/test_recovery_prompt_dd003.py::TestFailureReasonGuidance::test_unknown_reason_provides_generic_guidance PASSED [ 79%]
tests/unit/test_recovery_prompt_dd003.py::TestDetectedLabelsInPrompt::test_prompt_includes_gitops_warning_when_gitops_managed PASSED [ 79%]
tests/unit/test_recovery_prompt_dd003.py::TestDetectedLabelsInPrompt::test_prompt_includes_pdb_warning_when_pdb_protected PASSED [ 79%]
tests/unit/test_recovery_prompt_dd003.py::TestDetectedLabelsInPrompt::test_prompt_includes_stateful_warning_when_stateful PASSED [ 79%]
tests/unit/test_recovery_prompt_dd003.py::TestDetectedLabelsInPrompt::test_prompt_returns_no_characteristics_when_empty PASSED [ 79%]
tests/unit/test_recovery_prompt_dd003.py::TestDetectedLabelsInPrompt::test_prompt_combines_multiple_characteristics PASSED [ 79%]
tests/unit/test_recovery_prompt_dd003.py::TestMCPFilterInstructions::test_mcp_instructions_include_json_filter_template PASSED [ 80%]
tests/unit/test_recovery_prompt_dd003.py::TestMCPFilterInstructions::test_mcp_instructions_empty_for_no_labels PASSED [ 80%]
tests/unit/test_recovery_prompt_dd003.py::TestMCPFilterInstructions::test_mcp_instructions_highlight_gitops_priority PASSED [ 80%]
tests/unit/test_resolved_signals_br_hapi_200.py::TestHumanReviewReasonEnum::test_investigation_inconclusive_enum_exists PASSED [ 80%]
tests/unit/test_resolved_signals_br_hapi_200.py::TestHumanReviewReasonEnum::test_investigation_inconclusive_is_string_enum PASSED [ 80%]
tests/unit/test_resolved_signals_br_hapi_200.py::TestHumanReviewReasonEnum::test_all_human_review_reasons_exist PASSED [ 81%]
tests/unit/test_resolved_signals_br_hapi_200.py::TestHumanReviewReasonEnum::test_human_review_reason_json_serialization PASSED [ 81%]
tests/unit/test_resolved_signals_br_hapi_200.py::TestInconclusiveInvestigationSemantics::test_inconclusive_means_uncertain_not_resolved PASSED [ 81%]
tests/unit/test_resolved_signals_br_hapi_200.py::TestInconclusiveInvestigationSemantics::test_when_to_use_investigation_inconclusive PASSED [ 81%]
tests/unit/test_resolved_signals_br_hapi_200.py::TestOutcomeDistinction::test_outcome_a_resolved_no_human_review PASSED [ 81%]
tests/unit/test_resolved_signals_br_hapi_200.py::TestOutcomeDistinction::test_outcome_b_inconclusive_needs_human_review PASSED [ 82%]
tests/unit/test_resolved_signals_br_hapi_200.py::TestOutcomeDistinction::test_outcome_c_normal_workflow_selection PASSED [ 82%]
tests/unit/test_rfc7807_errors.py::test_rfc7807_error_model_structure PASSED [ 82%]
tests/unit/test_rfc7807_errors.py::test_error_type_uri_format PASSED     [ 82%]
tests/unit/test_rfc7807_errors.py::test_bad_request_400_error PASSED     [ 82%]
tests/unit/test_rfc7807_errors.py::test_unauthorized_401_error PASSED    [ 83%]
tests/unit/test_rfc7807_errors.py::test_not_found_404_error PASSED       [ 83%]
tests/unit/test_rfc7807_errors.py::test_internal_server_error_500 PASSED [ 83%]
tests/unit/test_rfc7807_errors.py::test_service_unavailable_503_error PASSED [ 83%]
tests/unit/test_sdk_availability.py::TestSDKAvailability::test_sdk_can_be_imported PASSED [ 83%]
tests/unit/test_sdk_availability.py::TestSDKAvailability::test_sdk_configuration_can_be_loaded PASSED [ 83%]
tests/unit/test_sdk_availability.py::TestSDKErrorHandling::test_sdk_import_error_is_handled_gracefully PASSED [ 84%]
tests/unit/test_sdk_availability.py::TestEndToEndFlow::test_recovery_endpoint_end_to_end PASSED [ 84%]
tests/unit/test_sdk_registration_fix.py::TestSDKRegistrationFix::test_register_creates_toolset_manager PASSED [ 84%]
tests/unit/test_sdk_registration_fix.py::TestSDKRegistrationFix::test_registered_toolset_not_in_dict PASSED [ 84%]
tests/unit/test_sdk_registration_fix.py::TestSDKRegistrationFix::test_toolset_available_via_list_server_toolsets PASSED [ 84%]
tests/unit/test_sdk_registration_fix.py::TestSDKRegistrationFix::test_toolset_has_search_tool PASSED [ 85%]
tests/unit/test_sdk_registration_fix.py::TestSDKRegistrationFix::test_registration_with_remediation_id PASSED [ 85%]
tests/unit/test_sdk_registration_fix.py::TestSDKRegistrationFix::test_prepare_toolsets_removes_workflow_catalog PASSED [ 85%]
tests/unit/test_sdk_registration_fix.py::TestSDKRegistrationFix::test_full_registration_no_attribute_error PASSED [ 85%]
tests/unit/test_workflow_catalog_container_image.py::TestWorkflowCatalogContainerImage::test_transform_includes_container_image_when_present PASSED [ 85%]
tests/unit/test_workflow_catalog_container_image.py::TestWorkflowCatalogContainerImage::test_transform_includes_container_digest_when_present PASSED [ 86%]
tests/unit/test_workflow_catalog_container_image.py::TestWorkflowCatalogContainerImage::test_transform_handles_missing_container_image_gracefully PASSED [ 86%]
tests/unit/test_workflow_catalog_container_image.py::TestWorkflowCatalogContainerImage::test_transform_handles_missing_container_digest_gracefully PASSED [ 86%]
tests/unit/test_workflow_catalog_container_image.py::TestWorkflowCatalogContainerImage::test_search_result_json_contains_container_image PASSED [ 86%]
tests/unit/test_workflow_catalog_container_image.py::TestWorkflowCatalogContainerImage::test_search_result_json_contains_container_digest PASSED [ 86%]
tests/unit/test_workflow_catalog_container_image.py::TestWorkflowCatalogContainerImage::test_container_image_format_is_valid_oci_reference PASSED [ 87%]
tests/unit/test_workflow_catalog_container_image.py::TestWorkflowCatalogContainerImage::test_container_digest_format_is_valid_sha256 PASSED [ 87%]
tests/unit/test_workflow_catalog_container_image.py::TestWorkflowCatalogContainerImageEdgeCases::test_empty_container_image_string_handled PASSED [ 87%]
tests/unit/test_workflow_catalog_container_image.py::TestWorkflowCatalogContainerImageEdgeCases::test_partial_data_only_image_no_digest PASSED [ 87%]
tests/unit/test_workflow_catalog_container_image.py::TestWorkflowCatalogContainerImageEdgeCases::test_mixed_workflows_some_with_image_some_without PASSED [ 87%]
tests/unit/test_workflow_catalog_remediation_id.py::TestWorkflowCatalogRemediationId::test_tool_accepts_remediation_id_in_constructor PASSED [ 87%]
tests/unit/test_workflow_catalog_remediation_id.py::TestWorkflowCatalogRemediationId::test_remediation_id_passed_in_json_body PASSED [ 88%]
tests/unit/test_workflow_catalog_remediation_id.py::TestWorkflowCatalogRemediationId::test_remediation_id_not_in_http_header PASSED [ 88%]
tests/unit/test_workflow_catalog_remediation_id.py::TestWorkflowCatalogRemediationId::test_no_audit_event_generated_by_holmesgpt_api PASSED [ 88%]
tests/unit/test_workflow_catalog_remediation_id.py::TestWorkflowCatalogRemediationId::test_tool_works_without_remediation_id_for_backwards_compatibility PASSED [ 88%]
tests/unit/test_workflow_catalog_remediation_id.py::TestWorkflowCatalogRemediationId::test_empty_remediation_id_handled_gracefully PASSED [ 88%]
tests/unit/test_workflow_catalog_sdk_investigation_flow.py::TestWorkflowCatalogInSDKInvestigationFlow::test_create_tool_executor_with_workflow_catalog PASSED [ 89%]
tests/unit/test_workflow_catalog_sdk_investigation_flow.py::TestWorkflowCatalogInSDKInvestigationFlow::test_list_server_toolsets_with_workflow_catalog PASSED [ 89%]
tests/unit/test_workflow_catalog_sdk_investigation_flow.py::TestWorkflowCatalogInSDKInvestigationFlow::test_create_issue_investigator_with_workflow_catalog PASSED [ 89%]
tests/unit/test_workflow_catalog_sdk_investigation_flow.py::TestWorkflowCatalogProductionScenario::test_production_incident_analysis_flow PASSED [ 89%]
tests/unit/test_workflow_catalog_sdk_registration.py::TestWorkflowCatalogSDKRegistration::test_toolset_registration_with_config PASSED [ 89%]
tests/unit/test_workflow_catalog_sdk_registration.py::TestWorkflowCatalogSDKRegistration::test_toolset_registration_with_toolset_manager PASSED [ 90%]
tests/unit/test_workflow_catalog_sdk_registration.py::TestWorkflowCatalogSDKRegistration::test_programmatic_toolset_registration PASSED [ 90%]
tests/unit/test_workflow_catalog_sdk_registration.py::TestWorkflowCatalogSDKRegistration::test_tool_availability_for_llm PASSED [ 90%]
tests/unit/test_workflow_catalog_sdk_registration.py::TestWorkflowCatalogSDKRegistration::test_integration_with_incident_analysis_pattern PASSED [ 90%]
tests/unit/test_workflow_catalog_sdk_registration.py::TestWorkflowCatalogSDKRegistration::test_default_toolsets_include_workflow_catalog PASSED [ 90%]
tests/unit/test_workflow_catalog_tool.py::TestInputValidation::test_empty_query_returns_error_u1_1 PASSED [ 91%]
tests/unit/test_workflow_catalog_tool.py::TestInputValidation::test_none_query_returns_error_u1_2 PASSED [ 91%]
tests/unit/test_workflow_catalog_tool.py::TestInputValidation::test_very_long_query_handled_u1_3 PASSED [ 91%]
tests/unit/test_workflow_catalog_tool.py::TestInputValidation::test_whitespace_only_query_handled_u1_4 PASSED [ 91%]
tests/unit/test_workflow_catalog_tool.py::TestInputValidation::test_negative_top_k_handled_u1_5 PASSED [ 91%]
tests/unit/test_workflow_catalog_tool.py::TestInputValidation::test_zero_top_k_returns_empty_u1_6 PASSED [ 91%]
tests/unit/test_workflow_catalog_tool.py::TestInputValidation::test_excessive_top_k_capped_u1_7 PASSED [ 92%]
tests/unit/test_workflow_catalog_tool.py::TestInputValidation::test_invalid_min_similarity_handled_u1_8 PASSED [ 92%]
tests/unit/test_workflow_catalog_tool.py::TestResponseTransformation::test_transforms_uuid_workflow_id_u2_1 PASSED [ 92%]
tests/unit/test_workflow_catalog_tool.py::TestResponseTransformation::test_transforms_title_field_u2_2 PASSED [ 92%]
tests/unit/test_workflow_catalog_tool.py::TestResponseTransformation::test_transforms_singular_signal_type_u2_3 PASSED [ 92%]
tests/unit/test_workflow_catalog_tool.py::TestResponseTransformation::test_transforms_confidence_score_u2_4 PASSED [ 93%]
tests/unit/test_workflow_catalog_tool.py::TestResponseTransformation::test_handles_null_optional_fields_u2_5 PASSED [ 93%]
tests/unit/test_workflow_catalog_tool.py::TestErrorHandling::test_http_error_returns_structured_error_u3_1 PASSED [ 93%]
tests/unit/test_workflow_catalog_tool.py::TestErrorHandling::test_invalid_json_returns_error_u3_2 PASSED [ 93%]
tests/unit/test_workflow_catalog_tool.py::TestErrorHandling::test_connection_timeout_returns_error PASSED [ 93%]
tests/unit/test_workflow_catalog_tool.py::TestErrorHandling::test_connection_refused_returns_error PASSED [ 94%]
tests/unit/test_workflow_catalog_tool.py::TestToolConfiguration::test_tool_name_matches_specification PASSED [ 94%]
tests/unit/test_workflow_catalog_tool.py::TestToolConfiguration::test_tool_has_required_parameters PASSED [ 94%]
tests/unit/test_workflow_catalog_tool.py::TestToolConfiguration::test_toolset_initialization PASSED [ 94%]
tests/unit/test_workflow_catalog_tool.py::TestToolConfiguration::test_toolset_passes_remediation_id PASSED [ 94%]
tests/unit/test_workflow_catalog_tool.py::TestToolConfiguration::test_data_storage_url_configurable PASSED [ 95%]
tests/unit/test_workflow_catalog_toolset.py::TestWorkflowCatalogToolset::test_toolset_initialization_br_hapi_250 PASSED [ 95%]
tests/unit/test_workflow_catalog_toolset.py::TestWorkflowCatalogToolset::test_tool_parameter_validation_br_hapi_250 PASSED [ 95%]
tests/unit/test_workflow_catalog_toolset.py::TestSearchWorkflowCatalogTool::test_get_parameterized_one_liner_br_hapi_250 PASSED [ 95%]
tests/unit/test_workflow_catalog_toolset.py::TestSearchWorkflowCatalogTool::test_error_handling_br_hapi_250 PASSED [ 95%]
tests/unit/test_workflow_catalog_toolset.py::TestWorkflowCatalogDataStorageIntegration::test_http_client_integration_br_storage_013 PASSED [ 95%]
tests/unit/test_workflow_catalog_toolset.py::TestWorkflowCatalogDataStorageIntegration::test_query_transformation_dd_llm_001 PASSED [ 96%]
tests/unit/test_workflow_catalog_toolset.py::TestWorkflowCatalogDataStorageIntegration::test_response_transformation_dd_workflow_004 PASSED [ 96%]
tests/unit/test_workflow_catalog_toolset.py::TestWorkflowCatalogDataStorageIntegration::test_http_error_handling_br_storage_013 PASSED [ 96%]
tests/unit/test_workflow_response_validation.py::TestWorkflowExistenceValidation::test_validate_returns_error_when_workflow_not_found PASSED [ 96%]
tests/unit/test_workflow_response_validation.py::TestWorkflowExistenceValidation::test_validate_continues_when_workflow_exists PASSED [ 96%]
tests/unit/test_workflow_response_validation.py::TestContainerImageConsistencyValidation::test_validate_accepts_matching_container_image PASSED [ 97%]
tests/unit/test_workflow_response_validation.py::TestContainerImageConsistencyValidation::test_validate_accepts_null_container_image PASSED [ 97%]
tests/unit/test_workflow_response_validation.py::TestContainerImageConsistencyValidation::test_validate_rejects_mismatched_container_image PASSED [ 97%]
tests/unit/test_workflow_response_validation.py::TestParameterSchemaValidation::test_validate_rejects_missing_required_parameter PASSED [ 97%]
tests/unit/test_workflow_response_validation.py::TestParameterSchemaValidation::test_validate_accepts_optional_parameter_missing PASSED [ 97%]
tests/unit/test_workflow_response_validation.py::TestParameterSchemaValidation::test_validate_rejects_wrong_type_expected_string PASSED [ 98%]
tests/unit/test_workflow_response_validation.py::TestParameterSchemaValidation::test_validate_rejects_wrong_type_expected_int PASSED [ 98%]
tests/unit/test_workflow_response_validation.py::TestParameterSchemaValidation::test_validate_accepts_all_correct_types PASSED [ 98%]
tests/unit/test_workflow_response_validation.py::TestParameterSchemaValidation::test_validate_rejects_string_too_short PASSED [ 98%]
tests/unit/test_workflow_response_validation.py::TestParameterSchemaValidation::test_validate_rejects_string_too_long PASSED [ 98%]
tests/unit/test_workflow_response_validation.py::TestParameterSchemaValidation::test_validate_rejects_number_below_minimum PASSED [ 99%]
tests/unit/test_workflow_response_validation.py::TestParameterSchemaValidation::test_validate_rejects_number_above_maximum PASSED [ 99%]
tests/unit/test_workflow_response_validation.py::TestParameterSchemaValidation::test_validate_rejects_invalid_enum_value PASSED [ 99%]
tests/unit/test_workflow_response_validation.py::TestParameterSchemaValidation::test_validate_accepts_valid_enum_value PASSED [ 99%]
tests/unit/test_workflow_response_validation.py::TestCompleteValidationFlow::test_validate_returns_all_errors_combined PASSED [ 99%]
tests/unit/test_workflow_response_validation.py::TestCompleteValidationFlow::test_validate_returns_success_when_all_valid PASSED [100%]

=================================== FAILURES ===================================
_____________ TestErrorHandling.test_generic_exception_returns_500 _____________
tests/unit/test_auth_middleware.py:362: in test_generic_exception_returns_500
    response = await middleware.dispatch(request, call_next)
src/middleware/auth.py:267: in dispatch
    return await call_next(request)
/usr/lib64/python3.12/unittest/mock.py:2291: in _execute_mock_call
    raise effect
E   Exception: Unexpected error
_ TestParseInvestigationResultWarnings.test_warning_when_no_workflow_selected __
tests/unit/test_incident_owner_chain_validation.py:204: in test_warning_when_no_workflow_selected
    ???
E   KeyError: 'selected_workflow'
------------------------------ Captured log call -------------------------------
INFO     src.extensions.incident.result_parser:result_parser.py:512 Pattern 1: Matched ```json``` block (114 chars)
INFO     src.extensions.incident.result_parser:result_parser.py:610 {'event': 'alternative_workflows_extraction', 'incident_id': 'inc-001', 'raw_alternatives_count': 0, 'raw_alternatives': []}
INFO     src.extensions.incident.result_parser:result_parser.py:626 {'event': 'alternative_workflows_parsed', 'incident_id': 'inc-001', 'parsed_count': 0}
____ TestParseInvestigationResultWarnings.test_warning_when_low_confidence _____
tests/unit/test_incident_owner_chain_validation.py:233: in test_warning_when_low_confidence
    ???
E   assert False
E    +  where False = any(<generator object TestParseInvestigationResultWarnings.test_warning_when_low_confidence.<locals>.<genexpr> at 0xffff6df720c0>)
------------------------------ Captured log call -------------------------------
INFO     src.extensions.incident.result_parser:result_parser.py:512 Pattern 1: Matched ```json``` block (201 chars)
INFO     src.extensions.incident.result_parser:result_parser.py:610 {'event': 'alternative_workflows_extraction', 'incident_id': 'inc-001', 'raw_alternatives_count': 0, 'raw_alternatives': []}
INFO     src.extensions.incident.result_parser:result_parser.py:626 {'event': 'alternative_workflows_parsed', 'incident_id': 'inc-001', 'parsed_count': 0}
____ TestParseAndValidateInvestigationResult.test_parses_json_from_analysis ____
tests/unit/test_llm_self_correction.py:210: in test_parses_json_from_analysis
    assert result["selected_workflow"] is None
E   KeyError: 'selected_workflow'
------------------------------ Captured log call -------------------------------
INFO     src.extensions.incident.result_parser:result_parser.py:75 {'event': 'sdk_analysis_received', 'incident_id': 'test-456', 'analysis_length': 204, 'has_json_marker': True, 'analysis_preview': '\nBased on my analysis:\n\n```json\n{\n  "root_cause_analysis": {\n    "summary": "Container OOM",\n    "severity": "critical",\n    "contributing_factors": ["memory leak"]\n  },\n  "selected_workflow": null\n}\n```\n'}
INFO     src.extensions.incident.result_parser:result_parser.py:88 Pattern 1: Matched ```json``` block (167 chars)
INFO     src.extensions.incident.result_parser:result_parser.py:210 {'event': 'alternative_workflows_extraction', 'incident_id': 'test-456', 'raw_alternatives_count': 0, 'raw_alternatives': []}
INFO     src.extensions.incident.result_parser:result_parser.py:226 {'event': 'alternative_workflows_parsed', 'incident_id': 'test-456', 'parsed_count': 0}
INFO     src.extensions.incident.result_parser:result_parser.py:274 {'event': 'llm_value_extraction', 'incident_id': 'test-456', 'needs_human_review_from_llm': None, 'human_review_reason_from_llm': None, 'json_data_keys': ['root_cause_analysis', 'selected_workflow']}
INFO     src.extensions.incident.result_parser:result_parser.py:348 E2E-HAPI-003: Using default no_matching_workflows (LLM didn't provide)
INFO     src.extensions.incident.result_parser:result_parser.py:371 {'event': 'validation_attempts_extraction', 'incident_id': 'test-456', 'from_llm': False, 'count': 0, 'type': 'None'}
_ TestParseAndValidateInvestigationResult.test_sets_needs_human_review_for_low_confidence _
tests/unit/test_llm_self_correction.py:265: in test_sets_needs_human_review_for_low_confidence
    assert result["human_review_reason"] == "low_confidence"
E   AssertionError: assert 'rca_incomplete' == 'low_confidence'
E     - low_confidence
E     + rca_incomplete
------------------------------ Captured log call -------------------------------
INFO     src.extensions.incident.result_parser:result_parser.py:75 {'event': 'sdk_analysis_received', 'incident_id': 'test-low-conf', 'analysis_length': 203, 'has_json_marker': True, 'analysis_preview': '\n```json\n{\n  "root_cause_analysis": {"summary": "Maybe OOM", "severity": "medium", "contributing_factors": []},\n  "selected_workflow": {\n    "workflow_id": "restart-pod",\n    "confidence": 0.5\n  }\n}\n```\n'}
INFO     src.extensions.incident.result_parser:result_parser.py:88 Pattern 1: Matched ```json``` block (189 chars)
INFO     src.extensions.incident.result_parser:result_parser.py:210 {'event': 'alternative_workflows_extraction', 'incident_id': 'test-low-conf', 'raw_alternatives_count': 0, 'raw_alternatives': []}
INFO     src.extensions.incident.result_parser:result_parser.py:226 {'event': 'alternative_workflows_parsed', 'incident_id': 'test-low-conf', 'parsed_count': 0}
INFO     src.extensions.incident.result_parser:result_parser.py:274 {'event': 'llm_value_extraction', 'incident_id': 'test-low-conf', 'needs_human_review_from_llm': None, 'human_review_reason_from_llm': None, 'json_data_keys': ['root_cause_analysis', 'selected_workflow']}
WARNING  src.extensions.incident.result_parser:result_parser.py:362 {'event': 'rca_incomplete_missing_affected_resource', 'incident_id': 'test-low-conf', 'selected_workflow_id': 'restart-pod', 'message': 'BR-HAPI-212: Workflow selected but affectedResource missing from RCA'}
INFO     src.extensions.incident.result_parser:result_parser.py:371 {'event': 'validation_attempts_extraction', 'incident_id': 'test-low-conf', 'from_llm': False, 'count': 0, 'type': 'None'}
=============================== warnings summary ===============================
src/models/recovery_models.py:196
  /workspace/holmesgpt-api/src/models/recovery_models.py:196: UserWarning: `validate_recovery_attempt_number` overrides an existing Pydantic `@field_validator` decorator
    def validate_recovery_attempt_number(cls, v: Optional[int], info) -> Optional[int]:

src/models/recovery_models.py:114
  /workspace/holmesgpt-api/src/models/recovery_models.py:114: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class RecoveryRequest(BaseModel):

src/models/recovery_models.py:253
  /workspace/holmesgpt-api/src/models/recovery_models.py:253: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class RecoveryResponse(BaseModel):

../../opt/app-root/lib64/python3.12/site-packages/supabase/_async/auth_client.py:3
  /opt/app-root/lib64/python3.12/site-packages/supabase/_async/auth_client.py:3: DeprecationWarning: The `gotrue` package is deprecated, is not going to receive updates in the future. Please, use `supabase_auth` instead.
    from gotrue import (

src/errors.py:40
  /workspace/holmesgpt-api/src/errors.py:40: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class RFC7807Error(BaseModel):

tests/unit/test_recovery.py::TestRecoveryEndpoint::test_recovery_handles_missing_fields
  /workspace/holmesgpt-api/src/middleware/rfc7807.py:147: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    content=error.dict(),

tests/unit/test_rfc7807_errors.py::test_rfc7807_error_model_structure
  /workspace/holmesgpt-api/tests/unit/test_rfc7807_errors.py:75: PydanticDeprecatedSince20: The `dict` method is deprecated; use `model_dump` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    error_dict = error.dict()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html

---------- coverage: platform linux, python 3.12.12-final-0 ----------
Name                                            Stmts   Miss   Cover   Missing
------------------------------------------------------------------------------
src/__init__.py                                     2      0 100.00%
src/audit/__init__.py                               5      0 100.00%
src/audit/buffered_store.py                       177    145  18.08%   125-184, 204-229, 247-267, 283-310, 325-383, 399-427, 442-502
src/audit/events.py                                39      2  94.87%   402-410
src/audit/factory.py                               23     13  43.48%   82-114
src/auth/__init__.py                                5      0 100.00%
src/auth/interfaces.py                              8      2  75.00%   75, 135
src/auth/k8s_auth.py                               62     49  20.97%   74-80, 102-170, 204-210, 242-316
src/auth/mock_auth.py                              38      9  76.32%   125-129, 142-147, 259-263, 267-278
src/config/__init__.py                              2      0 100.00%
src/config/constants.py                            10      0 100.00%
src/config/debug_config.py                         42     42   0.00%   23-167
src/config/hot_reload.py                          204     27  86.76%   28-29, 107, 117, 128, 145-146, 183-189, 195-207, 213, 277-278, 458, 465, 472
src/config/logging_config.py                       36     11  69.44%   52, 61, 95-101, 120-122, 142
src/errors.py                                     102      2  98.04%   225, 301
src/extensions/__init__.py                          3      0 100.00%
src/extensions/health.py                           50     11  78.00%   43-48, 60-62, 161-165
src/extensions/incident/__init__.py                17      0 100.00%
src/extensions/incident/constants.py                6      0 100.00%
src/extensions/incident/endpoint.py                51     39  23.53%   79-180
src/extensions/incident/llm_integration.py        191    144  24.61%   110, 114, 118, 122, 126, 130, 134, 208-673
src/extensions/incident/prompt_builder.py         118     25  78.81%   59, 78, 87, 100, 124, 152, 267-274, 282-283, 294, 298-299, 332-333, 349-364
src/extensions/incident/result_parser.py          355    189  46.76%   98-106, 111-179, 196-200, 235-254, 263-265, 288-290, 299-301, 318-323, 331-336, 350, 401-402, 514, 520-530, 535-579, 590-601, 617-620, 635-673, 710-711, 715-716, 725-730, 738-743, 756-759, 765-774
src/extensions/llm_config.py                      133     44  66.92%   88-97, 105-135, 143-153, 201, 205, 211-218, 349, 423-447, 510
src/extensions/postexec.py                         72     72   0.00%   17-180
src/extensions/recovery/__init__.py                 8      0 100.00%
src/extensions/recovery/constants.py               15      0 100.00%
src/extensions/recovery/endpoint.py                28      2  92.86%   76, 104
src/extensions/recovery/llm_integration.py        152    114  25.00%   120-121, 159-161, 187-596
src/extensions/recovery/prompt_builder.py         155     20  87.10%   182, 196, 204, 252, 256, 325-342, 440
src/extensions/recovery/result_parser.py          199    145  27.14%   46-87, 98-391, 420, 444, 486, 493-507
src/extensions/recovery_new_prompt.py              54     54   0.00%   17-362
src/main.py                                       153     77  49.67%   87-98, 114, 147, 160, 214-215, 226-232, 261-285, 332-365, 374, 422-512
src/metrics/__init__.py                             3      0 100.00%
src/metrics/constants.py                           32      0 100.00%
src/metrics/instrumentation.py                     37     16  56.76%   173, 185-197, 222-243
src/middleware/__init__.py                          3      0 100.00%
src/middleware/auth.py                             60     15  75.00%   173-183, 241-258, 293, 295, 302-308
src/middleware/metrics.py                          71     15  78.87%   175-198, 214, 227, 231, 235, 283-292
src/middleware/rfc7807.py                          51     17  66.67%   66-73, 95-121
src/middleware/user_context.py                     20     10  50.00%   82, 121-132
src/models/__init__.py                              4      0 100.00%
src/models/audit_models.py                          7      0 100.00%
src/models/config_models.py                        35      0 100.00%
src/models/incident_models.py                      97      2  97.94%   129, 225
src/models/recovery_models.py                     100      7  93.00%   172, 180, 190-192, 202, 204
src/sanitization/__init__.py                        3      0 100.00%
src/sanitization/llm_sanitizer.py                  96     17  82.29%   112-119, 170, 178-181, 186-187, 190, 200, 205, 494-502, 508
src/toolsets/__init__.py                            3      0 100.00%
src/toolsets/workflow_catalog.py                  248     51  79.44%   133, 137-138, 228-229, 232-233, 249-289, 466, 470, 490-500, 505, 599, 634, 640, 642, 644, 742-756, 902, 906, 1020, 1022, 1024, 1140
src/validation/__init__.py                          3      0 100.00%
src/validation/workflow_response_validator.py     131      8  93.89%   170-172, 250, 319, 327, 356, 360
------------------------------------------------------------------------------
TOTAL                                            3519   1396  60.33%
Coverage HTML written to dir htmlcov

============================= slowest 20 durations =============================
1.01s call     tests/unit/test_errors.py::TestCircuitBreaker::test_half_open_to_closed_on_success
1.01s call     tests/unit/test_errors.py::TestCircuitBreaker::test_half_open_after_recovery_timeout
0.81s call     tests/unit/test_file_watcher.py::TestFileWatcherHashTracking::test_file_watcher_skips_unchanged_content
0.53s call     tests/unit/test_file_watcher.py::TestFileWatcherChangeDetection::test_file_watcher_debounces_rapid_changes
0.43s call     tests/unit/test_file_watcher.py::TestFileWatcherGracefulDegradation::test_file_watcher_graceful_on_callback_error
0.42s call     tests/unit/test_hot_reload.py::TestHotReloadIntegration::test_graceful_degradation_on_invalid_yaml
0.31s call     tests/unit/test_errors.py::TestRetryWithBackoff::test_raises_max_retries_exceeded
0.30s call     tests/unit/test_errors.py::TestRetryWithBackoff::test_exponential_backoff_timing
0.22s call     tests/unit/test_config_manager.py::TestConfigManagerHotReload::test_invalid_yaml_keeps_previous_config
0.22s call     tests/unit/test_file_watcher.py::TestFileWatcherMetrics::test_file_watcher_reload_count
0.22s call     tests/unit/test_config_manager.py::TestConfigManagerHotReload::test_config_reload_updates_values
0.21s call     tests/unit/test_hot_reload.py::TestHotReloadIntegration::test_config_reload_reflects_in_getters
0.21s call     tests/unit/test_file_watcher.py::TestFileWatcherMetrics::test_file_watcher_error_count
0.21s call     tests/unit/test_config_manager.py::TestConfigManagerMetrics::test_reload_count_increments
0.21s call     tests/unit/test_file_watcher.py::TestFileWatcherChangeDetection::test_file_watcher_detects_change
0.21s call     tests/unit/test_config_manager.py::TestConfigManagerMetrics::test_last_hash_updates
0.21s call     tests/unit/test_config_manager.py::TestConfigManagerDisableHotReload::test_disable_hot_reload
0.20s call     tests/unit/test_hot_reload.py::TestHotReloadIntegration::test_hot_reload_disabled_via_env
0.14s call     tests/unit/test_sdk_registration_fix.py::TestSDKRegistrationFix::test_toolset_available_via_list_server_toolsets
0.10s call     tests/unit/test_errors.py::TestRetryWithBackoff::test_retries_on_failure
=========================== short test summary info ============================
FAILED tests/unit/test_auth_middleware.py::TestErrorHandling::test_generic_exception_returns_500
FAILED tests/unit/test_incident_owner_chain_validation.py::TestParseInvestigationResultWarnings::test_warning_when_no_workflow_selected
FAILED tests/unit/test_incident_owner_chain_validation.py::TestParseInvestigationResultWarnings::test_warning_when_low_confidence
FAILED tests/unit/test_llm_self_correction.py::TestParseAndValidateInvestigationResult::test_parses_json_from_analysis
FAILED tests/unit/test_llm_self_correction.py::TestParseAndValidateInvestigationResult::test_sets_needs_human_review_for_low_confidence
================== 5 failed, 519 passed, 7 warnings in 16.85s ==================
