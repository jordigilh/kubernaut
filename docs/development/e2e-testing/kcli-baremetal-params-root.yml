# KCLI OpenShift 4.18 Virtualized Configuration for Root User on RHEL 9.7
#
# IMPORTANT: This configuration deploys OpenShift in a virtualized environment using KCLI VMs
# It is NOT for actual bare metal with IPMI - use this for lab/testing environments
#
# FIXES APPLIED:
# - Set baremetal: false to prevent platform: none configuration
# - Removed baremetal_hosts section to ensure proper VM-based deployment
# - Disabled local_storage due to missing block devices in VMs
# - This prevents compact cluster deployment where workers aren't created
#
# For actual bare metal deployment, see: kcli-baremetal-params-physical.yml

# Cluster Configuration
cluster: e2e
domain: kubernaut.io
version: stable
tag: '4.18'

# Authentication - Root user paths
pull_secret: '/root/.pull-secret.txt'
ssh_key: '/root/.ssh/id_rsa.pub'

# Network Configuration
network: default
cidr: 192.168.122.0/24
api_ip: 192.168.122.100
ingress_ip: 192.168.122.101

# CRITICAL: Disable bare metal provisioning for virtualized deployment
# This prevents the platform: none configuration that causes compact clusters
provisioning_enable: false
baremetal: false

# Node Specifications (Optimized for RHEL 9.7 host: Intel Xeon Gold 5218R, 256GB RAM, 3TB disk)
# Resource allocation: ~84GB RAM, 24 vCPU, ~500GB disk (leaves 172GB+ RAM, 16+ CPU, 2.5TB+ disk free)
ctlplane: 3
workers: 3
ctlplane_memory: 16384  # 16 GB (reduced for testing environment)
ctlplane_numcpus: 4     # 4 vCPU (reduced from 8 for better resource sharing)
ctlplane_disk: 80       # 80 GB (sufficient for testing)
worker_memory: 12288  # 12 GB (reduced for testing environment)
worker_numcpus: 4     # 4 vCPU (adequate for testing workloads)
worker_disk: 80       # 80 GB (sufficient for testing)

# RHEL 9.7 Host Configuration - Root User Optimized
hypervisor: kvm       # Use KVM on RHEL 9.7
cpu_model: host-passthrough  # Use host CPU features for better performance
libvirt_user: root    # Run libvirt as root
pool_path: /var/lib/libvirt/images  # Root libvirt storage path

# Storage Configuration
disk_interface: virtio
disk_pool: default

# VIRTUALIZED DEPLOYMENT - No bare metal hosts needed
# KCLI will create VMs automatically based on ctlplane/workers counts
# Remove baremetal_hosts section to prevent platform: none configuration

# For actual bare metal deployment, use a separate config file with:
# - baremetal: true
# - provisioning_enable: true
# - baremetal_hosts: [list of physical servers with IPMI details]

# Installation Options - Updated for virtualized deployment
notify: false                   # Disable notifications

# Storage Configuration - Updated for virtualized environment
storage_operators: true         # Install storage operators automatically
local_storage: false           # DISABLED: LSO requires additional block devices
odf: true                      # Install OpenShift Data Foundation (ODF)
odf_size: "100Gi"              # ODF storage size per node

# Note: Local storage devices /dev/sdb, /dev/sdc don't exist in VMs
# For local storage testing, either:
# 1. Add additional virtual disks to VMs, or
# 2. Use file-based loop devices

# Post-deployment Applications and Operators
apps:
  - odf-operator               # OpenShift Data Foundation
  - monitoring                 # Enhanced monitoring for storage
# Note: local-storage-operator removed due to missing block devices in VMs

# Advanced Options
disconnected: false             # Set to true for air-gapped environments
nfs: false                     # Use NFS for storage
metallb: false                 # Install MetalLB for load balancing
sno: false                     # Single Node OpenShift (overrides node counts)

# Root User Specific Configuration
root_home: /root               # Root home directory
kcli_config_path: /root/.kcli  # KCLI configuration path for root
kubeconfig_path: /root/.kcli/clusters  # Kubeconfig storage path

# Optional: Custom Registry Configuration (for disconnected installs)
# disconnected_url: "registry.kubernaut.io:5000"
# disconnected_user: "admin"
# disconnected_password: "password"
# disconnected_prefix: "ocp4"

# Optional: Additional Trust Bundle
# ca_bundle: |
#   -----BEGIN CERTIFICATE-----
#   ... your CA certificate content ...
#   -----END CERTIFICATE-----

# Optional: Image Content Sources (for disconnected installs)
# imagecontentsources: |
#   - mirrors:
#     - registry.kubernaut.io:5000/ocp4/openshift4
#     source: quay.io/openshift-release-dev/ocp-release
#   - mirrors:
#     - registry.kubernaut.io:5000/ocp4/openshift4
#     source: quay.io/openshift-release-dev/ocp-v4.0-art-dev

# Optional: Custom Network Configuration
# network_config: |
#   interfaces:
#   - name: enp1s0
#     type: ethernet
#     state: up
#     ipv4:
#       enabled: true
#       dhcp: false
#       address:
#       - ip: 192.168.122.50
#         prefix-length: 24
#       gateway: 192.168.122.1
#       dns-resolver:
#         config:
#           server:
#           - 8.8.8.8
#           - 8.8.4.4
