kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  # Expose Notification Controller metrics via NodePort to host machine
  # This eliminates kubectl port-forward instability for E2E tests
  # Using 8081 on host (gateway uses 8080) - proven port pattern
  extraPortMappings:
  - containerPort: 30081  # Notification metrics NodePort in cluster
    hostPort: 8081        # Port on host machine (localhost:8081) - matches gateway pattern
    protocol: TCP
  kubeadmConfigPatches:
  - |
    kind: ClusterConfiguration
    apiServer:
      extraArgs:
        # Increase API server rate limits for parallel E2E testing
        # Default max-requests-inflight: 400
        # Default max-mutating-requests-inflight: 200
        # With 4 parallel test processes Ã— 100 concurrent notifications = 400 QPS
        # These limits provide 2x headroom for test stability
        max-requests-inflight: "800"
        max-mutating-requests-inflight: "400"
    controllerManager:
      extraArgs:
        # Increase controller manager QPS for CRD operations
        # Default kube-api-qps: 20, kube-api-burst: 30
        # Higher limits prevent CRD creation delays during parallel testing
        kube-api-qps: "100"
        kube-api-burst: "200"
- role: worker


