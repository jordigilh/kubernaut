---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.19.0
  name: signalprocessings.signalprocessing.kubernaut.ai
spec:
  group: signalprocessing.kubernaut.ai
  names:
    kind: SignalProcessing
    listKind: SignalProcessingList
    plural: signalprocessings
    singular: signalprocessing
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .status.environmentClassification.environment
      name: Environment
      type: string
    - jsonPath: .status.priorityAssignment.priority
      name: Priority
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          SignalProcessing is the Schema for the signalprocessings API.
          DD-SIGNAL-PROCESSING-001: Renamed from RemediationProcessing per ADR-015
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: |-
              SignalProcessingSpec defines the desired state of SignalProcessing.
              Implementation Plan Day 2: Aligned with IMPLEMENTATION_PLAN.md structure
            properties:
              enrichmentConfig:
                description: Configuration for processing
                properties:
                  enableClusterState:
                    description: Enable cluster state enrichment
                    type: boolean
                  enableHistorical:
                    description: Enable historical enrichment
                    type: boolean
                  enableMetrics:
                    description: Enable metrics enrichment
                    type: boolean
                  timeout:
                    description: Timeout for enrichment operations
                    type: string
                type: object
              remediationRequestRef:
                description: Reference to parent RemediationRequest
                properties:
                  apiVersion:
                    description: API version of the referent
                    type: string
                  kind:
                    description: Kind of the referent
                    type: string
                  name:
                    description: Name of the referent
                    type: string
                  namespace:
                    description: Namespace of the referent
                    type: string
                  uid:
                    description: UID of the referent
                    type: string
                required:
                - name
                type: object
              signal:
                description: Signal data (copied from RemediationRequest for processing)
                properties:
                  annotations:
                    additionalProperties:
                      type: string
                    description: Signal annotations extracted from provider-specific
                      data
                    type: object
                  fingerprint:
                    description: Unique fingerprint for deduplication (SHA256 of signal
                      key fields)
                    maxLength: 64
                    pattern: ^[a-f0-9]{64}$
                    type: string
                  firingTime:
                    description: When the signal first started firing
                    format: date-time
                    type: string
                  labels:
                    additionalProperties:
                      type: string
                    description: Signal labels extracted from provider-specific data
                    type: object
                  name:
                    description: Human-readable signal name (e.g., "HighMemoryUsage",
                      "CrashLoopBackOff")
                    maxLength: 253
                    type: string
                  providerData:
                    description: Provider-specific fields in raw JSON format
                    format: byte
                    type: string
                  receivedTime:
                    description: When Gateway received the signal
                    format: date-time
                    type: string
                  severity:
                    description: Severity level
                    enum:
                    - critical
                    - warning
                    - info
                    type: string
                  source:
                    description: Adapter that ingested the signal
                    maxLength: 63
                    type: string
                  targetResource:
                    description: Target resource identification
                    properties:
                      kind:
                        description: Resource kind (e.g., "Pod", "Deployment", "StatefulSet")
                        type: string
                      name:
                        description: Resource name
                        type: string
                      namespace:
                        description: Resource namespace
                        type: string
                    required:
                    - kind
                    - name
                    - namespace
                    type: object
                  targetType:
                    description: Target system type
                    enum:
                    - kubernetes
                    - aws
                    - azure
                    - gcp
                    - datadog
                    type: string
                  type:
                    description: 'Signal type: "prometheus", "kubernetes-event", "aws-cloudwatch",
                      etc.'
                    type: string
                required:
                - fingerprint
                - name
                - receivedTime
                - severity
                - targetResource
                - targetType
                - type
                type: object
            required:
            - remediationRequestRef
            - signal
            type: object
          status:
            description: |-
              SignalProcessingStatus defines the observed state of SignalProcessing.
              Implementation Plan Day 2: Aligned with IMPLEMENTATION_PLAN.md structure
            properties:
              businessClassification:
                description: |-
                  BusinessClassification for multi-dimensional categorization.
                  BR-SP-080, BR-SP-081: Business Classification
                properties:
                  businessUnit:
                    description: Business unit assignment
                    type: string
                  criticality:
                    description: 'Criticality level: critical, high, medium, low'
                    type: string
                  overallConfidence:
                    description: Overall confidence (0.0-1.0)
                    type: number
                  serviceOwner:
                    description: Service owner
                    type: string
                  slaRequirement:
                    description: 'SLA requirement: platinum, gold, silver, bronze'
                    type: string
                required:
                - overallConfidence
                type: object
              completionTime:
                format: date-time
                type: string
              conditions:
                description: Conditions for detailed status
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              environmentClassification:
                description: Categorization results (DD-CATEGORIZATION-001)
                properties:
                  classifiedAt:
                    description: When classification was performed
                    format: date-time
                    type: string
                  confidence:
                    description: Confidence score (0.0-1.0)
                    type: number
                  environment:
                    description: 'Environment: production, staging, development, test'
                    type: string
                  source:
                    description: 'Source of classification: namespace-labels, configmap,
                      signal-labels, default'
                    type: string
                required:
                - classifiedAt
                - confidence
                - environment
                - source
                type: object
              error:
                description: Error information
                type: string
              kubernetesContext:
                description: Enrichment results
                properties:
                  customLabels:
                    additionalProperties:
                      type: string
                    description: Custom labels (extracted via Rego policies)
                    type: object
                  deployment:
                    description: Deployment details if target is managed by deployment
                    properties:
                      annotations:
                        additionalProperties:
                          type: string
                        description: Deployment annotations
                        type: object
                      availableReplicas:
                        description: Available replicas
                        format: int32
                        type: integer
                      labels:
                        additionalProperties:
                          type: string
                        description: Deployment labels
                        type: object
                      readyReplicas:
                        description: Ready replicas
                        format: int32
                        type: integer
                      replicas:
                        description: Desired replicas
                        format: int32
                        type: integer
                    type: object
                  detectedLabels:
                    description: Detected labels (auto-detected cluster characteristics)
                    properties:
                      gitOpsManaged:
                        description: Whether the target is managed by ArgoCD/Flux
                        type: boolean
                      hasHPA:
                        description: Whether the target has an HPA (HorizontalPodAutoscaler)
                        type: boolean
                      hasPDB:
                        description: Whether the target has a PDB (PodDisruptionBudget)
                        type: boolean
                      hasResourceLimits:
                        description: Whether the target has resource limits defined
                        type: boolean
                      helmManaged:
                        description: Whether the target is managed by Helm
                        type: boolean
                      isProduction:
                        description: Whether the target is in a production namespace
                        type: boolean
                      networkIsolated:
                        description: Whether the namespace has network isolation
                        type: boolean
                      serviceMesh:
                        description: Whether the namespace is part of a service mesh
                        type: boolean
                    type: object
                  namespaceAnnotations:
                    additionalProperties:
                      type: string
                    description: Namespace annotations
                    type: object
                  namespaceLabels:
                    additionalProperties:
                      type: string
                    description: Namespace labels
                    type: object
                  node:
                    description: Node details where the pod is running
                    properties:
                      allocatable:
                        additionalProperties:
                          type: string
                        description: Allocatable resources
                        type: object
                      conditions:
                        description: Node conditions
                        items:
                          description: NodeCondition represents a node condition.
                          properties:
                            reason:
                              description: Reason for condition
                              type: string
                            status:
                              description: Condition status
                              type: string
                            type:
                              description: Condition type
                              type: string
                          required:
                          - status
                          - type
                          type: object
                        type: array
                      labels:
                        additionalProperties:
                          type: string
                        description: Node labels
                        type: object
                    type: object
                  ownerChain:
                    description: Owner chain from target to top-level controller
                    items:
                      description: |-
                        OwnerChainEntry represents one owner in the ownership chain.
                        BR-SP-100: OwnerChain Builder
                      properties:
                        apiVersion:
                          description: Owner API version
                          type: string
                        kind:
                          description: Owner kind
                          type: string
                        name:
                          description: Owner name
                          type: string
                        uid:
                          description: Owner UID
                          type: string
                      required:
                      - kind
                      - name
                      type: object
                    type: array
                  pod:
                    description: Pod details if target is a pod
                    properties:
                      annotations:
                        additionalProperties:
                          type: string
                        description: Pod annotations
                        type: object
                      containerStatuses:
                        description: Container statuses
                        items:
                          description: ContainerStatus contains container state information.
                          properties:
                            lastTerminationReason:
                              description: Last termination reason
                              type: string
                            name:
                              description: Container name
                              type: string
                            ready:
                              description: Whether container is ready
                              type: boolean
                            restartCount:
                              description: Restart count
                              format: int32
                              type: integer
                            state:
                              description: Container state
                              type: string
                          required:
                          - name
                          - ready
                          - restartCount
                          type: object
                        type: array
                      labels:
                        additionalProperties:
                          type: string
                        description: Pod labels
                        type: object
                      nodeName:
                        description: Node name where pod is scheduled
                        type: string
                      phase:
                        description: Pod phase
                        type: string
                    type: object
                type: object
              phase:
                description: 'Phase: Pending, Enriching, Classifying, Categorizing,
                  Completed, Failed'
                enum:
                - pending
                - enriching
                - classifying
                - categorizing
                - completed
                - failed
                type: string
              priorityAssignment:
                description: |-
                  PriorityAssignment from DD-CATEGORIZATION-001.
                  BR-SP-070-072: Priority Assignment
                properties:
                  assignedAt:
                    description: When assignment was performed
                    format: date-time
                    type: string
                  confidence:
                    description: Confidence score (0.0-1.0)
                    type: number
                  policyName:
                    description: Which Rego rule matched (if applicable)
                    type: string
                  priority:
                    description: 'Priority level: P0, P1, P2, P3'
                    type: string
                  source:
                    description: 'Source of assignment: rego-policy, fallback-matrix'
                    type: string
                required:
                - assignedAt
                - confidence
                - priority
                - source
                type: object
              recoveryContext:
                description: |-
                  RecoveryContext holds context for recovery attempts.
                  DD-001: Recovery Context Enrichment
                properties:
                  attemptCount:
                    description: Number of previous attempts
                    format: int32
                    type: integer
                  lastFailureReason:
                    description: Last failure reason
                    type: string
                  previousRemediationId:
                    description: Previous remediation attempt ID
                    type: string
                  timeSinceFirstFailure:
                    description: Time since first failure
                    type: string
                type: object
              startTime:
                description: Processing timestamps
                format: date-time
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
