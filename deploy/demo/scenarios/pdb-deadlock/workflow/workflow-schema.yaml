# Relax PDB Workflow Schema - Job Backend (BR-WORKFLOW-004)
# Scenario: #124 -- PDB deadlock -> temporarily relax PDB
metadata:
  workflowId: relax-pdb-v1
  version: "1.0.0"
  description:
    what: "Temporarily relaxes a PodDisruptionBudget by reducing minAvailable to allow voluntary disruptions to proceed"
    whenToUse: "When a PDB is blocking rolling updates or node drains because minAvailable equals the replica count, leaving zero allowed disruptions"
    whenNotToUse: "When pods are genuinely unhealthy and the PDB is correctly protecting against further disruption during an outage"
    preconditions: "All pods matching the PDB selector are healthy, and the blocking is caused by an overly conservative minAvailable setting rather than actual instability"

actionType: RelaxPDB

labels:
  signalName: KubePodDisruptionBudgetAtLimit
  severity: [low, high, critical]
  environment: [production, staging]
  component: "*"
  priority: "*"

detectedLabels:
  pdbProtected: "true"

execution:
  engine: job
  bundle: quay.io/kubernaut-cicd/test-workflows/relax-pdb-job@sha256:0f11f8b0d1afa7bb3d5667f9ceb3874700846fb3aba34ce7661917e5fe06a379

parameters:
  - name: TARGET_NAMESPACE
    type: string
    required: true
    description: "Namespace of the PDB"
  - name: TARGET_PDB
    type: string
    required: true
    description: "Name of the PDB to relax"
