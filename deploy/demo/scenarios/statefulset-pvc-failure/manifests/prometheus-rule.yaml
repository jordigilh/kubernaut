apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: kubernaut-statefulset-rules
  namespace: demo-statefulset
  labels:
    release: prometheus
spec:
  groups:
  - name: kubernaut-statefulset
    rules:
    - alert: KubernautStatefulSetReplicasMismatch
      expr: |
        kube_statefulset_status_replicas_ready{
          namespace="demo-statefulset",
          statefulset="kv-store"
        }
        <
        kube_statefulset_status_replicas{
          namespace="demo-statefulset",
          statefulset="kv-store"
        }
      for: 3m
      labels:
        severity: critical
      annotations:
        summary: >
          StatefulSet {{ $labels.statefulset }} has
          {{ $value }} ready replicas vs desired. A PVC issue may be preventing
          pod scheduling.
        description: >
          The kv-store StatefulSet in namespace demo-statefulset has fewer ready
          replicas than desired. This typically indicates a PVC binding failure
          or storage issue preventing a pod from starting.
