# Graceful Restart Workflow Schema - Job Backend (BR-WORKFLOW-004)
# Scenario: #120 -- CrashLoopBackOff -> rollback to working config
metadata:
  workflowId: crashloop-rollback-v1
  version: "1.0.0"
  description:
    what: "Rolls back a deployment to its previous revision to recover from CrashLoopBackOff caused by a bad configuration change"
    whenToUse: "When a deployment enters CrashLoopBackOff immediately after a config or image change, and the previous revision was healthy"
    whenNotToUse: "When the crash is caused by an external dependency failure (database down, network partition) rather than a local configuration change"
    preconditions: "The deployment has at least one previous healthy revision in its rollout history"

actionType: GracefulRestart

labels:
  signalType: CrashLoopBackOff
  severity: [critical, low]
  environment: [production, staging]
  component: "*"
  priority: "*"

execution:
  engine: job
  bundle: quay.io/kubernaut-cicd/test-workflows/crashloop-rollback-job@sha256:6b60efbc4eda9e54ec4402f6bc3e0f8fcec1b99708b27b5e217d4ce7136bf185

parameters:
  - name: TARGET_NAMESPACE
    type: string
    required: true
    description: "Namespace of the affected deployment"
  - name: TARGET_DEPLOYMENT
    type: string
    required: true
    description: "Name of the deployment to roll back"
