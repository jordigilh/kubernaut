openapi: 3.0.3
info:
  title: Data Storage Service API
  version: 1.0.0
  description: |
    Data Storage Service provides REST API access to audit trail persistence.

    **Business Requirements**:
    - BR-STORAGE-001 to BR-STORAGE-020: Audit write API
    - BR-STORAGE-021: Incident query API (READ)
    - BR-STORAGE-024: RFC 7807 error responses
    - BR-AUDIT-006: Legal hold capability (SOC2 Gap #8)

    **Design Decisions**:
    - ADR-031: OpenAPI 3.0+ specification for all stateless REST APIs
    - ADR-032: Data Access Layer Isolation (only Data Storage connects to PostgreSQL)
    - DD-009: Dead Letter Queue fallback on database errors
    - DD-AUTH-004: OAuth-proxy sidecar for authentication/authorization
    - DD-AUTH-005: Client authentication pattern (ServiceAccount tokens)

    **Architecture**:
    This service is the **ONLY** service that directly accesses PostgreSQL.
    All other services (Context API, Effectiveness Monitor, etc.) access data
    through this REST API Gateway.

    **Authentication & Authorization (Production/E2E)**:
    All requests to DataStorage are protected by an OAuth-proxy sidecar:

    1. **Client Authentication**: Services authenticate with Kubernetes ServiceAccount tokens
       - Token mounted at: `/var/run/secrets/kubernetes.io/serviceaccount/token`
       - Clients inject: `Authorization: Bearer <token>` header
       - See DD-AUTH-005 for client implementation patterns

    2. **OAuth-Proxy Validation**: The sidecar validates requests
       - Validates JWT token signature and expiration
       - Performs Subject Access Review (SAR) to check RBAC permissions
       - Injects `X-Auth-Request-User` header with authenticated user identity
       - Returns HTTP 401 if token invalid, HTTP 403 if SAR fails

    3. **Handler Enforcement**: DataStorage handlers extract user identity
       - Legal hold operations REQUIRE `X-Auth-Request-User` header
       - HTTP 401 returned if header missing (authentication failed)
       - User identity stored in audit events for SOC2 compliance

    **Routing Flow**:
    ```
    Client → data-storage-service:8080 (Service)
           ↓
         oauth-proxy:8080 (validates token + SAR)
           ↓
         DataStorage:8081 (X-Auth-Request-User header)
    ```

    **Integration Tests**:
    Integration tests run without oauth-proxy. Use `testutil.NewMockUserTransport()`
    to inject mock `X-Auth-Request-User` headers directly.

    **SOC2 Compliance**:
    - All legal hold operations attributed to authenticated users
    - Audit trail captures placed_by/released_by from X-Auth-Request-User
    - Unauthorized access blocked at oauth-proxy layer (defense-in-depth)
  contact:
    name: Kubernaut Platform Team
    url: https://github.com/jordigilh/kubernaut
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html

servers:
  - url: http://localhost:8080
    description: Local development server
  - url: http://data-storage-service.kubernaut.svc.cluster.local:8080
    description: Kubernetes cluster service

tags:
  - name: Audit Write API
    description: |
      Audit trail persistence for all Kubernaut services.
      Implements BR-STORAGE-001 to BR-STORAGE-020.
  - name: Incident Read API
    description: |
      Query API for incident data.
      Implements BR-STORAGE-021.
  - name: Workflow Catalog API
    description: |
      Workflow catalog management and three-step discovery protocol.
      Implements BR-STORAGE-013, BR-STORAGE-014, BR-HAPI-017-001.
      V1.0: Label-only matching via action_type taxonomy (DD-WORKFLOW-016).
  - name: Workflow Discovery API
    description: |
      Three-step workflow discovery protocol for LLM-driven remediation.
      Step 1: List available action types (GET /actions)
      Step 2: List workflows for action type (GET /actions/{action_type})
      Step 3: Get workflow with security gate (GET /workflows/{id} + context filters)
      Authority: DD-WORKFLOW-016, DD-HAPI-017.
  - name: Health
    description: Health check endpoints (DD-007 graceful shutdown support)
  - name: Metrics
    description: Prometheus metrics endpoint (BR-STORAGE-019)
  - name: Audit Reconstruction API
    description: |
      RemediationRequest reconstruction from audit trail.
      Implements BR-AUDIT-006 (SOC2 compliance).
  - name: Remediation History API
    description: |
      Remediation history context for LLM prompt enrichment.
      Aggregates RO and EM audit events into structured remediation chains.
      Authority: DD-HAPI-016.

paths:
  /api/v1/workflows/actions:
    get:
      tags:
        - Workflow Discovery API
      summary: List available action types
      description: |
        Step 1 of the three-step workflow discovery protocol.
        Returns action types from the taxonomy that have active workflows matching
        the provided signal context filters.

        **Authority**: DD-WORKFLOW-016 (Action-Type Workflow Catalog Indexing)
        **Business Requirement**: BR-HAPI-017-001 (Three-Step Tool Implementation)

        **Behavior**:
        - Queries action_type_taxonomy joined with remediation_workflow_catalog
        - Filters by active workflows matching signal context (severity, component, environment, priority)
        - Returns action types with descriptions and workflow counts
        - Paginated (default 10 per page)
        - Emits `workflow.catalog.actions_listed` audit event (DD-WORKFLOW-014 v3.0)
      operationId: listAvailableActions
      parameters:
        - name: severity
          in: query
          required: true
          schema:
            type: string
            enum: [critical, high, medium, low]
          description: Signal severity level
        - name: component
          in: query
          required: true
          schema:
            type: string
          description: Kubernetes resource type (pod, deployment, node, etc.)
        - name: environment
          in: query
          required: true
          schema:
            type: string
          description: Target environment (production, staging, etc.)
        - name: priority
          in: query
          required: true
          schema:
            type: string
            enum: [P0, P1, P2, P3]
          description: Business priority level
        - name: custom_labels
          in: query
          required: false
          schema:
            type: string
          description: "JSON-encoded custom labels (e.g., {\"constraint\":[\"cost-constrained\"]})"
        - name: detected_labels
          in: query
          required: false
          schema:
            type: string
          description: "JSON-encoded detected labels (e.g., {\"gitOpsManaged\":true})"
        - name: remediation_id
          in: query
          required: false
          schema:
            type: string
          description: Remediation request ID for audit correlation (BR-AUDIT-021)
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
          description: Pagination offset
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            maximum: 100
          description: Pagination limit (max 100)
      responses:
        '200':
          description: Action types with matching workflow counts
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActionTypeListResponse'
        '400':
          description: Validation error (missing required filters)
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '500':
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'

  /api/v1/workflows/actions/{action_type}:
    get:
      tags:
        - Workflow Discovery API
      summary: List workflows for action type
      description: |
        Step 2 of the three-step workflow discovery protocol.
        Returns all active workflows matching the specified action type and
        signal context filters.

        **Authority**: DD-WORKFLOW-016 (Action-Type Workflow Catalog Indexing)
        **Business Requirement**: BR-HAPI-017-001 (Three-Step Tool Implementation)

        **LLM Instruction**: The LLM MUST review ALL workflows (across all pages)
        before selecting one. Do not select from an incomplete list.

        **Behavior**:
        - Filters by action_type + signal context (severity, component, environment, priority)
        - Excludes disabled and deprecated workflows
        - Returns workflow metadata including effectiveness data
        - Paginated (default 10 per page)
        - Emits `workflow.catalog.workflows_listed` audit event (DD-WORKFLOW-014 v3.0)
      operationId: listWorkflowsByActionType
      parameters:
        - name: action_type
          in: path
          required: true
          schema:
            type: string
          description: "Action type from taxonomy (e.g., ScaleReplicas, RestartPod)"
        - name: severity
          in: query
          required: true
          schema:
            type: string
            enum: [critical, high, medium, low]
          description: Signal severity level
        - name: component
          in: query
          required: true
          schema:
            type: string
          description: Kubernetes resource type
        - name: environment
          in: query
          required: true
          schema:
            type: string
          description: Target environment
        - name: priority
          in: query
          required: true
          schema:
            type: string
            enum: [P0, P1, P2, P3]
          description: Business priority level
        - name: custom_labels
          in: query
          required: false
          schema:
            type: string
          description: "JSON-encoded custom labels"
        - name: detected_labels
          in: query
          required: false
          schema:
            type: string
          description: "JSON-encoded detected labels"
        - name: remediation_id
          in: query
          required: false
          schema:
            type: string
          description: Remediation request ID for audit correlation (BR-AUDIT-021)
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
          description: Pagination offset
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            maximum: 100
          description: Pagination limit (max 100)
      responses:
        '200':
          description: Workflows for the specified action type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowDiscoveryResponse'
        '400':
          description: Validation error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '500':
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'

  /api/v1/workflows:
    post:
      tags:
        - Workflow Catalog API
      summary: Register workflow from OCI image
      description: |
        Register a new workflow by providing an OCI image pullspec.
        Data Storage pulls the image, extracts /workflow-schema.yaml (ADR-043),
        validates the schema, and populates all catalog fields from it.

        **Business Requirement**: BR-WORKFLOW-017-001 (OCI-based workflow registration)
        **Design Decision**: DD-WORKFLOW-017 (Workflow Lifecycle Component Interactions)
      operationId: createWorkflow
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateWorkflowFromOCIRequest'
      responses:
        '201':
          description: Workflow created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RemediationWorkflow'
        '400':
          description: |
            Validation error - schema invalid, unknown action_type, missing mandatory labels,
            or missing required fields.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '401':
          description: |
            Authentication failed - Invalid or missing Bearer token.
            
            **Authority**: DD-AUTH-014 (Middleware-based authentication)
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '403':
          description: |
            Authorization failed - Kubernetes SubjectAccessReview (SAR) denied access.
            
            **Authority**: DD-AUTH-014 (Middleware-based authorization)
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '409':
          description: |
            Conflict - Duplicate workflow.
            Workflow with same workflow_name and version already exists.
            
            **Authority**: DS-BUG-001 fix (RFC 9110 Section 15.5.10)
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '422':
          description: |
            Unprocessable Entity - /workflow-schema.yaml not found in OCI image.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '500':
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '502':
          description: |
            Bad Gateway - OCI image could not be pulled from registry.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
    get:
      tags:
        - Workflow Catalog API
      summary: List workflows
      description: |
        List workflows with optional filters and pagination.

        **Business Requirement**: BR-STORAGE-014 (Workflow Catalog Management)
      operationId: listWorkflows
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [active, disabled, deprecated, archived]
        - name: environment
          in: query
          schema:
            type: string
        - name: priority
          in: query
          schema:
            type: string
        - name: component
          in: query
          schema:
            type: string
        - name: workflow_name
          in: query
          schema:
            type: string
          description: Filter by workflow name (exact match for test idempotency)
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
            maximum: 1000
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: Workflow list
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkflowListResponse'
        '500':
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'

  /api/v1/workflows/{workflow_id}:
    get:
      tags:
        - Workflow Catalog API
        - Workflow Discovery API
      summary: Get workflow by UUID (with optional security gate)
      description: |
        Retrieve a specific workflow by its UUID.
        Step 3 of the three-step workflow discovery protocol when context filters are provided.

        **Design Decision**: DD-WORKFLOW-002 v3.0 (UUID primary key)
        **Security Gate**: DD-WORKFLOW-016, DD-HAPI-017

        **Without context filters**: Returns workflow by ID (existing behavior).
        **With context filters**: Returns workflow only if it matches the signal context.
        Returns 404 if the workflow exists but does not match the context filters
        (security gate - prevents info leakage by not distinguishing "not found" from "filtered out").

        Emits `workflow.catalog.workflow_retrieved` audit event when context filters are present.
      operationId: getWorkflowByID
      parameters:
        - name: workflow_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
        - name: severity
          in: query
          required: false
          schema:
            type: string
            enum: [critical, high, medium, low]
          description: "Security gate: signal severity level"
        - name: component
          in: query
          required: false
          schema:
            type: string
          description: "Security gate: Kubernetes resource type"
        - name: environment
          in: query
          required: false
          schema:
            type: string
          description: "Security gate: target environment"
        - name: priority
          in: query
          required: false
          schema:
            type: string
            enum: [P0, P1, P2, P3]
          description: "Security gate: business priority level"
        - name: custom_labels
          in: query
          required: false
          schema:
            type: string
          description: "Security gate: JSON-encoded custom labels"
        - name: detected_labels
          in: query
          required: false
          schema:
            type: string
          description: "Security gate: JSON-encoded detected labels"
        - name: remediation_id
          in: query
          required: false
          schema:
            type: string
          description: Remediation request ID for audit correlation (BR-AUDIT-021)
      responses:
        '200':
          description: Workflow found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RemediationWorkflow'
        '404':
          description: Workflow not found
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '500':
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
    patch:
      tags:
        - Workflow Catalog API
      summary: Update workflow mutable fields
      description: |
        Update mutable workflow fields (status, metrics).
        Immutable fields (description, content, labels) require creating a new version.

        **Design Decision**: DD-WORKFLOW-012 (Mutable vs Immutable Fields)
      operationId: updateWorkflow
      parameters:
        - name: workflow_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkflowUpdateRequest'
      responses:
        '200':
          description: Workflow updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RemediationWorkflow'
        '400':
          description: Validation error (attempted to update immutable field)
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '404':
          description: Workflow not found
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'

  /api/v1/workflows/{workflow_id}/disable:
    patch:
      tags:
        - Workflow Catalog API
      summary: Disable workflow
      description: |
        Convenience endpoint to disable a workflow (soft delete).
        Sets status to 'disabled' with timestamp and reason.

        **Design Decision**: DD-WORKFLOW-012, DD-WORKFLOW-017 Phase 4.4
      operationId: disableWorkflow
      parameters:
        - name: workflow_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkflowLifecycleRequest'
      responses:
        '200':
          description: Workflow disabled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RemediationWorkflow'
        '400':
          description: Missing required field (reason)
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '404':
          description: Workflow not found
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'

  /api/v1/workflows/{workflow_id}/enable:
    patch:
      tags:
        - Workflow Catalog API
      summary: Enable workflow
      description: |
        Re-enable a previously disabled or deprecated workflow.
        Sets status to 'active' with timestamp and reason.

        **Design Decision**: DD-WORKFLOW-017 Phase 4.4 (Lifecycle PATCH endpoints)
      operationId: enableWorkflow
      parameters:
        - name: workflow_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkflowLifecycleRequest'
      responses:
        '200':
          description: Workflow enabled
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RemediationWorkflow'
        '400':
          description: Missing required field (reason)
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '404':
          description: Workflow not found
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'

  /api/v1/workflows/{workflow_id}/deprecate:
    patch:
      tags:
        - Workflow Catalog API
      summary: Deprecate workflow
      description: |
        Mark a workflow as deprecated. Deprecated workflows are excluded from
        discovery results but remain in the catalog for audit history.

        **Design Decision**: DD-WORKFLOW-017 Phase 4.4 (Lifecycle PATCH endpoints)
      operationId: deprecateWorkflow
      parameters:
        - name: workflow_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WorkflowLifecycleRequest'
      responses:
        '200':
          description: Workflow deprecated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RemediationWorkflow'
        '400':
          description: Missing required field (reason)
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '404':
          description: Workflow not found
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'

  /api/v1/audit/events:
    post:
      tags:
        - Audit Write API
      summary: Create unified audit event
      description: |
        Persists a unified audit event to the audit_events table (ADR-034).

        **Business Requirement**: BR-STORAGE-033 (Unified audit trail)

        **Behavior**:
        - Success: Returns 201 Created with event_id
        - Validation Error: Returns 400 Bad Request (RFC 7807)
        - Database Error: Returns 202 Accepted (DLQ fallback, DD-009)
      operationId: createAuditEvent
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuditEventRequest'
      responses:
        '201':
          description: Audit event created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditEventResponse'
        '202':
          description: Database write failed, queued to DLQ for async processing
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AsyncAcceptanceResponse'
        '400':
          description: Validation error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '401':
          description: |
            Authentication failed - Invalid or missing Bearer token.
            
            **Source**: DataStorage auth middleware (DD-AUTH-014)
            
            **Cause**: 
            - No Authorization header
            - Invalid Bearer token
            - Expired token
            - TokenReview API rejection
            
            **Resolution**: Provide valid Kubernetes ServiceAccount token via `Authorization: Bearer <token>` header.
            
            **Authority**: DD-AUTH-014 (Middleware-based authentication)
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '403':
          description: |
            Authorization failed - Kubernetes SubjectAccessReview (SAR) denied access.
            
            **Source**: DataStorage auth middleware (DD-AUTH-014)
            
            **Cause**: ServiceAccount lacks required RBAC permission on data-storage-service resource.
            
            **Resolution**: Grant ServiceAccount the `data-storage-client` ClusterRole via RoleBinding.
            
            **Authority**: DD-AUTH-014 (Middleware-based authorization)
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '500':
          description: Internal server error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
    get:
      tags:
        - Audit Write API
      summary: Query audit events
      description: Query audit events with filters and pagination
      operationId: queryAuditEvents
      parameters:
        - name: event_type
          in: query
          description: Filter by event type (ADR-034)
          schema:
            type: string
          example: "notification.message.sent"
        - name: event_category
          in: query
          description: Filter by event category (ADR-034)
          schema:
            type: string
          example: "notification"
        - name: event_outcome
          in: query
          description: Filter by event outcome (ADR-034)
          schema:
            type: string
            enum: [success, failure, pending]
          example: "success"
        - name: severity
          in: query
          description: Filter by severity level
          schema:
            type: string
          example: "critical"
        - name: correlation_id
          in: query
          description: Filter by correlation ID
          schema:
            type: string
          example: "rr-2025-001"
        - name: since
          in: query
          description: Start time (relative like "24h" or absolute RFC3339)
          schema:
            type: string
          example: "24h"
        - name: until
          in: query
          description: End time (absolute RFC3339)
          schema:
            type: string
          example: "2025-12-18T23:59:59Z"
        - name: limit
          in: query
          description: Page size (1-1000, default 50)
          schema:
            type: integer
            default: 50
            minimum: 1
            maximum: 1000
        - name: offset
          in: query
          description: Page offset (default 0)
          schema:
            type: integer
            default: 0
            minimum: 0
      responses:
        '200':
          description: Query results
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditEventsQueryResponse'

  /api/v1/audit/events/batch:
    post:
      tags:
        - Audit Write API
      summary: Create audit events batch
      description: Write multiple audit events in a single request
      operationId: createAuditEventsBatch
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/AuditEventRequest'
      responses:
        '201':
          description: Batch created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BatchAuditEventResponse'

  /api/v1/audit/notifications:
    post:
      tags:
        - Audit Write API
      summary: Create notification audit record
      description: |
        Persists a notification delivery attempt audit record.

        **Business Requirement**: BR-STORAGE-001 (Notification audit persistence)

        **Behavior**:
        - Success: Returns 201 Created with created record
        - Validation Error: Returns 400 Bad Request (RFC 7807)
        - Duplicate: Returns 409 Conflict (RFC 7807)
        - Database Error: Returns 202 Accepted (DLQ fallback, DD-009)

        **Metrics Emitted** (GAP-10):
        - `datastorage_audit_traces_total{service="notification", status="success|failure|dlq_fallback"}`
        - `datastorage_audit_lag_seconds{service="notification"}`
        - `datastorage_write_duration_seconds{table="notification_audit"}`
        - `datastorage_validation_failures_total{field="...", reason="..."}`
      operationId: createNotificationAudit
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NotificationAudit'
            examples:
              successful_delivery:
                summary: Successful notification delivery
                value:
                  remediation_id: "remediation-123"
                  notification_id: "notification-456"
                  recipient: "ops-team@example.com"
                  channel: "email"
                  message_summary: "Incident alert: High CPU usage on pod xyz"
                  status: "sent"
                  sent_at: "2025-11-03T12:00:00Z"
                  delivery_status: "200 OK"
                  escalation_level: 0
              failed_delivery:
                summary: Failed notification delivery
                value:
                  remediation_id: "remediation-789"
                  notification_id: "notification-abc"
                  recipient: "ops-team@example.com"
                  channel: "slack"
                  message_summary: "Incident alert: Database connection lost"
                  status: "failed"
                  sent_at: "2025-11-03T12:05:00Z"
                  delivery_status: "500 Internal Server Error"
                  error_message: "Slack API timeout after 30 seconds"
                  escalation_level: 1
      responses:
        '201':
          description: |
            Audit record created successfully in PostgreSQL.
            Record is immediately available for queries.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/NotificationAuditResponse'
              example:
                id: 1
                remediation_id: "remediation-123"
                notification_id: "notification-456"
                recipient: "ops-team@example.com"
                channel: "email"
                message_summary: "Incident alert: High CPU usage on pod xyz"
                status: "sent"
                sent_at: "2025-11-03T12:00:00Z"
                delivery_status: "200 OK"
                escalation_level: 0
                created_at: "2025-11-03T12:00:01Z"
                updated_at: "2025-11-03T12:00:01Z"
        '202':
          description: |
            Database write failed, audit record queued to Dead Letter Queue (DD-009).
            Record will be processed asynchronously.

            **Reason**: PostgreSQL temporarily unavailable or under load.
            **Recovery**: DLQ consumer will retry write every 30 seconds.
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [accepted]
                  message:
                    type: string
                required:
                  - status
                  - message
              example:
                status: "accepted"
                message: "audit record queued for processing"
        '400':
          description: |
            Validation error - request body failed validation.
            Returns RFC 7807 Problem Details format (BR-STORAGE-024).
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
              example:
                type: "https://kubernaut.io/problems/validation-error"
                title: "Validation Error"
                status: 400
                detail: "One or more required fields are missing or invalid"
                instance: "/api/v1/audit/notifications"
                field_errors:
                  remediation_id: "remediation_id is required"
                  notification_id: "notification_id is required"
        '409':
          description: |
            Conflict - duplicate notification_id.
            Notification audit records use notification_id as unique constraint.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
              example:
                type: "https://kubernaut.io/problems/conflict"
                title: "Resource Conflict"
                status: 409
                detail: "notification_audit already exists with notification_id 'notification-456'"
                instance: "/api/v1/audit/notifications"
        '500':
          description: |
            Internal server error - both database and DLQ unavailable.
            This indicates a critical system failure requiring immediate attention.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
              example:
                type: "https://kubernaut.io/problems/service-unavailable"
                title: "Service Unavailable"
                status: 500
                detail: "database and DLQ both unavailable - please retry"
                instance: "/api/v1/audit/notifications"

  /api/v1/audit/legal-hold:
    post:
      tags:
        - Audit Write API
      summary: Place legal hold on audit events
      description: |
        Places a legal hold on all audit events for a given correlation_id.
        Events with legal hold cannot be deleted (enforced by database trigger).

        **Business Requirement**: BR-AUDIT-006 (Legal Hold & Retention)
        **SOC2 Gap**: Gap #8 (Legal Hold enforcement for Sarbanes-Oxley, HIPAA)

        **Behavior**:
        - Success: Returns 200 OK with legal hold metadata
        - Validation Error: Returns 400 Bad Request (RFC 7807)
        - Not Found: Returns 404 Not Found if correlation_id doesn't exist
        - Unauthorized: Returns 401 if X-User-ID header missing

        **Authorization**: Requires X-User-ID header to track who placed the hold

        **Metrics Emitted**:
        - `datastorage_legal_hold_successes_total{operation="place"}`
        - `datastorage_legal_hold_failures_total{reason="missing_correlation_id|unauthorized|..."}`
      operationId: placeLegalHold
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - correlation_id
                - reason
              properties:
                correlation_id:
                  type: string
                  description: Correlation ID of events to place legal hold on
                  example: "remediation-123"
                reason:
                  type: string
                  description: Reason for legal hold (e.g., "litigation", "investigation")
                  example: "SEC investigation case #2025-001"
      responses:
        '200':
          description: Legal hold placed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  correlation_id:
                    type: string
                  events_affected:
                    type: integer
                  placed_by:
                    type: string
                  placed_at:
                    type: string
                    format: date-time
                  reason:
                    type: string
        '400':
          description: Validation error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '401':
          description: Unauthorized - X-User-ID header required
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '404':
          description: Not Found - correlation_id doesn't exist
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
    get:
      tags:
        - Audit Write API
      summary: List all active legal holds
      description: |
        Returns a list of all active legal holds across all audit events.

        **Business Requirement**: BR-AUDIT-006 (Legal Hold & Retention)
        **SOC2 Gap**: Gap #8 (Legal Hold enforcement)

        **Behavior**:
        - Success: Returns 200 OK with array of active legal holds
        - No holds: Returns empty array

        **Authorization**: No authentication required (read-only operation)

        **Metrics Emitted**:
        - `datastorage_legal_hold_successes_total{operation="list"}`
      operationId: listLegalHolds
      responses:
        '200':
          description: List of active legal holds
          content:
            application/json:
              schema:
                type: object
                properties:
                  holds:
                    type: array
                    items:
                      type: object
                      properties:
                        correlation_id:
                          type: string
                        events_affected:
                          type: integer
                        placed_by:
                          type: string
                        placed_at:
                          type: string
                          format: date-time
                        reason:
                          type: string
                  total:
                    type: integer

  /api/v1/audit/export:
    get:
      tags:
        - Audit Write API
      summary: Export audit events with digital signature
      description: |
        Exports audit events matching the specified filters with cryptographic signatures
        for tamper detection and compliance verification.

        **Business Requirement**: BR-AUDIT-007 (Audit Export)
        **SOC2 Requirements**: CC8.1 (Audit Export), AU-9 (Audit Protection)

        **Behavior**:
        - Success: Returns 200 OK with signed export (JSON or CSV)
        - Validation Error: Returns 400 Bad Request (invalid date range, etc.)
        - Unauthorized: Returns 401 if X-Auth-Request-User header missing
        - Too Many Records: Returns 413 Payload Too Large (>10,000 events, use pagination)

        **Authorization**: Requires X-Auth-Request-User header (oauth-proxy authenticated)

        **Export Formats**:
        - JSON: Complete event data with hash chain verification
        - CSV: Flattened tabular format for spreadsheet analysis

        **Hash Chain Verification**:
        - Each export includes hash chain integrity status
        - Tampered events flagged with `hash_chain_valid: false`
        - Chain verification performed at export time

        **Digital Signature**:
        - Export signed with service x509 certificate
        - Signature included in `export_metadata.signature` field
        - Detached signature available via `include_detached_signature=true`

        **Pagination**:
        - Use `offset` and `limit` for large result sets
        - Maximum limit: 10,000 events per export
        - Signature covers ALL pages (use same query for verification)

        **Metrics Emitted**:
        - `datastorage_export_successes_total{format="json|csv"}`
        - `datastorage_export_failures_total{reason="unauthorized|validation|..."}`
      operationId: exportAuditEvents
      parameters:
        - name: start_time
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: Start of time range (ISO 8601)
          example: "2026-01-01T00:00:00Z"
        - name: end_time
          in: query
          required: false
          schema:
            type: string
            format: date-time
          description: End of time range (ISO 8601)
          example: "2026-01-07T23:59:59Z"
        - name: correlation_id
          in: query
          required: false
          schema:
            type: string
          description: Filter by correlation ID
          example: "remediation-123"
        - name: event_category
          in: query
          required: false
          schema:
            type: string
          description: Filter by event category
          example: "remediation_approval"
        - name: format
          in: query
          required: false
          schema:
            type: string
            enum: [json, csv]
            default: json
          description: Export format (json or csv)
        - name: include_detached_signature
          in: query
          required: false
          schema:
            type: boolean
            default: false
          description: Include detached signature file in response
        - name: offset
          in: query
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Pagination offset
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 10000
            default: 1000
          description: Maximum records per export
        - name: redact_pii
          in: query
          required: false
          schema:
            type: boolean
            default: false
          description: |
            Enable PII (Personally Identifiable Information) redaction in audit export.

            **SOC2 Privacy Compliance**: Redacts sensitive data to comply with data minimization principles.

            **Redaction Rules**:
            - Emails: user@domain.com → u***@d***.com
            - IP Addresses: 192.168.1.1 → 192.***.*.***
            - Phone Numbers: +1-555-1234 → +1-***-****

            **Fields Redacted**:
            - event_data.user_email
            - event_data.source_ip
            - event_data.phone_number
            - exported_by (if email)

            **Use Cases**:
            - Sharing exports with external auditors
            - Compliance reports for legal teams
            - Anonymized analysis and research

            Note: Redaction occurs AFTER hash chain verification to maintain integrity.
      responses:
        '200':
          description: Export generated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditExportResponse'
        '400':
          description: Validation error (invalid date range, etc.)
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '401':
          description: Unauthorized - X-Auth-Request-User header required
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '413':
          description: Payload Too Large - result set exceeds maximum (use pagination)
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'

  /api/v1/audit/legal-hold/{correlation_id}:
    delete:
      tags:
        - Audit Write API
      summary: Release legal hold on audit events
      description: |
        Releases a legal hold on all audit events for a given correlation_id.
        Events can be deleted after legal hold is released.

        **Business Requirement**: BR-AUDIT-006 (Legal Hold & Retention)
        **SOC2 Gap**: Gap #8 (Legal Hold enforcement)

        **Behavior**:
        - Success: Returns 200 OK with release metadata
        - Validation Error: Returns 400 Bad Request (RFC 7807)
        - Not Found: Returns 404 Not Found if legal hold doesn't exist
        - Unauthorized: Returns 401 if X-User-ID header missing

        **Authorization**: Requires X-User-ID header to track who released the hold

        **Metrics Emitted**:
        - `datastorage_legal_hold_successes_total{operation="release"}`
        - `datastorage_legal_hold_failures_total{reason="unauthorized|not_found|..."}`
      operationId: releaseLegalHold
      parameters:
        - name: correlation_id
          in: path
          required: true
          schema:
            type: string
          description: Correlation ID of events to release legal hold from
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - release_reason
              properties:
                release_reason:
                  type: string
                  description: Reason for releasing legal hold
                  example: "Case closed"
      responses:
        '200':
          description: Legal hold released successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  correlation_id:
                    type: string
                  events_released:
                    type: integer
                  released_by:
                    type: string
                  released_at:
                    type: string
                    format: date-time
        '400':
          description: Validation error
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '401':
          description: Unauthorized - X-User-ID header required
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
        '404':
          description: Not Found - legal hold doesn't exist for correlation_id
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'

  /api/v1/audit/remediation-requests/{correlation_id}/reconstruct:
    post:
      tags:
        - Audit Reconstruction API
      summary: Reconstruct RemediationRequest from audit trail
      description: |
        Reconstructs a complete RemediationRequest CRD from audit trail events.

        **Business Requirement**: BR-AUDIT-006 (SOC2 compliance)

        **Workflow**:
        1. Query audit events for given correlation_id
        2. Parse gateway and orchestrator events
        3. Map audit data to RR Spec/Status fields
        4. Build complete Kubernetes-compliant CRD
        5. Validate completeness and quality

        **Use Cases**:
        - Disaster recovery (recreate lost RRs from audit trail)
        - Compliance audits (prove RR state at any point in time)
        - Debugging (understand RR evolution from audit events)

        **Returns**:
        - Reconstructed RR in YAML format
        - Validation result (completeness percentage, warnings, errors)

        **Authentication**: Protected by OAuth-proxy in production/E2E.
        Integration tests use mock X-Auth-Request-User header.
      operationId: reconstructRemediationRequest
      parameters:
        - name: correlation_id
          in: path
          required: true
          description: Unique correlation ID for the remediation lifecycle
          schema:
            type: string
            example: "rr-prometheus-alert-highcpu-abc123"
      responses:
        '200':
          description: |
            RemediationRequest successfully reconstructed.
            Returns RR YAML and validation results.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ReconstructionResponse'
        '400':
          description: |
            Bad Request - reconstruction failed validation.
            Missing required audit events or invalid data.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
              examples:
                missing_gateway_event:
                  summary: Missing gateway.signal.received event
                  value:
                    type: "https://kubernaut.ai/problems/reconstruction/missing-gateway-event"
                    title: "Reconstruction Failed"
                    status: 400
                    detail: "gateway.signal.received event is required for reconstruction"
                    instance: "/api/v1/audit/remediation-requests/invalid-correlation/reconstruct"
                incomplete_data:
                  summary: Incomplete reconstruction (< 50% complete)
                  value:
                    type: "https://kubernaut.ai/problems/reconstruction/incomplete-data"
                    title: "Incomplete Reconstruction"
                    status: 400
                    detail: "Reconstructed RR is only 33% complete (SignalName and SignalType only)"
                    instance: "/api/v1/audit/remediation-requests/partial-correlation/reconstruct"
        '404':
          description: |
            Not Found - no audit events found for correlation_id.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
              examples:
                no_events:
                  summary: No audit events for correlation ID
                  value:
                    type: "https://kubernaut.ai/problems/audit/correlation-not-found"
                    title: "Audit Events Not Found"
                    status: 404
                    detail: "No audit events found for correlation_id: nonexistent-correlation"
                    instance: "/api/v1/audit/remediation-requests/nonexistent-correlation/reconstruct"
        '500':
          description: |
            Internal Server Error - database or reconstruction logic failure.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'

  /api/v1/effectiveness/{correlation_id}:
    get:
      tags:
        - Effectiveness Assessment API
      summary: Compute weighted effectiveness score on demand
      description: |
        Computes the weighted effectiveness score for a given remediation lifecycle
        from component audit events in the audit trail.

        **Architecture**: Per ADR-EM-001 Principle 5, DataStorage computes the overall score.
        The Effectiveness Monitor emits raw component assessment events; this endpoint
        aggregates them and applies the DD-017 v2.1 scoring formula:

          score = (health_score * 0.40 + alert_score * 0.35 + metrics_score * 0.25) / total_weight

        **Business Requirements**: BR-EM-001 to BR-EM-004

        **Response includes**:
        - Weighted overall score (0.0 to 1.0)
        - Individual component scores (health, alert, metrics)
        - Hash comparison data (pre/post remediation spec hash per DD-EM-002)
        - Assessment status (no_data, in_progress, EffectivenessAssessed)

        **Authentication**: Protected by OAuth-proxy in production/E2E.
      operationId: getEffectivenessScore
      parameters:
        - name: correlation_id
          in: path
          required: true
          description: |
            The correlation ID (typically RemediationRequest name) that links all
            audit events in a remediation lifecycle.
          schema:
            type: string
            example: "rr-prometheus-alert-highcpu-abc123"
      responses:
        '200':
          description: Effectiveness score computed successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EffectivenessScoreResponse'
        '404':
          description: |
            Not Found - no effectiveness assessment events found for the given correlation_id.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
              examples:
                no_events:
                  summary: No effectiveness events for correlation ID
                  value:
                    type: "https://kubernaut.ai/problems/effectiveness/not-found"
                    title: "Effectiveness Assessment Not Found"
                    status: 404
                    detail: "No effectiveness assessment events found for correlation_id: unknown-rr"
                    instance: "/api/v1/effectiveness/unknown-rr"
        '500':
          description: |
            Internal Server Error - database query or score computation failure.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'

  /api/v1/remediation-history/context:
    get:
      tags:
        - Remediation History API
      summary: Get remediation history context for a target resource
      description: |
        Returns structured remediation history context for LLM prompt enrichment.

        **Business Requirements**: BR-HAPI-016 (Remediation history context)

        **Design Document**: DD-HAPI-016

        **Behavior**:
        Aggregates `remediation.workflow_created` (RO) and `effectiveness.assessment.completed` (EM)
        audit events into structured remediation chains for a target resource.

        **Two-Tier Query Design**:
        - **Tier 1** (default 24h): Detailed remediation chain with health checks, metric deltas,
          and full effectiveness data for the target resource.
        - **Tier 2** (default 90d): Summary chain activated when `currentSpecHash` matches a
          historical `preRemediationSpecHash` beyond the Tier 1 window, indicating configuration
          regression.

        **Hash Comparison**: For each entry, performs three-way comparison of `currentSpecHash`
        against `preRemediationSpecHash` and `postRemediationSpecHash`.

        **Regression Detection**: Sets `regressionDetected: true` if any entry's
        `preRemediationSpecHash` matches `currentSpecHash`.

        **Authentication**: Protected by OAuth-proxy in production/E2E.
        Integration tests use mock X-Auth-Request-User header.
      operationId: getRemediationHistoryContext
      parameters:
        - name: targetKind
          in: query
          required: true
          description: Kubernetes resource kind (e.g. Deployment, StatefulSet)
          schema:
            type: string
          example: "Deployment"
        - name: targetName
          in: query
          required: true
          description: Kubernetes resource name
          schema:
            type: string
          example: "my-app"
        - name: targetNamespace
          in: query
          required: true
          description: Kubernetes resource namespace
          schema:
            type: string
          example: "prod"
        - name: currentSpecHash
          in: query
          required: true
          description: SHA-256 hash of the current target resource spec (canonical JSON)
          schema:
            type: string
          example: "sha256:aabb112233dd"
        - name: tier1Window
          in: query
          required: false
          description: Tier 1 lookback window (default 24h). Accepts Go duration strings.
          schema:
            type: string
            default: "24h"
          example: "24h"
        - name: tier2Window
          in: query
          required: false
          description: Tier 2 lookback window (default 2160h / 90d). Accepts Go duration strings.
          schema:
            type: string
            default: "2160h"
          example: "2160h"
      responses:
        '200':
          description: |
            Remediation history context retrieved successfully.
            May contain Tier 1 (recent detailed), Tier 2 (historical summary), or both.
            Empty chains indicate no remediation history for the target.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RemediationHistoryContext'
        '400':
          description: |
            Bad Request - missing required query parameters.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'
              examples:
                missing_target_kind:
                  summary: Missing targetKind parameter
                  value:
                    type: "https://kubernaut.ai/problems/remediation-history/missing-parameter"
                    title: "Missing Required Parameter"
                    status: 400
                    detail: "Query parameter 'targetKind' is required"
                    instance: "/api/v1/remediation-history/context"
        '500':
          description: |
            Internal Server Error - database query failure.
          content:
            application/problem+json:
              schema:
                $ref: '#/components/schemas/RFC7807Problem'

  /health:
    get:
      tags:
        - Health
      summary: Overall health check
      description: |
        Returns 200 if service is healthy (database and Redis reachable).
        Used by Kubernetes liveness probe (DD-007).
      operationId: healthCheck
      responses:
        '200':
          description: Service is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [healthy]
                example:
                  status: "healthy"
        '503':
          description: Service is unhealthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum: [unhealthy]
                  error:
                    type: string
                example:
                  status: "unhealthy"
                  error: "database connection failed"

  /health/ready:
    get:
      tags:
        - Health
      summary: Readiness check
      description: |
        Returns 200 if service is ready to accept traffic.
        Returns 503 during graceful shutdown (DD-007 4-step pattern).
        Used by Kubernetes readiness probe.
      operationId: readinessCheck
      responses:
        '200':
          description: Service is ready
        '503':
          description: Service is shutting down (not ready for new requests)

  /health/live:
    get:
      tags:
        - Health
      summary: Liveness check
      description: |
        Returns 200 if service process is alive.
        Does not check dependencies.
        Used by Kubernetes liveness probe.
      operationId: livenessCheck
      responses:
        '200':
          description: Service is alive

  /metrics:
    get:
      tags:
        - Metrics
      summary: Prometheus metrics
      description: |
        Exposes Prometheus metrics in text format.

        **Metrics Exposed** (BR-STORAGE-019, GAP-10):
        - `datastorage_audit_traces_total{service,status}` - Audit write operations
        - `datastorage_audit_lag_seconds{service}` - Time between event and audit write
        - `datastorage_write_duration_seconds{table}` - Database write latency
        - `datastorage_validation_failures_total{field,reason}` - Validation errors
      operationId: getMetrics
      responses:
        '200':
          description: Prometheus metrics
          content:
            text/plain:
              schema:
                type: string
              example: |
                # HELP datastorage_audit_traces_total Total number of audit traces written by service and status
                # TYPE datastorage_audit_traces_total counter
                datastorage_audit_traces_total{service="notification",status="success"} 42
                datastorage_audit_traces_total{service="notification",status="dlq_fallback"} 3

                # HELP datastorage_audit_lag_seconds Time lag between event occurrence and audit write in seconds
                # TYPE datastorage_audit_lag_seconds histogram
                datastorage_audit_lag_seconds_bucket{service="notification",le="0.1"} 10
                datastorage_audit_lag_seconds_bucket{service="notification",le="0.5"} 35
                datastorage_audit_lag_seconds_bucket{service="notification",le="1"} 42

components:
  schemas:
    # ========================================
    # Effectiveness Assessment Response
    # ========================================
    EffectivenessScoreResponse:
      type: object
      description: |
        On-demand effectiveness score response. DS computes the weighted score
        from component audit events emitted by the Effectiveness Monitor.
        Per ADR-EM-001 Principle 5 and DD-017 v2.1 scoring formula.
      required:
        - correlation_id
        - components
        - assessment_status
        - computed_at
      properties:
        correlation_id:
          type: string
          description: The correlation ID linking all audit events in the remediation lifecycle.
          example: "rr-prometheus-alert-highcpu-abc123"
        score:
          type: number
          format: double
          nullable: true
          description: |
            Weighted effectiveness score (0.0 to 1.0). Null if no component scores available.
            Formula: (health * 0.40 + alert * 0.35 + metrics * 0.25) / total_assessed_weight
          example: 0.91
        components:
          $ref: '#/components/schemas/EffectivenessComponents'
        hash_comparison:
          $ref: '#/components/schemas/HashComparisonData'
        assessment_status:
          type: string
          enum:
            - no_data
            - in_progress
            - full
            - partial
            - spec_drift
            - expired
            - no_execution
            - metrics_timed_out
            - EffectivenessAssessed
          description: |
            Current assessment status:
            - no_data: No component events found
            - in_progress: Some component events present but assessment not completed
            - full: All components assessed successfully
            - partial: Some components assessed, others unavailable
            - spec_drift: Target resource spec changed during assessment (score unreliable, forced to 0.0)
            - expired: Assessment timed out before completing
            - no_execution: No workflow execution found for this correlation ID
            - metrics_timed_out: Prometheus metrics collection timed out
            - EffectivenessAssessed: Legacy value (equivalent to "full")
          example: "full"
        computed_at:
          type: string
          format: date-time
          description: Timestamp when this score was computed.

    EffectivenessComponents:
      type: object
      description: Individual component assessment scores.
      properties:
        health_assessed:
          type: boolean
          description: Whether health component has been assessed.
        health_score:
          type: number
          format: double
          nullable: true
          description: Health pass rate score (0.0 to 1.0).
        health_details:
          type: string
          description: Human-readable health assessment details.
        alert_assessed:
          type: boolean
          description: Whether alert component has been assessed.
        alert_score:
          type: number
          format: double
          nullable: true
          description: Alert resolution score (0.0 to 1.0).
        alert_details:
          type: string
          description: Human-readable alert assessment details.
        metrics_assessed:
          type: boolean
          description: Whether metrics component has been assessed.
        metrics_score:
          type: number
          format: double
          nullable: true
          description: Metric improvement ratio score (0.0 to 1.0).
        metrics_details:
          type: string
          description: Human-readable metrics assessment details.

    HashComparisonData:
      type: object
      description: |
        Pre/post remediation spec hash comparison data per DD-EM-002.
        Supplementary signal (not part of scoring formula).
      properties:
        pre_remediation_spec_hash:
          type: string
          description: Canonical SHA-256 hash of target resource spec before remediation.
          example: "sha256:abc123..."
        post_remediation_spec_hash:
          type: string
          description: Canonical SHA-256 hash of target resource spec after remediation.
          example: "sha256:def456..."
        hash_match:
          type: boolean
          nullable: true
          description: Whether pre and post hashes match (true = no spec change detected).

    NotificationAudit:
      type: object
      description: |
        Notification audit record for tracking delivery attempts.
        Maps to `notification_audit` PostgreSQL table.
      required:
        - remediation_id
        - notification_id
        - recipient
        - channel
        - message_summary
        - status
        - sent_at
      properties:
        remediation_id:
          type: string
          maxLength: 255
          description: |
            Kubernetes RemediationRequest CRD name.
            Links notification to originating remediation workflow.
          example: "remediation-123"
        notification_id:
          type: string
          maxLength: 255
          description: |
            Unique notification identifier from Notification Controller.
            Used as unique constraint to prevent duplicate audit records.
          example: "notification-456"
        recipient:
          type: string
          maxLength: 500
          description: |
            Notification recipient (email address, Slack channel, PagerDuty key, etc.).
            Format depends on channel type.
          example: "ops-team@example.com"
        channel:
          type: string
          maxLength: 50
          enum:
            - email
            - slack
            - pagerduty
            - webhook
          description: |
            Notification delivery channel.
            Determines recipient format and delivery mechanism.
          example: "email"
        message_summary:
          type: string
          maxLength: 1000
          description: |
            Human-readable summary of notification content.
            Truncated to 1000 characters for audit purposes.
          example: "Incident alert: High CPU usage on pod xyz"
        status:
          type: string
          maxLength: 50
          enum:
            - sent
            - failed
            - pending
          description: |
            Notification delivery status from Notification Controller.
          example: "sent"
        sent_at:
          type: string
          format: date-time
          description: |
            Timestamp when notification was sent (RFC 3339 format).
            Used to calculate audit lag (time between event and audit write).
          example: "2025-11-03T12:00:00Z"
        delivery_status:
          type: string
          maxLength: 255
          nullable: true
          description: |
            HTTP status code or delivery confirmation from notification channel.
            Optional - only present for sent notifications.
          example: "200 OK"
        error_message:
          type: string
          maxLength: 1000
          nullable: true
          description: |
            Error message from notification channel if delivery failed.
            Optional - only present for failed notifications.
          example: "Slack API timeout after 30 seconds"
        escalation_level:
          type: integer
          minimum: 0
          maximum: 5
          description: |
            Escalation level for notification (0 = first attempt, 1+ = escalated).
            Tracks how many times this incident has been escalated.
          example: 0

    NotificationAuditResponse:
      allOf:
        - $ref: '#/components/schemas/NotificationAudit'
        - type: object
          required:
            - id
            - created_at
            - updated_at
          properties:
            id:
              type: integer
              format: int64
              description: |
                Auto-generated primary key from PostgreSQL.
              example: 1
            created_at:
              type: string
              format: date-time
              description: |
                Timestamp when record was created in PostgreSQL.
              example: "2025-11-03T12:00:01Z"
            updated_at:
              type: string
              format: date-time
              description: |
                Timestamp when record was last updated in PostgreSQL.
              example: "2025-11-03T12:00:01Z"

    ReconstructionResponse:
      type: object
      description: |
        Response for RemediationRequest reconstruction from audit trail.
        Contains the reconstructed RR in YAML format and validation results.
        Implements BR-AUDIT-006 (SOC2 compliance).
      required:
        - remediation_request_yaml
        - validation
      properties:
        remediation_request_yaml:
          type: string
          description: |
            Complete RemediationRequest CRD in YAML format.
            Can be applied directly to Kubernetes cluster with kubectl.
            Includes TypeMeta, ObjectMeta, Spec, and Status.
          example: |
            apiVersion: remediation.kubernaut.ai/v1alpha1
            kind: RemediationRequest
            metadata:
              name: rr-reconstructed-rr-prometheus-alert-highcpu-abc123-1768265580
              namespace: kubernaut-system
              labels:
                app.kubernetes.io/managed-by: kubernaut-datastorage
                kubernaut.ai/reconstructed: "true"
                kubernaut.ai/correlation-id: rr-prometheus-alert-highcpu-abc123
              annotations:
                kubernaut.ai/reconstructed-at: "2026-01-12T19:53:00Z"
                kubernaut.ai/reconstruction-source: audit-trail
                kubernaut.ai/correlation-id: rr-prometheus-alert-highcpu-abc123
              finalizers:
                - kubernaut.ai/audit-retention
            spec:
              signalName: HighCPU
              signalType: prometheus-alert
              signalLabels:
                alertname: HighCPU
                severity: critical
              signalAnnotations:
                summary: CPU usage is high
              originalPayload: '{"alert":"data"}'
            status:
              timeoutConfig:
                global: 1h0m0s
                processing: 10m0s
                analyzing: 15m0s
        validation:
          $ref: '#/components/schemas/ValidationResult'
        reconstructed_at:
          type: string
          format: date-time
          description: |
            Timestamp when reconstruction was performed.
          example: "2026-01-12T19:53:00Z"
        correlation_id:
          type: string
          description: |
            Correlation ID used for reconstruction.
          example: "rr-prometheus-alert-highcpu-abc123"

    ValidationResult:
      type: object
      description: |
        Validation result for reconstructed RemediationRequest.
        Indicates completeness, errors, and warnings.
      required:
        - is_valid
        - completeness
        - errors
        - warnings
      properties:
        is_valid:
          type: boolean
          description: |
            Whether the RR passes validation (no blocking errors).
            true = ready to apply, false = missing required fields.
          example: true
        completeness:
          type: integer
          minimum: 0
          maximum: 100
          description: |
            Completeness percentage (0-100%) based on field presence.
            100% = all fields present (Gaps #1-8 complete).
            50-99% = required fields + some optional fields.
            0-49% = only required fields or incomplete.
          example: 83
        errors:
          type: array
          items:
            type: string
          description: |
            Blocking validation errors (missing required fields).
            Empty array if is_valid = true.
          example: []
        warnings:
          type: array
          items:
            type: string
          description: |
            Non-blocking warnings for missing optional fields.
            Helps identify gaps in reconstruction.
          example:
            - "SignalAnnotations are missing (Gap #3) - annotations provide additional metadata"

    RFC7807Problem:
      type: object
      description: |
        RFC 7807 Problem Details for HTTP APIs.
        Standard error response format (BR-STORAGE-024).
        See: https://www.rfc-editor.org/rfc/rfc7807.html
      required:
        - type
        - title
        - status
      properties:
        type:
          type: string
          format: uri
          description: |
            URI reference identifying the problem type.
            Dereferenceable URI when possible.
          example: "https://kubernaut.io/problems/validation-error"
        title:
          type: string
          description: |
            Short, human-readable summary of the problem type.
            Should not change from occurrence to occurrence.
          example: "Validation Error"
        status:
          type: integer
          format: int32
          description: |
            HTTP status code for this occurrence.
          example: 400
        detail:
          type: string
          description: |
            Human-readable explanation specific to this occurrence.
          example: "One or more required fields are missing or invalid"
        instance:
          type: string
          format: uri
          description: |
            URI reference identifying the specific occurrence.
          example: "/api/v1/audit/notifications"
        field_errors:
          type: object
          additionalProperties:
            type: string
          description: |
            Map of field names to error messages for validation errors.
            Only present for 400 Bad Request responses.
          example:
            remediation_id: "remediation_id is required"
            notification_id: "notification_id is required"

    AuditEventRequest:
      type: object
      required:
        - version
        - event_type
        - event_timestamp
        - event_category
        - event_action
        - event_outcome
        - correlation_id
        - event_data
      properties:
        version:
          type: string
          minLength: 1
          maxLength: 20
          description: Schema version (e.g., "1.0")
          example: "1.0"
        event_type:
          type: string
          minLength: 1
          maxLength: 100
          description: Event type identifier (e.g., gateway.signal.received)
          example: gateway.signal.received
        event_timestamp:
          type: string
          format: date-time
          description: ISO 8601 timestamp when the event occurred
          example: "2025-12-13T02:00:00Z"
        event_category:
          type: string
          minLength: 1
          maxLength: 50
          enum: [gateway, notification, analysis, aiagent, signalprocessing, workflow, workflowexecution, orchestration, webhook, effectiveness]
          description: |
            Service-level event category (ADR-034 v1.7).
            Per ADR-034 v1.2: event_category MUST match the service name that emits the event.
            Values:
            - gateway: Gateway Service
            - notification: Notification Service
            - analysis: AI Analysis Controller (NOT HolmesGPT API)
            - aiagent: AI Agent Provider (HolmesGPT API) - autonomous tool-calling agent
            - signalprocessing: Signal Processing Service
            - workflow: Workflow Catalog Service
            - workflowexecution: WorkflowExecution Controller (ADR-034 v1.5)
            - approval: RemediationApprovalRequest Controller (BR-AUDIT-006)
            - orchestration: Remediation Orchestrator Service
            - webhook: Authentication Webhook Service (SOC2 CC8.1 operator attribution)
            - effectiveness: Effectiveness Monitor Controller (ADR-EM-001)
          example: gateway
        event_action:
          type: string
          minLength: 1
          maxLength: 50
          description: Action performed (ADR-034)
          example: received
        event_outcome:
          type: string
          enum: [success, failure, pending]
          description: Result of the event
          example: success
        actor_type:
          type: string
          example: service
        actor_id:
          type: string
          example: gateway-service
        resource_type:
          type: string
          example: Signal
        resource_id:
          type: string
          example: fp-abc123
        correlation_id:
          type: string
          minLength: 1
          maxLength: 255
          description: Unique identifier for request correlation
          example: rr-2025-001
        parent_event_id:
          type: string
          format: uuid
          nullable: true
        namespace:
          type: string
          nullable: true
        cluster_name:
          type: string
          nullable: true
        severity:
          type: string
          nullable: true
        duration_ms:
          type: integer
          nullable: true
        event_data:
          description: |
            Service-specific event data as structured type.
            V2.0: Typed schemas documented below for API validation.
            Go client uses interface{} for clean code ergonomics.
            See DD-AUDIT-004 for structured type requirements.
          oneOf:
            - $ref: '#/components/schemas/GatewayAuditPayload'
            - $ref: '#/components/schemas/RemediationOrchestratorAuditPayload'
            - $ref: '#/components/schemas/SignalProcessingAuditPayload'
            - $ref: '#/components/schemas/AIAnalysisAuditPayload'
            - $ref: '#/components/schemas/WorkflowExecutionAuditPayload'
            - $ref: '#/components/schemas/NotificationAuditPayload'
            - $ref: '#/components/schemas/WorkflowExecutionWebhookAuditPayload'
            - $ref: '#/components/schemas/RemediationApprovalAuditPayload'
            - $ref: '#/components/schemas/RemediationApprovalDecisionPayload'
            - $ref: '#/components/schemas/WorkflowDiscoveryAuditPayload'
            - $ref: '#/components/schemas/WorkflowCatalogCreatedPayload'
            - $ref: '#/components/schemas/WorkflowCatalogUpdatedPayload'
            - $ref: '#/components/schemas/AIAnalysisPhaseTransitionPayload'
            - $ref: '#/components/schemas/AIAnalysisAIAgentCallPayload'
            - $ref: '#/components/schemas/AIAnalysisApprovalDecisionPayload'
            - $ref: '#/components/schemas/AIAnalysisRegoEvaluationPayload'
            - $ref: '#/components/schemas/AIAnalysisErrorPayload'
            - $ref: '#/components/schemas/NotificationMessageSentPayload'
            - $ref: '#/components/schemas/NotificationMessageFailedPayload'
            - $ref: '#/components/schemas/NotificationMessageAcknowledgedPayload'
            - $ref: '#/components/schemas/NotificationMessageEscalatedPayload'
            - $ref: '#/components/schemas/AIAgentResponsePayload'
            - $ref: '#/components/schemas/LLMRequestPayload'
            - $ref: '#/components/schemas/LLMResponsePayload'
            - $ref: '#/components/schemas/LLMToolCallPayload'
            - $ref: '#/components/schemas/WorkflowValidationPayload'
            - $ref: '#/components/schemas/RemediationRequestWebhookAuditPayload'
            - $ref: '#/components/schemas/EffectivenessAssessmentAuditPayload'
          discriminator:
            propertyName: event_type
            mapping:
              'gateway.signal.received': '#/components/schemas/GatewayAuditPayload'
              'gateway.signal.deduplicated': '#/components/schemas/GatewayAuditPayload'
              'gateway.crd.created': '#/components/schemas/GatewayAuditPayload'
              'gateway.crd.failed': '#/components/schemas/GatewayAuditPayload'
              'orchestrator.lifecycle.started': '#/components/schemas/RemediationOrchestratorAuditPayload'
              'orchestrator.lifecycle.created': '#/components/schemas/RemediationOrchestratorAuditPayload'
              'orchestrator.lifecycle.completed': '#/components/schemas/RemediationOrchestratorAuditPayload'
              'orchestrator.lifecycle.failed': '#/components/schemas/RemediationOrchestratorAuditPayload'
              'orchestrator.lifecycle.transitioned': '#/components/schemas/RemediationOrchestratorAuditPayload'
              'orchestrator.approval.requested': '#/components/schemas/RemediationOrchestratorAuditPayload'
              'orchestrator.approval.approved': '#/components/schemas/RemediationOrchestratorAuditPayload'
              'orchestrator.approval.rejected': '#/components/schemas/RemediationOrchestratorAuditPayload'
              'signalprocessing.signal.processed': '#/components/schemas/SignalProcessingAuditPayload'
              'signalprocessing.phase.transition': '#/components/schemas/SignalProcessingAuditPayload'
              'signalprocessing.classification.decision': '#/components/schemas/SignalProcessingAuditPayload'
              'signalprocessing.business.classified': '#/components/schemas/SignalProcessingAuditPayload'
              'signalprocessing.enrichment.completed': '#/components/schemas/SignalProcessingAuditPayload'
              'signalprocessing.error.occurred': '#/components/schemas/SignalProcessingAuditPayload'
              'aianalysis.analysis.completed': '#/components/schemas/AIAnalysisAuditPayload'
              'aianalysis.analysis.failed': '#/components/schemas/AIAnalysisAuditPayload'
              'workflowexecution.workflow.started': '#/components/schemas/WorkflowExecutionAuditPayload'
              'workflowexecution.workflow.completed': '#/components/schemas/WorkflowExecutionAuditPayload'
              'workflowexecution.workflow.failed': '#/components/schemas/WorkflowExecutionAuditPayload'
              'workflowexecution.selection.completed': '#/components/schemas/WorkflowExecutionAuditPayload'  # Gap #5 (BR-AUDIT-005) - ADR-034 v1.5
              'workflowexecution.execution.started': '#/components/schemas/WorkflowExecutionAuditPayload'    # Gap #6 (BR-AUDIT-005) - ADR-034 v1.5
              'orchestrator.remediation.manual_review': '#/components/schemas/RemediationOrchestratorAuditPayload'
              'orchestrator.routing.blocked': '#/components/schemas/RemediationOrchestratorAuditPayload'
              'remediation.workflow_created': '#/components/schemas/RemediationOrchestratorAuditPayload'
              'webhook.notification.cancelled': '#/components/schemas/NotificationAuditPayload'
              'webhook.notification.acknowledged': '#/components/schemas/NotificationAuditPayload'
              'workflowexecution.block.cleared': '#/components/schemas/WorkflowExecutionWebhookAuditPayload'
              'webhook.remediationapprovalrequest.decided': '#/components/schemas/RemediationApprovalAuditPayload'
              'webhook.remediationrequest.timeout_modified': '#/components/schemas/RemediationRequestWebhookAuditPayload'
              'workflow.catalog.actions_listed': '#/components/schemas/WorkflowDiscoveryAuditPayload'
              'workflow.catalog.workflows_listed': '#/components/schemas/WorkflowDiscoveryAuditPayload'
              'workflow.catalog.workflow_retrieved': '#/components/schemas/WorkflowDiscoveryAuditPayload'
              'workflow.catalog.selection_validated': '#/components/schemas/WorkflowDiscoveryAuditPayload'
              'datastorage.workflow.created': '#/components/schemas/WorkflowCatalogCreatedPayload'
              'datastorage.workflow.updated': '#/components/schemas/WorkflowCatalogUpdatedPayload'
              'aianalysis.phase.transition': '#/components/schemas/AIAnalysisPhaseTransitionPayload'
              'aianalysis.aiagent.call': '#/components/schemas/AIAnalysisAIAgentCallPayload'
              'aianalysis.aiagent.submit': '#/components/schemas/AIAnalysisAIAgentCallPayload'
              'aianalysis.aiagent.result': '#/components/schemas/AIAnalysisAIAgentCallPayload'
              'aianalysis.aiagent.session_lost': '#/components/schemas/AIAnalysisAIAgentCallPayload'
              'aianalysis.approval.decision': '#/components/schemas/AIAnalysisApprovalDecisionPayload'
              'aianalysis.rego.evaluation': '#/components/schemas/AIAnalysisRegoEvaluationPayload'
              'aianalysis.error.occurred': '#/components/schemas/AIAnalysisErrorPayload'
              'notification.message.sent': '#/components/schemas/NotificationMessageSentPayload'
              'notification.message.failed': '#/components/schemas/NotificationMessageFailedPayload'
              'notification.message.acknowledged': '#/components/schemas/NotificationMessageAcknowledgedPayload'
              'notification.message.escalated': '#/components/schemas/NotificationMessageEscalatedPayload'
              'aiagent.response.complete': '#/components/schemas/AIAgentResponsePayload'
              'aiagent.llm.request': '#/components/schemas/LLMRequestPayload'
              'aiagent.llm.response': '#/components/schemas/LLMResponsePayload'
              'aiagent.llm.tool_call': '#/components/schemas/LLMToolCallPayload'
              'aiagent.workflow.validation_attempt': '#/components/schemas/WorkflowValidationPayload'
              'effectiveness.health.assessed': '#/components/schemas/EffectivenessAssessmentAuditPayload'
              'effectiveness.hash.computed': '#/components/schemas/EffectivenessAssessmentAuditPayload'
              'effectiveness.alert.assessed': '#/components/schemas/EffectivenessAssessmentAuditPayload'
              'effectiveness.metrics.assessed': '#/components/schemas/EffectivenessAssessmentAuditPayload'
              'effectiveness.assessment.scheduled': '#/components/schemas/EffectivenessAssessmentAuditPayload'
              'effectiveness.assessment.completed': '#/components/schemas/EffectivenessAssessmentAuditPayload'
          # Removed x-go-type override to use proper oneOf discriminator
          # Let oapi-codegen generate appropriate union type from oneOf schemas

    AuditEventResponse:
      type: object
      required:
        - event_id
        - event_timestamp
        - message
      properties:
        event_id:
          type: string
          format: uuid
        event_timestamp:
          type: string
          format: date-time
        message:
          type: string

    BatchAuditEventResponse:
      type: object
      properties:
        event_ids:
          type: array
          items:
            type: string
            format: uuid
        message:
          type: string

    AsyncAcceptanceResponse:
      type: object
      description: Response when audit event is queued for async processing (202 Accepted)
      required:
        - status
        - message
      properties:
        status:
          type: string
          description: Status of the async operation
          example: "accepted"
        message:
          type: string
          description: Explanation of the async processing
          example: "audit event queued for async processing"

    AuditEventsQueryResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/AuditEvent'
        pagination:
          type: object
          properties:
            limit:
              type: integer
              description: Maximum number of events per page
            offset:
              type: integer
              description: Number of events to skip
            total:
              type: integer
              description: Total number of events matching the query
            has_more:
              type: boolean
              description: Whether more results are available beyond current page

    AuditEvent:
      allOf:
        - $ref: '#/components/schemas/AuditEventRequest'
        - type: object
          properties:
            event_id:
              type: string
              format: uuid
            event_date:
              type: string
              format: date
              nullable: true
              description: "Date of the event (YYYY-MM-DD). Nullable to handle format mismatches from DataStorage."

    # ========================================
    # WORKFLOW DISCOVERY SCHEMAS (DD-WORKFLOW-016, DD-HAPI-017)
    # ========================================
    # Three-step discovery protocol response types
    # Step 1: ActionTypeListResponse (list available actions)
    # Step 2: WorkflowDiscoveryResponse (list workflows for action type)
    # Step 3: RemediationWorkflow (get workflow - uses existing schema with security gate)

    ActionTypeListResponse:
      type: object
      description: "Response for Step 1: list available action types (DD-WORKFLOW-016)"
      required:
        - actionTypes
        - pagination
      properties:
        actionTypes:
          type: array
          items:
            $ref: '#/components/schemas/ActionTypeEntry'
        pagination:
          $ref: '#/components/schemas/PaginationMetadata'

    ActionTypeEntry:
      type: object
      description: "Single action type with description and workflow count"
      required:
        - actionType
        - description
        - workflowCount
      properties:
        actionType:
          type: string
          description: "Action type identifier (e.g., ScaleReplicas, RestartPod)"
          example: "ScaleReplicas"
        description:
          $ref: '#/components/schemas/StructuredDescription'
        workflowCount:
          type: integer
          description: "Number of active workflows matching this action type and context filters"
          minimum: 0

    WorkflowDiscoveryResponse:
      type: object
      description: "Response for Step 2: list workflows for an action type (DD-WORKFLOW-016)"
      required:
        - actionType
        - workflows
        - pagination
      properties:
        actionType:
          type: string
          description: "The action type these workflows belong to"
        workflows:
          type: array
          items:
            $ref: '#/components/schemas/WorkflowDiscoveryEntry'
        pagination:
          $ref: '#/components/schemas/PaginationMetadata'

    WorkflowDiscoveryEntry:
      type: object
      description: "Workflow summary for discovery (Step 2) - no parameter schema, no scores"
      required:
        - workflowId
        - workflowName
        - name
        - description
        - version
        - schemaImage
      properties:
        workflowId:
          type: string
          format: uuid
          description: "UUID primary key"
        workflowName:
          type: string
          description: "Human-readable workflow identifier (e.g., scale-conservative-v1)"
        name:
          type: string
          description: "Display name"
        description:
          $ref: '#/components/schemas/StructuredDescription'
        version:
          type: string
          description: "Semantic version"
        schemaImage:
          type: string
          description: "OCI image used to extract the workflow schema"
        executionBundle:
          type: string
          description: "OCI execution bundle reference (digest-pinned)"
        executionEngine:
          type: string
          description: "Execution engine (tekton, job)"
          enum: [tekton, job]
        # DD-HAPI-017 v1.1: actualSuccessRate and totalExecutions REMOVED from
        # LLM-facing discovery response. These global aggregate metrics are
        # misleading for per-incident workflow selection — the conditions under
        # which they were collected (different signals, targets, environments)
        # are not applicable to the current case. Contextual remediation history
        # via spec-hash matching (DD-HAPI-016) is the correct mechanism.
        # These fields remain on the full RemediationWorkflow schema for operators.

    StructuredDescription:
      type: object
      description: "Structured workflow description for LLM comparison and operator guidance (BR-WORKFLOW-004)"
      required:
        - what
        - whenToUse
      properties:
        what:
          type: string
          description: "What this workflow concretely does. One sentence."
        whenToUse:
          type: string
          description: "Root cause conditions under which this workflow is appropriate."
        whenNotToUse:
          type: string
          description: "Specific exclusion conditions."
        preconditions:
          type: string
          description: "Conditions that must be verified through investigation."

    PaginationMetadata:
      type: object
      description: "Pagination metadata for discovery endpoints (DD-WORKFLOW-016)"
      required:
        - totalCount
        - offset
        - limit
        - hasMore
      properties:
        totalCount:
          type: integer
          description: "Total number of results across all pages"
          minimum: 0
        offset:
          type: integer
          description: "Current offset (0-based)"
          minimum: 0
        limit:
          type: integer
          description: "Page size"
          minimum: 1
        hasMore:
          type: boolean
          description: "True if more pages exist beyond current offset+limit"

    # ========================================
    # WORKFLOW SEARCH SCHEMAS (DEPRECATED - superseded by DD-WORKFLOW-016)
    # ========================================
    # These schemas supported the old POST /api/v1/workflows/search endpoint.
    # Retained temporarily for reference. Will be removed after all consumers migrate.
    # Superseded by: ActionTypeListResponse, WorkflowDiscoveryResponse, PaginationMetadata

    WorkflowSearchRequest:
      type: object
      required:
        - filters
      properties:
        remediation_id:
          type: string
          description: Optional remediation ID for audit correlation
        filters:
          $ref: '#/components/schemas/WorkflowSearchFilters'
        top_k:
          type: integer
          default: 10
          minimum: 1
          maximum: 100
          description: Maximum number of results to return
        min_score:
          type: number
          format: float
          default: 0.0
          minimum: 0.0
          maximum: 1.0
          description: Minimum normalized score threshold (0.0-1.0)
        include_disabled:
          type: boolean
          default: false
          description: Include disabled workflows in results

    WorkflowSearchFilters:
      type: object
      required:
        - severity
        - component
        - environment
        - priority
      properties:
        signalType:
          type: string
          description: "Signal type (optional metadata per DD-WORKFLOW-016: OOMKilled, CrashLoopBackOff, etc.)"
          example: "OOMKilled"
        severity:
          type: string
          description: "Severity level (mandatory: critical, high, medium, low)"
          enum: [critical, high, medium, low]
          example: "critical"
        component:
          type: string
          description: "Component type (mandatory: pod, node, deployment, etc.)"
          example: "pod"
        environment:
          type: string
          description: "Environment filter (mandatory, single value from Signal Processing)"
          example: "production"
        priority:
          type: string
          description: "Priority level (mandatory: P0, P1, P2, P3)"
          enum: [P0, P1, P2, P3]
          example: "P0"
        customLabels:
          $ref: '#/components/schemas/CustomLabels'
        detectedLabels:
          $ref: '#/components/schemas/DetectedLabels'
        status:
          type: array
          items:
            type: string
            enum: [active, disabled, deprecated, archived]
          description: "Workflow lifecycle status filter"

    MandatoryLabels:
      type: object
      description: "4 mandatory + 1 optional workflow labels (DD-WORKFLOW-016: signalType now optional)"
      required:
        - severity
        - component
        - environment
        - priority
      properties:
        signalType:
          type: string
          description: "Signal type this workflow handles (optional metadata per DD-WORKFLOW-016)"
          example: "OOMKilled"
        severity:
          type: array
          items:
            type: string
            enum: [critical, high, medium, low]
          minItems: 1
          description: "Severity level(s) this workflow is designed for. Always an array. To match any severity, list all levels."
          example: [critical]
        component:
          type: string
          description: "Kubernetes resource type this workflow targets (e.g., pod, deployment, node)"
          example: "pod"
        environment:
          type: array
          items:
            type: string
            enum: ["production", "staging", "development", "test", "*"]
          minItems: 1
          description: "Target environments (workflow can declare multiple, '*' matches all)"
          example: ["staging", "production"]
        priority:
          type: string
          description: "Business priority level (P0, P1, P2, P3, * for any)"
          enum: [P0, P1, P2, P3, "*"]
          example: "P0"

    CustomLabels:
      type: object
      description: "Customer-defined labels (DD-WORKFLOW-001 v1.5) - subdomain-based format"
      additionalProperties:
        type: array
        items:
          type: string
      example:
        team: ["name=payments"]
        constraint: ["cost-constrained", "stateful-safe"]

    DetectedLabels:
      type: object
      description: "Auto-detected labels from Kubernetes resources (DD-WORKFLOW-001 v2.3) - V1.0 structured types"
      properties:
        failedDetections:
          type: array
          items:
            type: string
            enum: [gitOpsManaged, gitOpsTool, pdbProtected, hpaEnabled, stateful, helmManaged, networkIsolated, serviceMesh]
          description: "Fields where detection failed (RBAC, timeout, etc.) - consumer should ignore these fields"
          example: ["pdbProtected", "networkIsolated"]
        gitOpsManaged:
          type: boolean
          description: "Resource is managed by GitOps (ArgoCD/Flux)"
        gitOpsTool:
          type: string
          description: "GitOps tool: argocd, flux, or * (wildcard = any tool)"
          enum: [argocd, flux, "*"]
          example: "argocd"
        pdbProtected:
          type: boolean
          description: "PodDisruptionBudget protects this workload"
        hpaEnabled:
          type: boolean
          description: "HorizontalPodAutoscaler is configured"
        stateful:
          type: boolean
          description: "Workload uses persistent storage or is StatefulSet"
        helmManaged:
          type: boolean
          description: "Resource is managed by Helm"
        networkIsolated:
          type: boolean
          description: "NetworkPolicy restricts traffic"
        serviceMesh:
          type: string
          description: "Service mesh type: istio, linkerd, or * (wildcard = any mesh)"
          enum: [istio, linkerd, "*"]
          example: "istio"

    WorkflowSearchResponse:
      type: object
      properties:
        workflows:
          type: array
          items:
            $ref: '#/components/schemas/WorkflowSearchResult'
        totalResults:
          type: integer
          description: Total number of matching workflows
        filters:
          $ref: '#/components/schemas/WorkflowSearchFilters'

    WorkflowSearchResult:
      type: object
      description: "Flat response structure (DD-WORKFLOW-002 v3.0)"
      required:
        - workflowId
        - title
        - description
        - confidence
        - finalScore
        - rank
      properties:
        workflowId:
          type: string
          format: uuid
          description: "UUID primary key (DD-WORKFLOW-002 v3.0)"
        title:
          type: string
          description: "Human-readable workflow name"
        description:
          type: string
          description: "Workflow description"
        signalType:
          type: string
          description: "Signal type this workflow handles"
        schemaImage:
          type: string
          description: "OCI image used to extract the workflow schema"
          example: "ghcr.io/kubernaut/workflows/oomkill:v1.0.0@sha256:abc123..."
        schemaDigest:
          type: string
          description: "OCI schema image digest"
          example: "sha256:abc123..."
        executionBundle:
          type: string
          description: "OCI execution bundle reference (digest-pinned)"
        executionBundleDigest:
          type: string
          description: "OCI execution bundle digest"
        confidence:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          description: "Normalized label score (0.0-1.0)"
        labelBoost:
          type: number
          format: float
          minimum: 0.0
          maximum: 0.39
          description: "Boost from matching DetectedLabels"
        labelPenalty:
          type: number
          format: float
          minimum: 0.0
          maximum: 0.20
          description: "Penalty from conflicting DetectedLabels"
        finalScore:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          description: "Final normalized score (same as confidence)"
        rank:
          type: integer
          minimum: 1
          description: "Position in result set (1-based)"
        customLabels:
          $ref: '#/components/schemas/CustomLabels'
        detectedLabels:
          $ref: '#/components/schemas/DetectedLabels'
        parameters:
          type: object
          additionalProperties: true
          description: "Workflow parameter schema (JSONB) - describes expected parameters"

    CreateWorkflowFromOCIRequest:
      type: object
      required:
        - schemaImage
      properties:
        schemaImage:
          type: string
          description: |
            OCI image pullspec. Data Storage pulls this image, extracts
            /workflow-schema.yaml (ADR-043), validates it, and populates
            all catalog fields from the extracted schema.
          example: "quay.io/kubernaut/workflows/scale-replicas:v1.0.0"

    RemediationWorkflow:
      type: object
      required:
        - workflowName
        - version
        - name
        - description
        - content
        - contentHash
        - labels
        - executionEngine
        - status
        - actionType
      properties:
        workflowId:
          type: string
          format: uuid
          description: "Unique workflow identifier (UUID, auto-generated)"
        workflowName:
          type: string
          maxLength: 255
          description: "Workflow name (identifier for versions)"
        actionType:
          type: string
          description: "Action type from taxonomy (DD-WORKFLOW-016). FK to action_type_taxonomy."
          example: "ScaleReplicas"
        version:
          type: string
          maxLength: 50
          description: "Semantic version (e.g., v1.0.0)"
        name:
          type: string
          maxLength: 255
          description: "Human-readable workflow title"
        description:
          $ref: '#/components/schemas/StructuredDescription'
        owner:
          type: string
          maxLength: 255
          description: "Workflow owner"
        maintainer:
          type: string
          maxLength: 255
          format: email
          description: "Workflow maintainer email"
        content:
          type: string
          description: "YAML workflow definition"
        contentHash:
          type: string
          minLength: 64
          maxLength: 64
          description: "SHA-256 hash of content"
        parameters:
          type: object
          additionalProperties: true
          description: "Workflow parameters (JSONB)"
        executionEngine:
          type: string
          description: "Execution engine (e.g., argo-workflows)"
        schemaImage:
          type: string
          description: "OCI image used to extract the workflow schema (DD-WORKFLOW-017)"
          example: "ghcr.io/kubernaut/workflows/oomkill:v1.0.0@sha256:abc123..."
        schemaDigest:
          type: string
          description: "OCI schema image digest"
          example: "sha256:abc123..."
        executionBundle:
          type: string
          description: "OCI execution bundle reference (digest-pinned)"
          example: "ghcr.io/kubernaut/workflows/oomkill@sha256:abc123..."
        executionBundleDigest:
          type: string
          description: "OCI execution bundle digest"
          example: "sha256:abc123..."
        labels:
          $ref: '#/components/schemas/MandatoryLabels'
        customLabels:
          $ref: '#/components/schemas/CustomLabels'
        detectedLabels:
          $ref: '#/components/schemas/DetectedLabels'
        status:
          type: string
          enum: [active, disabled, deprecated, archived]
          description: "Workflow lifecycle status"
        disabledAt:
          type: string
          format: date-time
          description: "When workflow was disabled"
        disabledBy:
          type: string
          maxLength: 255
          description: "Who disabled the workflow"
        disabledReason:
          type: string
          description: "Why workflow was disabled"
        isLatestVersion:
          type: boolean
          description: "Is this the latest version?"
        previousVersion:
          type: string
          maxLength: 50
          description: "Previous version identifier"
        deprecationNotice:
          type: string
          description: "Deprecation notice"
        versionNotes:
          type: string
          description: "Version release notes"
        changeSummary:
          type: string
          description: "Summary of changes in this version"
        approvedBy:
          type: string
          maxLength: 255
          description: "Who approved this version"
        approvedAt:
          type: string
          format: date-time
          description: "When this version was approved"
        expectedSuccessRate:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          description: "Expected success rate (0.0-1.0)"
        expectedDurationSeconds:
          type: integer
          minimum: 0
          description: "Expected execution duration"
        actualSuccessRate:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          description: "Actual success rate (0.0-1.0)"
        totalExecutions:
          type: integer
          minimum: 0
          description: "Total number of executions"
        successfulExecutions:
          type: integer
          minimum: 0
          description: "Number of successful executions"
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        createdBy:
          type: string
          maxLength: 255
        updatedBy:
          type: string
          maxLength: 255

    WorkflowListResponse:
      type: object
      properties:
        workflows:
          type: array
          items:
            $ref: '#/components/schemas/RemediationWorkflow'
        limit:
          type: integer
        offset:
          type: integer
        total:
          type: integer

    WorkflowUpdateRequest:
      type: object
      description: "Update mutable workflow fields only (DD-WORKFLOW-012)"
      properties:
        status:
          type: string
          enum: [active, disabled, deprecated, archived]
          description: "Workflow status (mutable)"
        disabledBy:
          type: string
          description: "Who disabled the workflow"
        disabledReason:
          type: string
          description: "Why the workflow was disabled"

    WorkflowLifecycleRequest:
      type: object
      description: "Request for workflow lifecycle operations (enable, disable, deprecate). Reason is mandatory per DD-WORKFLOW-017 Phase 4.4."
      required:
        - reason
      properties:
        reason:
          type: string
          minLength: 1
          description: "Why the lifecycle operation is being performed (mandatory)"
        updatedBy:
          type: string
          description: "Who is performing the operation"

    WorkflowDisableRequest:
      type: object
      description: "Convenience request to disable a workflow (deprecated: use WorkflowLifecycleRequest)"
      properties:
        reason:
          type: string
          description: "Why the workflow is being disabled"
        updatedBy:
          type: string
          description: "Who is disabling the workflow"

    AuditExportResponse:
      type: object
      description: Signed audit export with tamper-evident hash chain verification
      required:
        - export_metadata
        - events
        - hash_chain_verification
      properties:
        export_metadata:
          type: object
          required:
            - export_timestamp
            - export_format
            - total_events
            - signature
          properties:
            export_timestamp:
              type: string
              format: date-time
              description: When this export was generated
              example: "2026-01-07T20:30:00Z"
            export_format:
              type: string
              enum: [json, csv]
              description: Format of exported data
            query_filters:
              type: object
              description: Filters applied to this export
              properties:
                start_time:
                  type: string
                  format: date-time
                end_time:
                  type: string
                  format: date-time
                correlation_id:
                  type: string
                event_category:
                  type: string
                offset:
                  type: integer
                limit:
                  type: integer
            total_events:
              type: integer
              description: Total number of events in this export
              example: 127
            signature:
              type: string
              description: Digital signature of export (base64-encoded)
              example: "PLACEHOLDER_SIGNATURE"
            signature_algorithm:
              type: string
              description: Signature algorithm used
              example: "SHA256withRSA"
            certificate_fingerprint:
              type: string
              description: SHA256 fingerprint of signing certificate
              example: "3a:f7:12:9c:..."
            exported_by:
              type: string
              description: User who initiated the export (from X-Auth-Request-User)
              example: "system:serviceaccount:kubernaut-system:auditor"
        events:
          type: array
          description: Audit events matching the query filters
          items:
            type: object
            description: Audit event with hash chain metadata
            properties:
              event_id:
                type: string
                format: uuid
              version:
                type: string
              event_type:
                type: string
              event_timestamp:
                type: string
                format: date-time
              event_category:
                type: string
              event_action:
                type: string
              event_outcome:
                type: string
              correlation_id:
                type: string
              event_data:
                type: object
                additionalProperties: true
              event_hash:
                type: string
                description: SHA256 hash of this event
              previous_event_hash:
                type: string
                description: Hash of previous event in chain
              hash_chain_valid:
                type: boolean
                description: Whether this event's hash chain is valid
              legal_hold:
                type: boolean
                description: Whether this event is under legal hold
        hash_chain_verification:
          type: object
          required:
            - total_events_verified
            - valid_chain_events
            - broken_chain_events
            - verification_timestamp
          properties:
            total_events_verified:
              type: integer
              description: Total events with hash chain data
              example: 127
            valid_chain_events:
              type: integer
              description: Events with valid hash chains
              example: 127
            broken_chain_events:
              type: integer
              description: Events with broken hash chains (tampered)
              example: 0
            chain_integrity_percentage:
              type: number
              format: float
              minimum: 0.0
              maximum: 100.0
              description: Percentage of events with valid chains
              example: 100.0
            verification_timestamp:
              type: string
              format: date-time
              description: When verification was performed
            tampered_event_ids:
              type: array
              description: String UUIDs of tampered events (if any)
              items:
                type: string
        detached_signature:
          type: string
          description: Detached PEM-encoded signature (if requested)
          example: "-----BEGIN SIGNATURE-----\n..."

    # ========================================
    # Typed Audit Event Data Schemas (DD-AUDIT-004 V2.0)
    # Generated from pkg/*/audit_types.go - January 8, 2026
    # ========================================

    ErrorDetails:
      type: object
      required: [message, code, component, retry_possible]
      description: Standardized error information for audit events (BR-AUDIT-005 Gap #7)
      properties:
        message:
          type: string
          description: Human-readable error description
          example: "Holmes API request timeout after 30s"
        code:
          type: string
          description: Machine-readable error classification (ERR_[CATEGORY]_[SPECIFIC])
          example: "ERR_UPSTREAM_TIMEOUT"
        component:
          type: string
          description: Service emitting the error
          enum: [gateway, aianalysis, workflowexecution, remediationorchestrator, signalprocessing, authwebhook]
          example: "gateway"
        retry_possible:
          type: boolean
          description: Whether the operation can be retried (true=transient, false=permanent)
          example: true
        stack_trace:
          type: array
          items:
            type: string
          description: Top N stack frames for debugging (optional, 5-10 frames max)
          example: ["/path/to/file.go:123 function.Name"]

    TimeoutConfig:
      type: object
      description: Timeout configuration for RemediationRequest (BR-ORCH-027/028, Gap #8)
      properties:
        global:
          type: string
          description: Global timeout (Go duration string, e.g., "30m", "1h")
          example: "30m"
        processing:
          type: string
          description: Processing phase timeout (Go duration string)
          example: "10m"
        analyzing:
          type: string
          description: Analyzing phase timeout (Go duration string)
          example: "5m"
        executing:
          type: string
          description: Executing phase timeout (Go duration string)
          example: "15m"

    # ========================================
    # Gateway Audit Payload
    # From: pkg/gateway/audit_types.go
    # ========================================

    GatewayAuditPayload:
      type: object
      required: [signal_type, signal_name, namespace, fingerprint, event_type]
      description: Type-safe audit event payload for Gateway (signal.received, signal.deduplicated, crd.created, crd.failed)
      properties:
        event_type:
          type: string
          enum: ['gateway.signal.received', 'gateway.signal.deduplicated', 'gateway.crd.created', 'gateway.crd.failed']
          description: Event type for discriminator (matches parent event_type)
        # RR Reconstruction Fields (BR-AUDIT-005 Gaps #1, #2, #3)
        original_payload:
          type: object
          additionalProperties: true
          description: Full signal payload for RR.Spec.OriginalPayload reconstruction
        signal_labels:
          type: object
          additionalProperties:
            type: string
          description: Signal labels for RR.Spec.SignalLabels reconstruction
        signal_annotations:
          type: object
          additionalProperties:
            type: string
          description: Signal annotations for RR.Spec.SignalAnnotations reconstruction

        # Gateway-Specific Metadata
        signal_type:
          type: string
          enum: [alert]
          description: Signal type identifier. All adapters normalize to "alert". Adapter identity is preserved in audit actor ID (signal.Source).
          example: "alert"
        signal_name:
          type: string
          description: Human-readable signal name (e.g., alert name, event reason)
          example: "HighMemoryUsage"
        namespace:
          type: string
          description: Kubernetes namespace of the affected resource
          example: "payment"
        fingerprint:
          type: string
          description: Unique identifier for the signal (deduplication)
          example: "abc123"
        severity:
          type: string
          description: Raw severity from signal source (pass-through per DD-SEVERITY-001). Gateway does NOT normalize. Accepts ANY value (e.g., "warning", "Sev1", "P0", "critical", etc.). SignalProcessing performs normalization via Rego.
          example: "warning"
        resource_kind:
          type: string
          description: Kubernetes resource kind
          example: "Deployment"
        resource_name:
          type: string
          description: Name of the affected Kubernetes resource
          example: "payment-api"
        remediation_request:
          type: string
          description: Created RemediationRequest reference (namespace/name)
          example: "payment/restart-payment-api-2025-12-17-abc123"

        # Deduplication Fields (conditional)
        deduplication_status:
          type: string
          enum: [new, duplicate]
          description: Whether this is a new or duplicate signal
        occurrence_count:
          type: integer
          format: int32
          description: Number of times this signal has been seen

        # Error Fields (conditional)
        error_details:
          $ref: '#/components/schemas/ErrorDetails'

    # ========================================
    # RemediationOrchestrator Audit Payload
    # From: pkg/remediationorchestrator/audit_types.go
    # ========================================

    RemediationOrchestratorAuditPayload:
      type: object
      required: [rr_name, namespace, event_type]
      description: Type-safe audit event payload for RemediationOrchestrator (lifecycle.started, lifecycle.created, lifecycle.completed, lifecycle.failed, lifecycle.transitioned, approval.requested, approval.approved, approval.rejected)
      properties:
        event_type:
          type: string
          enum: ['orchestrator.lifecycle.started', 'orchestrator.lifecycle.created', 'orchestrator.lifecycle.completed', 'orchestrator.lifecycle.failed', 'orchestrator.lifecycle.transitioned', 'orchestrator.approval.requested', 'orchestrator.approval.approved', 'orchestrator.approval.rejected', 'orchestrator.remediation.manual_review', 'orchestrator.routing.blocked', 'remediation.workflow_created']
          description: Event type for discriminator (matches parent event_type)
        # Core Orchestration Fields
        rr_name:
          type: string
          description: Name of the RemediationRequest being orchestrated
          example: "restart-payment-api-2025-12-17-abc123"
        namespace:
          type: string
          description: Kubernetes namespace of the RemediationRequest
          example: "payment"
        outcome:
          type: string
          enum: [Success, Failed, Pending]
          description: Final outcome of the orchestration
        duration_ms:
          type: integer
          format: int64
          description: Orchestration duration in milliseconds

        # Failure Fields (conditional)
        failure_phase:
          type: string
          enum: [SignalProcessing, AIAnalysis, WorkflowExecution, Approval]
          description: Phase where the failure occurred
        failure_reason:
          type: string
          enum: [Timeout, ValidationError, InfrastructureError, ApprovalRejected, Unknown]
          description: Categorized failure reason
        error_details:
          $ref: '#/components/schemas/ErrorDetails'

        # Transition Fields (conditional)
        from_phase:
          type: string
          description: Phase being transitioned from
        to_phase:
          type: string
          description: Phase being transitioned to
        transition_reason:
          type: string
          description: Reason for the transition

        # Approval Fields (conditional)
        rar_name:
          type: string
          description: Name of the RemediationApprovalRequest
          example: "approve-payment-api-restart-2025-12-17-xyz789"
        required_by:
          type: string
          format: date-time
          description: Approval deadline (RFC3339)
        workflow_id:
          type: string
          description: Selected workflow identifier
        confidence_str:
          type: string
          description: Workflow selection confidence as string
        decision:
          type: string
          enum: [Approved, Rejected, Pending]
          description: Approval decision
        approved_by:
          type: string
          description: User who approved the request
        rejected_by:
          type: string
          description: User who rejected the request
        rejection_reason:
          type: string
          description: Reason for rejection
        message:
          type: string
          description: Additional message or context for the event
        reason:
          type: string
          description: Reason for manual review or other actions
        sub_reason:
          type: string
          description: Sub-categorization of the reason
        notification_name:
          type: string
          description: Associated notification name

        # Gap #8: TimeoutConfig (BR-AUDIT-005, orchestrator.lifecycle.created)
        timeout_config:
          $ref: '#/components/schemas/TimeoutConfig'
          description: Timeout configuration for RR reconstruction (Gap #8)

        # Pre-remediation hash fields (remediation.workflow_created, DD-EM-002)
        pre_remediation_spec_hash:
          type: string
          description: |
            Canonical SHA-256 hash of the target resource's .spec before remediation.
            Computed using DD-EM-002 canonical spec hash algorithm.
            Format: "sha256:<hex>"
          example: "sha256:a1b2c3d4e5f6..."
        target_resource:
          type: string
          description: |
            Target resource identifier in format "namespace/Kind/name" or "Kind/name" for cluster-scoped.
            Used by remediation.workflow_created to capture what resource is being remediated.
          example: "payment/Deployment/payment-api"
        workflow_version:
          type: string
          description: Version of the selected workflow
          example: "1.0.0"
        workflow_type:
          type: string
          description: |
            Action type from DD-WORKFLOW-016 taxonomy (e.g., ScaleReplicas, RestartPod).
            Propagated from AIAnalysis.SelectedWorkflow.ActionType via HAPI three-step discovery.
            Used by DS remediation history to populate workflowType on entries and summaries.
          example: "ScaleReplicas"

    # ========================================
    # SignalProcessing Audit Payload
    # From: pkg/signalprocessing/audit_types.go
    # ========================================

    SignalProcessingAuditPayload:
      type: object
      required: [phase, signal, event_type]
      description: Type-safe audit event payload for SignalProcessing (signal.processed, phase.transition, classification.decision, business.classified, enrichment.completed, error.occurred)
      properties:
        event_type:
          type: string
          enum: ['signalprocessing.signal.processed', 'signalprocessing.phase.transition', 'signalprocessing.classification.decision', 'signalprocessing.business.classified', 'signalprocessing.enrichment.completed', 'signalprocessing.error.occurred']
          description: Event type for discriminator (matches parent event_type)
        # Core Signal Fields
        phase:
          type: string
          enum: [Pending, Enriching, Classifying, Categorizing, Completed, Failed]
          description: Current phase of the SignalProcessing
        signal:
          type: string
          description: Name of the signal being processed
          example: "high-memory-payment-api-abc123"
        severity:
          type: string
          enum: [critical, high, medium, low, unknown]
          description: Normalized severity level (DD-SEVERITY-001 v1.1)

        # DD-SEVERITY-001: Severity Determination Fields (conditional)
        external_severity:
          type: string
          description: Original severity from external monitoring system (e.g., Sev1, P0, critical)
          example: "Sev2"
        normalized_severity:
          type: string
          enum: [critical, high, medium, low, unknown]
          description: Normalized severity determined by Rego policy (DD-SEVERITY-001 v1.1)
          example: "high"
        determination_source:
          type: string
          enum: [rego-policy, fallback, default]
          description: Source of severity determination for audit trail
          example: "rego-policy"
        policy_hash:
          type: string
          pattern: "^[a-f0-9]{64}$"
          description: SHA256 hash of Rego policy used for severity determination (for audit trail and policy version tracking)
          example: "a3b5c8d9e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b8"

        # Classification Fields (conditional)
        environment:
          type: string
          enum: [production, staging, development]
          description: Classified environment
        environment_source:
          type: string
          enum: [rego, labels, default]
          description: Source of the environment classification
        priority:
          type: string
          enum: [P0, P1, P2, P3, P4]
          description: Assigned priority
        priority_source:
          type: string
          enum: [rego, severity, default]
          description: Source of the priority assignment
        criticality:
          type: string
          enum: [critical, high, medium, low]
          description: Business criticality classification
        sla_requirement:
          type: string
          description: SLA requirement for remediation
          example: "5m"

        # Kubernetes Context Fields (conditional)
        has_owner_chain:
          type: boolean
          description: Whether the resource has an owner chain
        owner_chain_length:
          type: integer
          description: Length of the owner chain
        degraded_mode:
          type: boolean
          description: Whether context enrichment was degraded

        # Enrichment Fields (conditional)
        duration_ms:
          type: integer
          description: Enrichment duration in milliseconds
        has_namespace:
          type: boolean
          description: Whether namespace context was enriched
        has_pod:
          type: boolean
          description: Whether pod context was enriched
        has_deployment:
          type: boolean
          description: Whether deployment context was enriched

        # Business Classification Fields (conditional)
        business_unit:
          type: string
          description: Owning business unit

        # Phase Transition Fields (conditional)
        from_phase:
          type: string
          description: Phase being transitioned from
        to_phase:
          type: string
          description: Phase being transitioned to

        # Signal Mode Fields (BR-SP-106, ADR-054)
        signal_mode:
          type: string
          enum: [reactive, predictive]
          description: Whether this signal is reactive (incident occurred) or predictive (incident predicted). BR-SP-106 Predictive Signal Mode Classification.
          example: "predictive"
        source_signal_name:
          type: string
          description: Original signal name before normalization. Only populated for predictive signals (e.g., PredictedOOMKill). SOC2 CC7.4 audit trail preservation.
          example: "PredictedOOMKill"

        # Error Fields (conditional)
        error:
          type: string
          description: Error message if processing failed

    # ========================================
    # AIAnalysis Audit Payload
    # From: pkg/aianalysis/audit_types.go
    # ========================================

    AIAnalysisAuditPayload:
      type: object
      required: [analysis_name, namespace, phase, approval_required, degraded_mode, warnings_count, event_type]
      description: Type-safe audit event payload for AIAnalysis (analysis.completed, analysis.failed)
      properties:
        event_type:
          type: string
          enum: ['aianalysis.analysis.completed', 'aianalysis.analysis.failed']
          description: Event type for discriminator (matches parent event_type)
        analysis_name:
          type: string
          description: Name of the AIAnalysis CRD
          example: "diagnose-payment-api-2025-12-17-abc123"
        namespace:
          type: string
          description: Kubernetes namespace of the AIAnalysis
          example: "payment"
        phase:
          type: string
          enum: [Pending, Analyzing, Completed, Failed]
          description: Current phase of the AIAnalysis
        approval_required:
          type: boolean
          description: Whether manual approval is required
        approval_reason:
          type: string
          description: Reason for approval requirement
        degraded_mode:
          type: boolean
          description: Whether operating in degraded mode
        warnings_count:
          type: integer
          description: Number of warnings encountered
        confidence:
          type: number
          format: float
          description: Workflow selection confidence (0.0-1.0)
        workflow_id:
          type: string
          description: Selected workflow identifier
        reason:
          type: string
          description: Primary failure reason
        sub_reason:
          type: string
          description: Detailed failure sub-reason
        provider_response_summary:
          $ref: '#/components/schemas/ProviderResponseSummary'
        error_details:
          $ref: '#/components/schemas/ErrorDetails'

    # ========================================
    # WorkflowExecution Audit Payload
    # From: pkg/workflowexecution/audit_types.go
    # ========================================

    WorkflowExecutionAuditPayload:
      type: object
      required: [workflow_id, workflow_version, target_resource, phase, container_image, execution_name, event_type]
      description: Type-safe audit event payload for WorkflowExecution (workflow.started, workflow.completed, workflow.failed)
      properties:
        event_type:
          type: string
          enum: ['workflowexecution.workflow.started', 'workflowexecution.workflow.completed', 'workflowexecution.workflow.failed', 'workflowexecution.selection.completed', 'workflowexecution.execution.started']
          description: Event type for discriminator (matches parent event_type). Per ADR-034 v1.5, all WorkflowExecution events use 'workflowexecution' prefix.
        # Core Workflow Fields
        workflow_id:
          type: string
          description: ID of the workflow being executed
          example: "kubectl-restart-deployment"
        workflow_version:
          type: string
          description: Version of the workflow being executed
          example: "v1.0.0"
        target_resource:
          type: string
          description: Kubernetes resource being acted upon (format depends on scope)
          example: "payment/deployment/payment-api"
        phase:
          type: string
          enum: [Pending, Running, Completed, Failed]
          description: Current phase of the WorkflowExecution
        container_image:
          type: string
          description: Tekton PipelineRun container image
          example: "ghcr.io/kubernaut/kubectl-actions:v1.28"
        execution_name:
          type: string
          description: Name of the WorkflowExecution CRD
          example: "restart-payment-api-2025-12-17-abc123"

        # Timing Fields (conditional)
        started_at:
          type: string
          format: date-time
          description: When the PipelineRun started execution
        completed_at:
          type: string
          format: date-time
          description: When the PipelineRun finished (success or failure)
        duration:
          type: string
          description: Human-readable execution duration
          example: "2m30s"

        # Failure Fields (conditional)
        failure_reason:
          type: string
          enum: [OOMKilled, DeadlineExceeded, Forbidden, ImagePullBackOff, ConfigurationError, ResourceExhausted, TaskFailed, Unknown]
          description: Categorized failure reason
        failure_message:
          type: string
          description: Detailed failure message from Tekton
        failed_task_name:
          type: string
          description: Name of the failed TaskRun (if identified)
        error_details:
          $ref: '#/components/schemas/ErrorDetails'

        # PipelineRun Reference (conditional)
        pipelinerun_name:
          type: string
          description: Name of the associated Tekton PipelineRun
          example: "restart-payment-api-2025-12-17-abc123-run"

        # Execution Parameters (SOC2 chain of custody - Issue #103)
        parameters:
          type: object
          additionalProperties:
            type: string
          description: Post-normalization workflow parameters applied to PipelineRun (map[string]string). SOC2 CC7.1-CC7.3 chain of custody.

    # ========================================
    # Webhooks Audit Payloads
    # From: pkg/authwebhook/audit_types.go
    # ========================================

    NotificationAuditPayload:
      type: object
      required: [event_type]
      description: Type-safe audit event payload for NotificationRequest webhooks (notification.cancelled, notification.acknowledged)
      properties:
        event_type:
          type: string
          enum: ['webhook.notification.cancelled', 'webhook.notification.acknowledged']
          description: Event type for discriminator (matches parent event_type)
        notification_id:
          type: string
          description: Name of the NotificationRequest
          example: "alert-payment-api-2025-12-17-abc123"
        notification_name:
          type: string
          description: Alias for notification_id
        type:
          type: string
          enum: [escalation, simple, status-update, approval, manual-review]
          description: Notification type (matches api/notification/v1alpha1/notificationrequest_types.go:31-40)
        notification_type:
          type: string
          enum: [escalation, simple, status-update, approval, manual-review]
          description: Alias for type (matches CRD NotificationType enum)
        priority:
          type: string
          enum: [critical, high, medium, low]
          description: Notification priority (matches api/notification/v1alpha1/notificationrequest_types.go:47-50)
        final_status:
          type: string
          enum: [Pending, Sending, Sent, Failed, Cancelled]
          description: Final status of the notification (matches api/notification/v1alpha1/notificationrequest_types.go:60-65)
        recipients:
          type: array
          items:
            type: object
            properties:
              email:
                type: string
                description: Email address (for email channel)
                example: "user@example.com"
              slack:
                type: string
                description: Slack channel or user (#channel-name or @username)
                example: "#alerts"
              teams:
                type: string
                description: Teams channel or user
                example: "team@company.com"
              phone:
                type: string
                description: Phone number in E.164 format
                example: "+1234567890"
              webhookURL:
                type: string
                description: Webhook URL for webhook channel
                example: "https://example.com/webhook"
            description: Notification recipient (matches CRD Recipient struct)
          description: Array of notification recipients from CRD (BR-NOTIFICATION-001, matches api/notification/v1alpha1/notificationrequest_types.go:80-102)
        cancelled_by:
          type: string
          description: Username who cancelled the notification
        user_uid:
          type: string
          description: UID of the user who performed the action
        user_groups:
          type: array
          items:
            type: string
          description: Groups of the user who performed the action
        action:
          type: string
          enum: [notification_cancelled, notification_acknowledged]
          description: Webhook action performed

    WorkflowExecutionWebhookAuditPayload:
      type: object
      required: [workflow_name, clear_reason, cleared_at, previous_state, new_state, event_type]
      description: Type-safe audit event payload for WorkflowExecution webhooks (block.cleared)
      properties:
        event_type:
          type: string
          enum: ['workflowexecution.block.cleared']
          description: Event type for discriminator (matches parent event_type)
        workflow_name:
          type: string
          description: Name of the WorkflowExecution
          example: "restart-payment-api-2025-12-17-abc123"
        clear_reason:
          type: string
          description: Reason for clearing the block
          example: "Manual approval by ops team"
        cleared_at:
          type: string
          format: date-time
          description: When the block was cleared
        previous_state:
          type: string
          enum: [Blocked]
          description: State before unblocking (always "Blocked")
        new_state:
          type: string
          enum: [Running]
          description: State after unblocking (always "Running")

    RemediationApprovalAuditPayload:
      type: object
      required: [request_name, decision, decided_at, decision_message, ai_analysis_ref, event_type]
      description: Type-safe audit event payload for RemediationApprovalRequest webhooks (approval.decided)
      properties:
        event_type:
          type: string
          enum: ['webhook.remediationapprovalrequest.decided']
          description: Event type for discriminator (matches parent event_type)
        request_name:
          type: string
          description: Name of the RemediationApprovalRequest
          example: "approve-payment-api-2025-12-17-abc123"
        decision:
          type: string
          enum: [Approved, Rejected]
          description: Approval decision
        decided_at:
          type: string
          format: date-time
          description: When the decision was made
        decision_message:
          type: string
          description: Reason for the decision
        ai_analysis_ref:
          type: string
          description: Name of the referenced AIAnalysis

    # ========================================
    # RemediationApprovalRequest Controller Audit Payloads
    # From: pkg/remediationapprovalrequest/audit/
    # BR-AUDIT-006: Approval decision audit trail (SOC 2 CC8.1)
    # ========================================

    RemediationApprovalDecisionPayload:
      type: object
      required: [event_type, remediation_request_name, ai_analysis_name, decision, decided_by, confidence, workflow_id]
      description: |
        Audit payload for approval decision event (approval.decision).
        Captures WHO, WHEN, WHAT, WHY for SOC 2 CC8.1 (User Attribution) compliance.
        Emitted by RemediationApprovalRequest controller when decision is made.
      properties:
        event_type:
          type: string
          enum: [approval.decision, approval.request.created, approval.timeout]
          description: Event type for discriminator (matches parent event_type)
        remediation_request_name:
          type: string
          description: Parent RemediationRequest name (correlation ID)
          example: "rr-oomkilled-abc123"
        ai_analysis_name:
          type: string
          description: AIAnalysis CRD that required approval
          example: "ai-rr-oomkilled-abc123"
        decision:
          type: string
          enum: [approved, rejected, expired]
          description: Final approval decision
          example: "approved"
        decided_by:
          type: string
          description: Authenticated username from webhook (SOC 2 CC8.1)
          example: "alice@example.com"
        decided_at:
          type: string
          format: date-time
          description: When decision was made
          example: "2026-01-15T10:30:00Z"
        decision_message:
          type: string
          description: Optional rationale from operator
          example: "Root cause accurate. Safe to proceed with memory increase."
        confidence:
          type: number
          format: float
          description: AI confidence score that triggered approval
          example: 0.75
        workflow_id:
          type: string
          description: Workflow being approved
          example: "oomkill-increase-memory-limits"
        workflow_version:
          type: string
          description: Workflow version
          example: "v1.2.0"
        target_resource:
          type: string
          description: Target resource being remediated
          example: "payment/deployment/payment-api"
        timeout_deadline:
          type: string
          format: date-time
          description: Approval deadline
          example: "2026-01-15T10:45:00Z"
        decision_duration_seconds:
          type: integer
          description: Time to decision (seconds)
          example: 180
        approval_reason:
          type: string
          description: Reason for requiring approval (for request.created event)
          example: "Confidence below 80% auto-approve threshold"
        timeout_reason:
          type: string
          description: Reason for timeout (for timeout event)
          example: "No operator response within deadline"
        timeout_duration_seconds:
          type: integer
          description: Timeout duration in seconds (for timeout event)
          example: 900

    RemediationRequestWebhookAuditPayload:
      type: object
      required: [rr_name, namespace, event_type, modified_by, modified_at]
      description: Type-safe audit event payload for RemediationRequest webhooks (timeout_modified)
      properties:
        event_type:
          type: string
          enum: ['webhook.remediationrequest.timeout_modified']
          description: Event type for discriminator (matches parent event_type)
        rr_name:
          type: string
          description: Name of the RemediationRequest
          example: "rr-payment-restart-123"
        namespace:
          type: string
          description: Kubernetes namespace
          example: "production"
        modified_by:
          type: string
          description: User who modified the timeout configuration
          example: "ops-user@example.com"
        modified_at:
          type: string
          format: date-time
          description: When the modification occurred
        old_timeout_config:
          $ref: '#/components/schemas/TimeoutConfig'
          description: Previous timeout configuration
        new_timeout_config:
          $ref: '#/components/schemas/TimeoutConfig'
          description: New timeout configuration after operator modification

    # ========================================
    # Effectiveness Monitor Audit Payloads
    # From: pkg/effectivenessmonitor/audit/
    # Authority: ADR-EM-001, DD-AUDIT-003, BR-EM-095
    # ========================================

    EffectivenessAssessmentAuditPayload:
      type: object
      required: [correlation_id, namespace, event_type, component]
      description: |
        Type-safe audit event payload for Effectiveness Monitor controller.
        Covers component-level events (health, alert, metrics, hash),
        the scheduling event (assessment.scheduled), and the lifecycle
        completion event (assessment.completed).
        Per ADR-EM-001: Each component assessment emits its own audit event.
      properties:
        event_type:
          type: string
          enum:
            - 'effectiveness.health.assessed'
            - 'effectiveness.hash.computed'
            - 'effectiveness.alert.assessed'
            - 'effectiveness.metrics.assessed'
            - 'effectiveness.assessment.scheduled'
            - 'effectiveness.assessment.completed'
          description: Event type for discriminator (matches parent event_type)
        correlation_id:
          type: string
          description: Correlation ID (EA spec.correlationID, matches parent RR name)
          example: "restart-payment-api-2026-02-12-abc123"
        namespace:
          type: string
          description: Kubernetes namespace of the EffectivenessAssessment
          example: "production"
        ea_name:
          type: string
          description: Name of the EffectivenessAssessment CRD
          example: "ea-restart-payment-api-abc123"
        component:
          type: string
          enum: [health, alert, metrics, hash, scheduled, completed]
          description: Assessment component that produced this event
          example: "health"
        assessed:
          type: boolean
          description: Whether the component was successfully assessed
          example: true
        score:
          type: number
          format: double
          nullable: true
          description: Component score (0.0-1.0), null if not assessed
          example: 0.85
        details:
          type: string
          description: Human-readable details about the assessment result
          example: "1 of 1 replicas ready"
        reason:
          type: string
          description: Assessment completion reason (only for assessment.completed events)
          example: "full"

        # assessment.completed enrichment fields (ADR-EM-001, Batch 3)
        signal_name:
          type: string
          description: |
            Name of the original signal that triggered the remediation pipeline.
            Extracted from EA spec target resource context. Only present for assessment.completed events.
          example: "HighCPUUsage"
        components_assessed:
          type: array
          items:
            type: string
          description: |
            List of component names that were assessed (e.g. ["health","hash","alert","metrics"]).
            Only present for assessment.completed events.
          example: ["health", "hash", "alert"]
        completed_at:
          type: string
          format: date-time
          description: |
            Timestamp when the assessment completed (EA status.completedAt).
            Only present for assessment.completed events.
          example: "2026-02-12T15:45:00Z"
        assessment_duration_seconds:
          type: number
          format: double
          nullable: true
          description: |
            Seconds from RemediationRequest creation to assessment completion.
            Computed as (completedAt - remediationCreatedAt). Null if remediationCreatedAt is not set.
            Only present for assessment.completed events.
            Distinct from alert_resolution.resolution_time_seconds which measures alert-level resolution.
          example: 1800.5

        validity_deadline:
          type: string
          format: date-time
          description: |
            Computed validity deadline (only for assessment.scheduled events).
            EA.creationTimestamp + validityWindow from EM config.
          example: "2026-02-12T15:30:00Z"
        prometheus_check_after:
          type: string
          format: date-time
          description: |
            Computed earliest time for Prometheus check (only for assessment.scheduled events).
            EA.creationTimestamp + stabilizationWindow.
          example: "2026-02-12T15:05:00Z"
        alertmanager_check_after:
          type: string
          format: date-time
          description: |
            Computed earliest time for AlertManager check (only for assessment.scheduled events).
            EA.creationTimestamp + stabilizationWindow.
          example: "2026-02-12T15:05:00Z"
        validity_window:
          type: string
          description: |
            Validity window duration from EM config (only for assessment.scheduled events).
            Included for operational observability.
          example: "30m0s"
        stabilization_window:
          type: string
          description: |
            Stabilization window duration from EA spec (only for assessment.scheduled events).
            Included for operational observability.
          example: "5m0s"

        # Hash comparison fields (DD-EM-002, effectiveness.hash.computed)
        pre_remediation_spec_hash:
          type: string
          description: |
            Canonical SHA-256 hash of the target resource's .spec BEFORE remediation.
            Retrieved from DataStorage audit trail (remediation.workflow_created event).
            Format: "sha256:<hex>". Only present for effectiveness.hash.computed events.
          example: "sha256:a1b2c3d4..."
        post_remediation_spec_hash:
          type: string
          description: |
            Canonical SHA-256 hash of the target resource's .spec AFTER remediation.
            Computed by EM during assessment using DD-EM-002 canonical hash algorithm.
            Format: "sha256:<hex>". Only present for effectiveness.hash.computed events.
          example: "sha256:e5f6a7b8..."
        hash_match:
          type: boolean
          description: |
            Whether the pre and post remediation spec hashes match.
            true = no change detected (remediation may have been reverted or had no effect).
            false = spec changed (expected for successful remediations).
            Only present for effectiveness.hash.computed events.
          example: false

        # Typed sub-objects (v2.5, DD-017 v2.5, coordinated with DD-HAPI-016 v1.1)
        # Each component event carries its typed sub-object alongside the human-readable details string.

        health_checks:
          type: object
          description: |
            Structured health check results from the K8s API assessment.
            Only present for effectiveness.health.assessed events.
            Enables downstream consumers (DS, HAPI) to extract typed fields
            without parsing the human-readable details string.
          properties:
            pod_running:
              type: boolean
              description: Whether at least one pod exists for the target resource
              example: true
            readiness_pass:
              type: boolean
              description: Whether all desired replicas are ready (readyReplicas == totalReplicas)
              example: true
            total_replicas:
              type: integer
              format: int32
              description: Total number of desired replicas
              example: 3
            ready_replicas:
              type: integer
              format: int32
              description: Number of ready replicas
              example: 3
            restart_delta:
              type: integer
              format: int32
              description: Total container restart count since remediation
              example: 0
            crash_loops:
              type: boolean
              description: Whether any container is in CrashLoopBackOff waiting state
              example: false
            oom_killed:
              type: boolean
              description: Whether any container was terminated with OOMKilled reason since remediation
              example: false
            pending_count:
              type: integer
              format: int32
              description: |
                Number of pods in Pending phase after the stabilization window.
                Pods still Pending after stabilization indicates scheduling failures,
                image pull issues, or resource exhaustion. 0 = all pods running or terminated.
              example: 0

        metric_deltas:
          type: object
          description: |
            Structured pre/post remediation metric comparison results from Prometheus.
            Only present for effectiveness.metrics.assessed events.
            Phase A (V1.0): cpu_before/cpu_after populated. Other fields nullable pending
            Phase B metrics assessor expansion (additional PromQL queries).
          properties:
            cpu_before:
              type: number
              format: double
              nullable: true
              description: CPU utilization before remediation (earliest sample in query range)
              example: 0.95
            cpu_after:
              type: number
              format: double
              nullable: true
              description: CPU utilization after remediation (latest sample in query range)
              example: 0.72
            memory_before:
              type: number
              format: double
              nullable: true
              description: Memory utilization before remediation (Phase B)
            memory_after:
              type: number
              format: double
              nullable: true
              description: Memory utilization after remediation (Phase B)
            latency_p95_before_ms:
              type: number
              format: double
              nullable: true
              description: Request latency p95 in milliseconds before remediation (Phase B)
            latency_p95_after_ms:
              type: number
              format: double
              nullable: true
              description: Request latency p95 in milliseconds after remediation (Phase B)
            error_rate_before:
              type: number
              format: double
              nullable: true
              description: Error rate (5xx/total) before remediation (Phase B)
            error_rate_after:
              type: number
              format: double
              nullable: true
              description: Error rate (5xx/total) after remediation (Phase B)
            throughput_before_rps:
              type: number
              format: double
              nullable: true
              description: Request throughput (requests/second) before remediation
            throughput_after_rps:
              type: number
              format: double
              nullable: true
              description: Request throughput (requests/second) after remediation

        alert_resolution:
          type: object
          description: |
            Structured alert resolution check results from AlertManager.
            Only present for effectiveness.alert.assessed events.
          properties:
            alert_resolved:
              type: boolean
              description: Whether the triggering alert is no longer active in AlertManager
              example: true
            active_count:
              type: integer
              format: int32
              description: Number of matching active alerts found in AlertManager
              example: 0
            resolution_time_seconds:
              type: number
              format: double
              nullable: true
              description: Seconds from remediation completion to alert resolution (null if not resolved)

    # ========================================
    # DataStorage Audit Payloads
    # From: pkg/datastorage/audit/
    # ========================================

    # Workflow Catalog Events
    WorkflowCatalogCreatedPayload:
      type: object
      required: [workflow_id, workflow_name, version, status, is_latest_version, execution_engine, name]
      description: Audit payload for workflow catalog creation (datastorage.workflow.created)
      properties:
        workflow_id:
          type: string
          format: uuid
          description: Unique workflow identifier (UUID)
          example: "550e8400-e29b-41d4-a716-446655440000"
        workflow_name:
          type: string
          description: Human-readable workflow name
          example: "restart-oomkilled-pod"
        version:
          type: string
          description: Workflow version
          example: "1.0.0"
        status:
          type: string
          enum: [active, disabled, archived]
          description: Workflow status
          example: "active"
        is_latest_version:
          type: boolean
          description: Whether this is the latest version
          example: true
        execution_engine:
          type: string
          description: Workflow execution engine
          example: "argo"
        name:
          type: string
          description: Display name
          example: "Restart OOMKilled Pod"
        description:
          type: string
          description: Workflow description
          example: "Restarts pods that were terminated due to OOM"
        labels:
          type: object
          additionalProperties: true
          description: Workflow labels

    WorkflowCatalogUpdatedPayload:
      type: object
      required: [workflow_id, updated_fields]
      description: Audit payload for workflow catalog updates (datastorage.workflow.updated)
      properties:
        workflow_id:
          type: string
          format: uuid
          description: Unique workflow identifier (UUID)
          example: "550e8400-e29b-41d4-a716-446655440000"
        updated_fields:
          $ref: '#/components/schemas/WorkflowCatalogUpdatedFields'

    WorkflowCatalogUpdatedFields:
      type: object
      description: Fields that were updated in the workflow catalog
      properties:
        status:
          type: string
          description: Updated workflow status
          example: "disabled"
        disabled_by:
          type: string
          description: User who disabled the workflow (only for status=disabled)
          example: "admin@example.com"
        disabled_reason:
          type: string
          description: Reason for disabling (only for status=disabled)
          example: "Security vulnerability detected"
        version:
          type: string
          description: Updated version
          example: "1.0.1"
        description:
          type: string
          description: Updated description
          example: "Updated workflow description"

    # Workflow Discovery Events (DD-HAPI-017, DD-WORKFLOW-014 v3.0)
    WorkflowDiscoveryAuditPayload:
      type: object
      required: [event_type, query, results, search_metadata]
      description: |
        Audit event payload for three-step workflow discovery operations.
        Authority: DD-HAPI-017 (Three-Step Workflow Discovery Integration)
        Authority: DD-WORKFLOW-014 v3.0 (Workflow Selection Audit Trail)
        Replaces WorkflowSearchAuditPayload (search endpoint removed).
      properties:
        event_type:
          type: string
          enum:
            - 'workflow.catalog.actions_listed'
            - 'workflow.catalog.workflows_listed'
            - 'workflow.catalog.workflow_retrieved'
            - 'workflow.catalog.selection_validated'
          description: Discriminator for event data union type (matches parent event_type)
        query:
          $ref: '#/components/schemas/QueryMetadata'
        results:
          $ref: '#/components/schemas/ResultsMetadata'
        search_metadata:
          $ref: '#/components/schemas/SearchExecutionMetadata'

    QueryMetadata:
      type: object
      required: [top_k]
      description: Search query parameters (BR-AUDIT-025)
      properties:
        top_k:
          type: integer
          format: int32
          description: Maximum number of results to return
          example: 5
        min_score:
          type: number
          format: double
          description: Minimum similarity score threshold
          example: 0.7
        filters:
          $ref: '#/components/schemas/WorkflowSearchFilters'

    ResultsMetadata:
      type: object
      required: [total_found, returned, workflows]
      description: Search results metadata (BR-AUDIT-027)
      properties:
        total_found:
          type: integer
          format: int32
          description: Total number of workflows matching the query
          example: 10
        returned:
          type: integer
          format: int32
          description: Number of workflows returned in this response
          example: 5
        workflows:
          type: array
          items:
            $ref: '#/components/schemas/WorkflowResultAudit'

    WorkflowResultAudit:
      type: object
      required: [workflow_id, title, rank, scoring]
      description: Audit information for a single workflow result (BR-AUDIT-027)
      properties:
        workflow_id:
          type: string
          format: uuid
          description: Workflow UUID (DD-WORKFLOW-002 v3.0)
          example: "550e8400-e29b-41d4-a716-446655440000"
        title:
          type: string
          description: Workflow title
          example: "Restart OOMKilled Pod"
        rank:
          type: integer
          format: int32
          description: Search result ranking (1-indexed)
          example: 1
        scoring:
          $ref: '#/components/schemas/ScoringV1Audit'
        owner:
          type: string
          description: Workflow owner
          example: "platform-team"
        maintainer:
          type: string
          description: Workflow maintainer
          example: "alice@example.com"
        description:
          type: string
          description: Workflow description
          example: "Restarts pods that were OOMKilled"
        labels:
          type: object
          additionalProperties: true
          description: Workflow labels

    ScoringV1Audit:
      type: object
      required: [confidence]
      description: V1.0 scoring (confidence only per DD-WORKFLOW-004 v2.0)
      properties:
        confidence:
          type: number
          format: double
          description: Overall confidence score (0.0-1.0)
          example: 0.95
          minimum: 0
          maximum: 1

    SearchExecutionMetadata:
      type: object
      required: [duration_ms]
      description: Search execution details (BR-AUDIT-028). V1.0 label-only (DD-WORKFLOW-015).
      properties:
        duration_ms:
          type: integer
          format: int64
          description: Search execution time in milliseconds
          example: 150

    # ========================================
    # AIAnalysis Internal Event Payloads
    # From: pkg/aianalysis/audit/event_types.go
    # ========================================

    AIAnalysisPhaseTransitionPayload:
      type: object
      required: [old_phase, new_phase]
      description: Phase transition event payload (aianalysis.phase.transition)
      properties:
        old_phase:
          type: string
          description: Previous phase
          example: "Investigating"
        new_phase:
          type: string
          description: New phase
          example: "Analyzing"

    AIAnalysisAIAgentCallPayload:
      type: object
      required: [endpoint, http_status_code, duration_ms]
      description: AI agent call event payload (aianalysis.aiagent.call)
      properties:
        endpoint:
          type: string
          description: API endpoint called
          example: "/api/v1/investigate"
        http_status_code:
          type: integer
          format: int32
          description: HTTP status code
          example: 200
        duration_ms:
          type: integer
          format: int32
          description: Call duration in milliseconds
          example: 1500

    AIAnalysisApprovalDecisionPayload:
      type: object
      required: [approval_required, approval_reason, auto_approved, decision, reason, environment]
      description: Approval decision event payload (aianalysis.approval.decision)
      properties:
        approval_required:
          type: boolean
          description: Whether manual approval is required
          example: true
        approval_reason:
          type: string
          description: Reason for approval requirement
          example: "Production environment requires manual approval"
        auto_approved:
          type: boolean
          description: Whether auto-approved
          example: false
        decision:
          type: string
          description: Decision made
          example: "requires_approval"
        reason:
          type: string
          description: Reason for decision
          example: "Rego policy requires manual approval for production"
        environment:
          type: string
          description: Environment context
          example: "production"
        confidence:
          type: number
          format: double
          description: Workflow confidence level (optional)
          example: 0.95
        workflow_id:
          type: string
          description: Selected workflow identifier (optional)
          example: "restart-oomkilled-pod"

    AIAnalysisRegoEvaluationPayload:
      type: object
      required: [outcome, degraded, duration_ms, reason]
      description: Rego policy evaluation event payload (aianalysis.rego.evaluation)
      properties:
        outcome:
          type: string
          description: Evaluation outcome
          example: "allow"
        degraded:
          type: boolean
          description: Whether evaluation ran in degraded mode
          example: false
        duration_ms:
          type: integer
          format: int32
          description: Evaluation duration in milliseconds
          example: 50
        reason:
          type: string
          description: Reason for the evaluation outcome
          example: "Policy allows auto-approval for non-production"

    AIAnalysisErrorPayload:
      type: object
      required: [phase, error_message]
      description: Error event payload (aianalysis.error.occurred)
      properties:
        phase:
          type: string
          description: Phase in which error occurred
          example: "Investigating"
        error_message:
          type: string
          description: Error message
          example: "HolmesGPT API timeout after 30s"

    ProviderResponseSummary:
      type: object
      required: [incident_id, analysis_preview, needs_human_review, warnings_count]
      description: Summary of Holmes API response from AIAnalysis consumer perspective (BR-AUDIT-005 v2.0 Gap #4)
      properties:
        incident_id:
          type: string
          description: Incident identifier
          example: "incident-payment-api-2025-12-17-abc123"
        analysis_preview:
          type: string
          description: First 500 chars of analysis
          example: "Root cause: Database connection pool exhausted..."
        selected_workflow_id:
          type: string
          description: Selected workflow identifier (if any)
          example: "restart-payment-api-v1.2"
        needs_human_review:
          type: boolean
          description: Whether human review is required
        warnings_count:
          type: integer
          description: Number of warnings from Holmes
          example: 2

    # ========================================
    # Notification Event Payloads
    # From: pkg/notification/audit/event_types.go
    # ========================================

    NotificationMessageSentPayload:
      type: object
      required: [notification_id, channel, subject, body, priority, type]
      description: Message sent event payload (notification.message.sent)
      properties:
        notification_id:
          type: string
          description: Name of the NotificationRequest CRD
        channel:
          type: string
          description: Delivery channel
        subject:
          type: string
          description: Notification subject line
        body:
          type: string
          description: Notification message body
        priority:
          type: string
          description: Notification priority level
        type:
          type: string
          description: Notification type
        metadata:
          type: object
          additionalProperties:
            type: string

    NotificationMessageFailedPayload:
      type: object
      required: [notification_id, channel, subject, body, priority, error_type]
      description: Message failed event payload (notification.message.failed)
      properties:
        notification_id:
          type: string
        channel:
          type: string
        subject:
          type: string
        body:
          type: string
        priority:
          type: string
        error_type:
          type: string
        error:
          type: string
        metadata:
          type: object
          additionalProperties:
            type: string

    NotificationMessageAcknowledgedPayload:
      type: object
      required: [notification_id, subject, priority]
      description: Message acknowledged event payload (notification.message.acknowledged)
      properties:
        notification_id:
          type: string
        subject:
          type: string
        priority:
          type: string
        metadata:
          type: object
          additionalProperties:
            type: string

    NotificationMessageEscalatedPayload:
      type: object
      required: [notification_id, subject, priority, reason]
      description: Message escalated event payload (notification.message.escalated)
      properties:
        notification_id:
          type: string
        subject:
          type: string
        priority:
          type: string
        reason:
          type: string
        metadata:
          type: object
          additionalProperties:
            type: string

    # ========================================
    # HolmesGPT API Event Payloads
    # From: holmesgpt-api/src/models/audit_models.py
    # ========================================

    AIAgentResponsePayload:
      type: object
      required: [event_type, event_id, incident_id, response_data]
      description: AI Agent response completion event payload (aiagent.response.complete) - Provider perspective (DD-AUDIT-005)
      properties:
        event_type:
          type: string
          enum: ['aiagent.response.complete']
          description: Event type for discriminator (matches parent event_type)
        event_id:
          type: string
          description: Unique event identifier
          example: "evt-hapi-123-abc"
        incident_id:
          type: string
          description: Incident correlation ID from request
          example: "incident-payment-api-2025-12-17-abc123"
        response_data:
          $ref: '#/components/schemas/IncidentResponseData'

    IncidentResponseData:
      type: object
      required: [incidentId, analysis, rootCauseAnalysis, confidence, timestamp]
      description: Complete IncidentResponse structure from HolmesGPT API (DD-AUDIT-004 - strongly typed, no additionalProperties)
      properties:
        incidentId:
          type: string
          description: Incident identifier from request
          example: "incident-payment-api-2025-12-17-abc123"
        analysis:
          type: string
          description: Natural language analysis from LLM
          example: "Root cause analysis indicates..."
        rootCauseAnalysis:
          type: object
          description: Structured RCA with summary, severity, contributingFactors
          required: [summary, severity, contributingFactors]
          properties:
            summary:
              type: string
              description: Brief RCA summary
            severity:
              type: string
              enum: [critical, high, medium, low, unknown]
              description: Incident severity (BR-SEVERITY-001)
              example: "high"
            contributingFactors:
              type: array
              items:
                type: string
              description: List of contributing factors
          additionalProperties: false
        selectedWorkflow:
          type: object
          description: Selected workflow with workflowId, actionType, executionBundle, confidence, parameters (optional)
          properties:
            workflowId:
              type: string
            actionType:
              type: string
              description: |
                Action type from DD-WORKFLOW-016 taxonomy (e.g., ScaleReplicas, RestartPod).
                Propagated from HAPI three-step discovery protocol.
              example: "ScaleReplicas"
            executionBundle:
              type: string
            confidence:
              type: number
              format: float
              minimum: 0.0
              maximum: 1.0
            parameters:
              type: object
              additionalProperties: true
          additionalProperties: false
        confidence:
          type: number
          format: float
          minimum: 0.0
          maximum: 1.0
          description: Overall confidence in analysis
          example: 0.85
        timestamp:
          type: string
          format: date-time
          description: ISO timestamp of analysis completion
        needsHumanReview:
          type: boolean
          default: false
          description: True when AI could not produce reliable result
        humanReviewReason:
          type: string
          enum: [workflow_not_found, image_mismatch, parameter_validation_failed, no_matching_workflows, low_confidence, llm_parsing_error, investigation_inconclusive, rca_incomplete]
          description: Structured reason when needsHumanReview=true (BR-HAPI-197, BR-HAPI-200, BR-HAPI-212)
        warnings:
          type: array
          items:
            type: string
          description: Non-fatal warnings (e.g., OwnerChain validation issues)
        alternativeWorkflows:
          type: array
          items:
            type: object
            properties:
              workflowId:
                type: string
              rationale:
                type: string
            additionalProperties: false
          description: Other workflows considered but not selected

    LLMRequestPayload:
      type: object
      required: [event_type, event_id, incident_id, model, prompt_length, prompt_preview]
      description: LLM API request event payload (aiagent.llm.request)
      properties:
        event_type:
          type: string
          enum: ['aiagent.llm.request']
          description: Event type for discriminator (matches parent event_type)
        event_id:
          type: string
          description: Unique event identifier
        incident_id:
          type: string
          description: Incident correlation ID (remediation_id)
        model:
          type: string
          description: LLM model identifier
          example: "gpt-4"
        prompt_length:
          type: integer
          minimum: 0
          description: Length of prompt sent to LLM
        prompt_preview:
          type: string
          description: First 500 characters of prompt for audit
        max_tokens:
          type: integer
          minimum: 0
          description: Maximum tokens requested
        toolsets_enabled:
          type: array
          items:
            type: string
          description: List of enabled toolsets
        mcp_servers:
          type: array
          items:
            type: string
          description: List of MCP servers

    LLMResponsePayload:
      type: object
      required: [event_type, event_id, incident_id, has_analysis, analysis_length, analysis_preview]
      description: LLM API response event payload (aiagent.llm.response)
      properties:
        event_type:
          type: string
          enum: ['aiagent.llm.response']
          description: Event type for discriminator (matches parent event_type)
        event_id:
          type: string
          description: Unique event identifier
        incident_id:
          type: string
          description: Incident correlation ID (remediation_id)
        has_analysis:
          type: boolean
          description: Whether LLM provided analysis
        analysis_length:
          type: integer
          minimum: 0
          description: Length of LLM response
        analysis_preview:
          type: string
          description: First 500 characters of response for audit
        tokens_used:
          type: integer
          minimum: 0
          description: Tokens consumed by LLM
        tool_call_count:
          type: integer
          minimum: 0
          default: 0
          description: Number of tool calls made by LLM

    LLMToolCallPayload:
      type: object
      required: [event_type, event_id, incident_id, tool_call_index, tool_name, tool_result]
      description: LLM tool call event payload (aiagent.llm.tool_call)
      properties:
        event_type:
          type: string
          enum: ['aiagent.llm.tool_call']
          description: Event type for discriminator (matches parent event_type)
        event_id:
          type: string
          description: Unique event identifier
        incident_id:
          type: string
          description: Incident correlation ID (remediation_id)
        tool_call_index:
          type: integer
          minimum: 0
          description: Sequential index of tool call in conversation
        tool_name:
          type: string
          description: Name of tool invoked
          example: "list_available_actions"
        tool_arguments:
          type: object
          additionalProperties: true
          description: Arguments passed to tool (flexible for different tools)
        tool_result:
          description: Full result returned by tool
        tool_result_preview:
          type: string
          description: First 500 characters of tool result

    WorkflowValidationPayload:
      type: object
      required: [event_type, event_id, incident_id, attempt, max_attempts, is_valid]
      description: Workflow validation attempt event payload (aiagent.workflow.validation_attempt)
      properties:
        event_type:
          type: string
          enum: ['aiagent.workflow.validation_attempt']
          description: Event type for discriminator (matches parent event_type)
        event_id:
          type: string
          description: Unique event identifier
        incident_id:
          type: string
          description: Incident correlation ID (remediation_id)
        attempt:
          type: integer
          minimum: 1
          description: Current validation attempt number
        max_attempts:
          type: integer
          minimum: 1
          description: Maximum validation attempts allowed
        is_valid:
          type: boolean
          description: Whether validation succeeded
        errors:
          type: array
          items:
            type: string
          description: List of validation error messages
        validation_errors:
          type: string
          description: Combined validation error messages (for backward compatibility)
        workflow_id:
          type: string
          description: Workflow ID being validated
        workflow_name:
          type: string
          description: Name of workflow being validated
        human_review_reason:
          type: string
          description: Reason code if needs_human_review (final attempt)
        is_final_attempt:
          type: boolean
          default: false
          description: Whether this is the final validation attempt

    # ─── Remediation History Context (DD-HAPI-016) ───

    RemediationHistoryContext:
      type: object
      description: |
        Structured remediation history context for LLM prompt enrichment.
        Contains two tiers of remediation chain data for a target resource.
        Authority: DD-HAPI-016.
      required:
        - targetResource
        - currentSpecHash
        - regressionDetected
        - tier1
        - tier2
      properties:
        targetResource:
          type: string
          description: |
            Target resource identifier in format "{namespace}/{kind}/{name}".
            Matches the format used by RO and EM audit events.
          example: "prod/Deployment/my-app"
        currentSpecHash:
          type: string
          description: |
            SHA-256 hash of the current target resource spec (echoed from request).
          example: "sha256:aabb112233dd"
        regressionDetected:
          type: boolean
          description: |
            True if any remediation entry's preRemediationSpecHash matches
            currentSpecHash, indicating configuration regression.
        tier1:
          $ref: '#/components/schemas/RemediationHistoryTier1'
        tier2:
          $ref: '#/components/schemas/RemediationHistoryTier2'

    RemediationHistoryTier1:
      type: object
      description: |
        Tier 1: Detailed remediation chain within the recent window (default 24h).
        Contains full effectiveness data, health checks, and metric deltas.
      required:
        - window
        - chain
      properties:
        window:
          type: string
          description: Lookback window used for this tier (e.g. "24h")
          example: "24h"
        chain:
          type: array
          description: Ordered list of detailed remediation entries (ascending by completedAt)
          items:
            $ref: '#/components/schemas/RemediationHistoryEntry'

    RemediationHistoryTier2:
      type: object
      description: |
        Tier 2: Summary remediation chain for historical lookback (default 90d).
        Activated when currentSpecHash matches a historical preRemediationSpecHash
        beyond the Tier 1 window. Contains compact entries without health/metric details.
      required:
        - window
        - chain
      properties:
        window:
          type: string
          description: Lookback window used for this tier (e.g. "2160h")
          example: "2160h"
        chain:
          type: array
          description: Ordered list of summary remediation entries (ascending by completedAt)
          items:
            $ref: '#/components/schemas/RemediationHistorySummary'

    RemediationHistoryEntry:
      type: object
      description: |
        Full remediation history entry for Tier 1.
        Correlates RO (remediation.workflow_created) and EM (effectiveness.assessment.completed)
        audit events by remediation_request_uid.
      required:
        - remediationUID
        - completedAt
      properties:
        remediationUID:
          type: string
          description: RemediationRequest UID (correlation key)
          example: "rr-abc-123"
        signalFingerprint:
          type: string
          description: Signal fingerprint that triggered the remediation
          example: "fp-highcpu-123"
        signalType:
          type: string
          description: Type of signal (e.g. HighCPULoad, OOMKilled)
          example: "HighCPULoad"
        workflowType:
          type: string
          nullable: true
          description: Workflow type applied (null if escalated to human review)
          example: "ScaleUp"
        outcome:
          type: string
          description: Remediation outcome (Success, Failed, Escalated)
          example: "Success"
        effectivenessScore:
          type: number
          format: double
          nullable: true
          description: |
            EM effectiveness score (0.0-1.0). Null if assessment not yet completed
            or remediation was escalated.
          minimum: 0
          maximum: 1
          example: 0.4
        signalResolved:
          type: boolean
          nullable: true
          description: Whether the originating signal was resolved after remediation
          example: false
        hashMatch:
          type: string
          enum:
            - preRemediation
            - postRemediation
            - none
          description: |
            Result of three-way hash comparison:
            - preRemediation: currentSpecHash matches preRemediationSpecHash (regression)
            - postRemediation: currentSpecHash matches postRemediationSpecHash (unchanged)
            - none: currentSpecHash matches neither hash
          example: "postRemediation"
        preRemediationSpecHash:
          type: string
          description: Spec hash captured before remediation was applied
          example: "sha256:aabb112233dd"
        postRemediationSpecHash:
          type: string
          description: Spec hash captured after remediation was applied
          example: "sha256:ccdd334455ee"
        healthChecks:
          $ref: '#/components/schemas/RemediationHealthChecks'
        metricDeltas:
          $ref: '#/components/schemas/RemediationMetricDeltas'
        sideEffects:
          type: array
          description: List of detected side effects from the remediation
          items:
            type: string
          example: []
        completedAt:
          type: string
          format: date-time
          description: When the remediation was completed
          example: "2026-02-05T08:00:00Z"
        assessmentReason:
          type: string
          nullable: true
          enum:
            - full
            - partial
            - spec_drift
            - expired
            - no_execution
            - metrics_timed_out
          description: |
            Reason/status of the effectiveness assessment. Null if assessment
            not yet completed. When "spec_drift", the effectiveness score is
            unreliable (hard-overridden to 0.0) because the target resource
            spec was modified during the assessment window (DD-EM-002 v1.1).
          example: "full"
        assessedAt:
          type: string
          format: date-time
          description: When the effectiveness assessment was completed
          example: "2026-02-05T08:05:00Z"

    RemediationHistorySummary:
      type: object
      description: |
        Compact remediation history entry for Tier 2.
        Contains only essential fields for historical context.
      required:
        - remediationUID
        - completedAt
      properties:
        remediationUID:
          type: string
          description: RemediationRequest UID (correlation key)
          example: "rr-old-001"
        signalType:
          type: string
          description: Type of signal
          example: "HighCPULoad"
        workflowType:
          type: string
          nullable: true
          description: Workflow type applied (null if escalated)
          example: "ScaleUp"
        outcome:
          type: string
          description: Remediation outcome
          example: "Success"
        effectivenessScore:
          type: number
          format: double
          nullable: true
          description: EM effectiveness score (0.0-1.0)
          minimum: 0
          maximum: 1
          example: 0.4
        signalResolved:
          type: boolean
          nullable: true
          description: Whether the originating signal was resolved
          example: false
        hashMatch:
          type: string
          enum:
            - preRemediation
            - postRemediation
            - none
          description: Result of three-way hash comparison against currentSpecHash
          example: "preRemediation"
        assessmentReason:
          type: string
          nullable: true
          enum:
            - full
            - partial
            - spec_drift
            - expired
            - no_execution
            - metrics_timed_out
          description: |
            Reason/status of the effectiveness assessment (same enum as
            RemediationHistoryEntry). When "spec_drift", effectiveness score
            is unreliable (DD-EM-002 v1.1).
          example: "full"
        completedAt:
          type: string
          format: date-time
          description: When the remediation was completed
          example: "2026-01-15T10:00:00Z"

    RemediationHealthChecks:
      type: object
      description: |
        Post-remediation health check results from EM assessment.
      properties:
        podRunning:
          type: boolean
          description: Whether the target pod is running
          example: true
        readinessPass:
          type: boolean
          description: Whether readiness probes are passing
          example: true
        restartDelta:
          type: integer
          description: Change in restart count since remediation
          example: 0
        crashLoops:
          type: boolean
          description: Whether crash loops were detected
          example: false
        oomKilled:
          type: boolean
          description: Whether OOM kills were detected
          example: false
        pendingCount:
          type: integer
          description: |
            Number of pods still in Pending phase after the stabilization window.
            Non-zero indicates scheduling failures, image pull issues, or resource exhaustion.
          example: 0

    RemediationMetricDeltas:
      type: object
      description: |
        Metric deltas between pre-remediation and post-remediation measurements.
      properties:
        cpuBefore:
          type: number
          format: double
          description: CPU utilization before remediation (0.0-1.0)
          example: 0.95
        cpuAfter:
          type: number
          format: double
          description: CPU utilization after remediation (0.0-1.0)
          example: 0.92
        memoryBefore:
          type: number
          format: double
          description: Memory utilization before remediation (0.0-1.0)
          example: 0.60
        memoryAfter:
          type: number
          format: double
          description: Memory utilization after remediation (0.0-1.0)
          example: 0.62
        latencyP95BeforeMs:
          type: number
          format: double
          description: P95 latency before remediation (milliseconds)
          example: 200
        latencyP95AfterMs:
          type: number
          format: double
          description: P95 latency after remediation (milliseconds)
          example: 195
        errorRateBefore:
          type: number
          format: double
          description: Error rate before remediation (0.0-1.0)
          example: 0.02
        errorRateAfter:
          type: number
          format: double
          description: Error rate after remediation (0.0-1.0)
          example: 0.019

